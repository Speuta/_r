{"version":3,"file":"_r.min.js","sources":["../src/is.ts","../src/global.ts","../src/data.ts","../src/events/core.ts","../src/util/queryString.ts","../src/util/extend.ts","../src/activateCamera.ts","../src/patch/patchPlugin.ts","../src/Selector.ts","../src/Elements.ts","../src/library.ts","../src/select.ts","../src/load.ts","../src/patch/patchElement.ts","../src/util/color.ts","../src/patch/patch.ts","../src/patch/plugins/colors.ts","../src/patch/plugins/star.ts","../src/patch/plugins/fresnelParameters.ts","../src/patch/plugins/execute.ts","../src/patch/plugins/scene.ts","../src/patch/plugins/data.ts","../src/patch/plugins/events.ts","../src/patch/plugins/nodeByName.ts","../src/patch/plugins/patchParallel.ts","../src/util/loadingScreen.ts","../src/launch.ts","../src/renderLoop.ts","../src/download.ts","../src/events/keys.ts","../src/events/meshes.ts","../src/events/index.ts","../src/animate.ts","../src/show.hide/gizmo.ts","../src/show.hide/index.ts","../src/show.hide/normals.ts","../src/show.hide/wireframe.ts","../src/util/router.ts","../src/util/merge.ts","../src/util/freeze.ts","../src/index.ts"],"sourcesContent":["export module is {\r\n  export function Function(functionToCheck): boolean {\r\n    var getType = {};\r\n    return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';\r\n  }\r\n\r\n  export function Number(n): boolean {\r\n    return !isNaN(parseFloat(n)) && isFinite(n);\r\n  }\r\n\r\n  export function PlainObject(n): boolean {\r\n    // Basic check for Type object that's not null\r\n    if (typeof n == 'object' && n !== null) {\r\n      // If Object.getPrototypeOf supported, use it\r\n      if (typeof Object.getPrototypeOf == 'function') {\r\n        var proto = Object.getPrototypeOf(n);\r\n        return proto === Object.prototype || proto === null;\r\n      }\r\n      // Otherwise, use internal class\r\n      // This should be reliable as if getPrototypeOf not supported, is pre-ES5\r\n      return Object.prototype.toString.call(n) == '[object Object]';\r\n    }\r\n    // Not an object\r\n    return false;\r\n  }\r\n\r\n  export function AssetContainer(x: any) {\r\n    return x instanceof BABYLON.AssetContainer;\r\n  }\r\n\r\n  export function Scene(x: any) {\r\n    return x instanceof BABYLON.Scene;\r\n  }\r\n\r\n  export function TransformNode(x : any) {\r\n    return x instanceof BABYLON.TransformNode;\r\n  }\r\n\r\n  export function Array(x: any): boolean {\r\n    return window['Array'].isArray(x);\r\n  }\r\n\r\n  export function Mesh(x: any): boolean {\r\n    return x instanceof BABYLON.AbstractMesh;\r\n  }\r\n\r\n  export function Material(x: any): boolean {\r\n    return x instanceof BABYLON.Material;\r\n  }\r\n\r\n  export function MultiMaterial(x: any): boolean {\r\n    return x instanceof BABYLON.MultiMaterial;\r\n  }\r\n\r\n  export function Texture(x: any): boolean {\r\n    return x instanceof BABYLON.Texture;\r\n  }\r\n\r\n  export function Light(x: any): boolean {\r\n    return x instanceof BABYLON.Light;\r\n  }\r\n\r\n  export function Camera(x: any): boolean {\r\n    return x instanceof BABYLON.Camera;\r\n  }\r\n\r\n  export function Vector3(x: any): boolean {\r\n    return x instanceof BABYLON.Vector3 || (is.Array(x) && x.length == 3);\r\n  }\r\n\r\n  export function Vector2(x: any): boolean {\r\n    return x instanceof BABYLON.Vector2;\r\n  }\r\n\r\n  export function Color(x: any): boolean {\r\n    //TODO\r\n    //return HexColor(x) || x instanceof BABYLON.Color3 || x instanceof BABYLON.Color4 || _r.colorNames[x] != null || (is.String(x) && (x.trim().indexOf('rgb(') == 0 ||  x.trim().indexOf('rgba(') == 0));\r\n    return HexColor(x) || x instanceof BABYLON.Color3 || x instanceof BABYLON.Color4 || (is.String(x) && (x.trim().indexOf('rgb(') == 0 || x.trim().indexOf('rgba(') == 0));\r\n  }\r\n\r\n  export function HexColor(x: any): boolean {\r\n    return String(x) && x[0] == '#';\r\n  }\r\n\r\n  export function Float(n: any): boolean {\r\n    return Number(n) === n && n % 1 !== 0;\r\n  }\r\n\r\n  export function Int(n: any): boolean {\r\n    return Number(n) === n && n % 1 === 0;\r\n  }\r\n\r\n  export function Quaternion(n: any): boolean {\r\n    return n instanceof BABYLON.Quaternion;\r\n  }\r\n\r\n  export function Matrix(n: any): boolean {\r\n    return n instanceof BABYLON.Matrix;\r\n  }\r\n\r\n  export function String(x: any): boolean {\r\n    return typeof x === \"string\";\r\n  }\r\n\r\n  export function Size(n: any): boolean {\r\n    return n instanceof BABYLON.Size;\r\n  }\r\n\r\n  export function PatchFile(expr: string) {\r\n    return FileWithExtension(expr, [\"runtime\", \"patch\", \"js\"]);\r\n  }\r\n\r\n  export function Boolean(expr: any): boolean {\r\n    return typeof expr == 'boolean';\r\n  }\r\n\r\n  /**\r\n   * Camera || Light || Material || Mesh || Texture ||\r\n   * @param x\r\n   * @constructor\r\n   */\r\n  export function BabylonNode(x: any) {\r\n    return is.Camera(x) || is.Light(x) || is.Material(x) || is.Mesh(x) || is.Texture(x);\r\n  }\r\n\r\n  /**\r\n   * Check is a javascript Object is a DOM Object\r\n   * @param expr\r\n   * @constructor\r\n   */\r\n  export function DOM(expr: any): boolean {\r\n    // from https://stackoverflow.com/questions/384286/javascript-isdom-how-do-you-check-if-a-javascript-object-is-a-dom-object\r\n    return (\r\n      typeof HTMLElement === \"object\" ? expr instanceof HTMLElement : //DOM2\r\n        expr && typeof expr === \"object\" && expr !== null && expr.nodeType === 1 && typeof expr.nodeName === \"string\"\r\n    );\r\n  }\r\n  DOM.canvas = function(expr : any) {\r\n    return expr instanceof HTMLCanvasElement;\r\n  };\r\n  DOM.div = function(expr : any) {\r\n    return expr instanceof HTMLDivElement;\r\n  };\r\n  DOM.image = function(expr : any) {\r\n    return expr instanceof HTMLImageElement;\r\n  };\r\n  /**\r\n   * Test for any Primitive\r\n   * @param x\r\n   * @returns {boolean}\r\n   * @constructor\r\n   */\r\n  export function Primitive(x: any) {\r\n    return x !== Object(x);\r\n  }\r\n\r\n  export function Promise(x: any) {\r\n    return x && typeof x[\"then\"] == 'function';\r\n  }\r\n\r\n  export function FileWithExtension(file : string, ext : string | string[]) {\r\n    if (typeof file !== 'string') {\r\n      return false;\r\n    }\r\n    let split = file.split('.');\r\n    if (split.length === 1) {\r\n      return false;\r\n    }\r\n    let extension = split.pop().trim();\r\n    if (is.Array(ext)) {\r\n      ext = <string[]> ext;\r\n      for (let i = 0; i < ext.length; i++) {\r\n        let _ext = ext[i].trim();\r\n        if (_ext === extension || _ext === ('.' + extension)) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n    else {\r\n      return ext === extension || ext === ('.' + extension);\r\n    }\r\n  }\r\n\r\n  export function ImageFile(file : string) {\r\n    return FileWithExtension(file, [\"jpg\", \"jpeg\", \"png\", \"gif\"]);\r\n  }\r\n}\r\n","import { is } from \"./is.js\";\r\nlet _scene, _engine, _canvas;\r\n\r\nexport class global {\r\n  static fn = {};\r\n  static get canvas() {\r\n    if (!_canvas) {\r\n      if (BABYLON.Engine.LastCreatedEngine) {\r\n        let canvas = BABYLON.Engine.LastCreatedEngine.getRenderingCanvas();\r\n        if (canvas) {\r\n          _canvas = canvas;\r\n          return _canvas;\r\n        }\r\n      }\r\n      _canvas = document.createElement('canvas');\r\n      _canvas.setAttribute('touch-action', 'none');\r\n      _canvas.style.width = \"100%\";\r\n      _canvas.style.height = \"100%\";\r\n      return _canvas;\r\n    }\r\n    return _canvas;\r\n  }\r\n\r\n  static set canvas(value) {\r\n    if (is.String(value)) {\r\n      _canvas = document.getElementById(value);\r\n    }\r\n    else {\r\n      _canvas = value;\r\n    }\r\n  }\r\n\r\n  static get engine() {\r\n    if (!_engine) {\r\n      if (BABYLON.Engine.LastCreatedEngine) {\r\n        _engine = BABYLON.Engine.LastCreatedEngine;\r\n      }\r\n      else {\r\n        _engine = new BABYLON.Engine(global.canvas, true);\r\n      }\r\n\r\n    }\r\n    return _engine;\r\n  }\r\n\r\n  static set engine(value) {\r\n    _engine = value;\r\n    // the canvas/window resize event handler\r\n    window.addEventListener('resize', function() {\r\n      _engine.resize();\r\n    });\r\n  }\r\n\r\n  static get scene() {\r\n    if (!_scene) {\r\n      if (BABYLON.Engine.LastCreatedScene) {\r\n        _scene = BABYLON.Engine.LastCreatedScene;\r\n      }\r\n      else {\r\n        _scene = new BABYLON.Scene(global.engine);\r\n      }\r\n    }\r\n    return _scene;\r\n  }\r\n\r\n  static set scene(value) {\r\n    _scene = value;\r\n  }\r\n\r\n  static TRACE = false;\r\n}","import { is } from \"./is.js\";\r\nimport { global } from \"./global.js\";\r\n\r\nlet cache = [];\r\nlet expando = '_r' + Date.now();\r\n\r\n/**\r\n * Attach any data to any js object (inspired by {@link https://api.jquery.com/data/ |jQuery.data()}).\r\n * @param element\r\n * @param key\r\n * @param value\r\n */\r\nexport function data(element : any, key?: string, value?: any) {\r\n    if (!element.hasOwnProperty(expando)) {\r\n        element[expando] = cache.length;\r\n        cache[element[expando]] = {};\r\n    }\r\n    if (key != null) {\r\n        if (value !== undefined) {\r\n            cache[element[expando]][key] = value;\r\n        }\r\n        else {\r\n            return cache[element[expando]][key];\r\n        }\r\n    }\r\n    else {\r\n        return cache[element[expando]];\r\n    }\r\n}\r\n\r\nglobal.fn[\"data\"] = function(key? : string, value? : any) {\r\n    if (key != null && value != null) {\r\n        for (let i = 0; i < this.length; i++) {\r\n            data(this[i], key, value);\r\n        }\r\n    }\r\n    else {\r\n        return data(this[0], key, value);\r\n    }\r\n};\r\n","import { data } from \"../data.js\";\r\nimport { is } from \"../is.js\";\r\n\r\nexport function on(element: any, event: string, handler: (...args: any[]) => void, repeat = true) {\r\n  if (!data(element, '_r.e')) {\r\n    data(element, '_r.e', {});\r\n  }\r\n  let events = data(element, '_r.e');\r\n  if (!events[event]) {\r\n    events[event] = [];\r\n  }\r\n  events[event].push({\r\n    handler: handler,\r\n    repeat: repeat\r\n  });\r\n}\r\n\r\nexport function one(element: any, event: string, handler: (...args: any[]) => void) {\r\n  on(element, event, handler, false);\r\n}\r\n\r\nexport function trigger(element: any, event: string, ...extraParameters: any[]) {\r\n  let events = data(element, '_r.e');\r\n  if (!events) {\r\n    return;\r\n  }\r\n  let handlers = events[event];\r\n  if (is.Array(handlers)) {\r\n    handlers.forEach(function(callback) {\r\n      try {\r\n        callback.handler.call(element, ...extraParameters);\r\n        if (!callback.repeat) {\r\n          off(element, event, callback.handler);\r\n        }\r\n      }\r\n      catch (ex) {\r\n        console.error(\"_r.trigger exception\", ex);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport function off(element: any, event: string, handler?: (...args: any[]) => void) {\r\n  let events = data(element, '_r.e');\r\n  if (events[event]) {\r\n    if (handler) {\r\n      events[event] = events[event].filter(function(_handler) {\r\n        if (_handler.handler.toString() == handler.toString()) {\r\n          events[event].splice(events[event].indexOf(_handler), 1);\r\n        }\r\n      });\r\n    }\r\n    else {\r\n      events[event] = [];\r\n    }\r\n  }\r\n}","import { on, off, one, trigger } from \"../events/core.js\";\r\n\r\nfunction getQueryStringParameter(name, url?) {\r\n  if (!url) {\r\n    url = window.location.href;\r\n  }\r\n  name = name.replace(/[\\[\\]]/g, '\\\\$&');\r\n  let regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\r\n    results = regex.exec(url);\r\n  if (!results) {\r\n    return null;\r\n  }\r\n  if (!results[2]) {\r\n    return '';\r\n  }\r\n  return decodeURIComponent(results[2].replace(/\\+/g, ' '));\r\n}\r\n\r\nfunction updateUrlParameter(uri, key, value) {\r\n  // remove the hash part before operating on the uri\r\n  let i = uri.indexOf('#');\r\n  let hash = i === -1 ? ''  : uri.substr(i);\r\n  uri = i === -1 ? uri : uri.substr(0, i);\r\n\r\n  let re = new RegExp(\"([?&])\" + key + \"=.*?(&|$)\", \"i\");\r\n  let separator = uri.indexOf('?') !== -1 ? \"&\" : \"?\";\r\n\r\n  if (!value) {\r\n    // remove key-value pair if value is empty\r\n    uri = uri.replace(new RegExp(\"([?&]?)\" + key + \"=[^&]*\", \"i\"), '');\r\n    if (uri.slice(-1) === '?') {\r\n      uri = uri.slice(0, -1);\r\n    }\r\n    // replace first occurrence of & by ? if no ? is present\r\n    if (uri.indexOf('?') === -1) {\r\n      uri = uri.replace(/&/, '?');\r\n    }\r\n  } else if (uri.match(re)) {\r\n    uri = uri.replace(re, '$1' + key + \"=\" + value + '$2');\r\n  } else {\r\n    uri = uri + separator + key + \"=\" + value;\r\n  }\r\n  return uri + hash;\r\n}\r\n\r\nexport let queryString = {\r\n  get : function(name) {\r\n    return getQueryStringParameter(name);\r\n  },\r\n  set : function(name, value) {\r\n    if (history.pushState) {\r\n      let newurl = updateUrlParameter(window.location.href, name, value);\r\n      window.history.pushState(\r\n        {path: newurl},\r\n        '',\r\n        newurl);\r\n    }\r\n    this.trigger(name, value);\r\n  },\r\n  on : function(event: string, handler: (...args: any[]) => void, repeat = true) {\r\n    on(this, event, handler, repeat);\r\n  },\r\n  off : function(event: string, handler?: (...args: any[]) => void) {\r\n    off(this, event, handler);\r\n  },\r\n  one : function(event: string, handler: (...args: any[]) => void) {\r\n    one(this, event, handler);\r\n  },\r\n  trigger : function(event: string, extraParameters?: any) {\r\n    trigger(this, event, extraParameters);\r\n  },\r\n};","import { is } from \"../is.js\";\r\n\r\n/**\r\n * Merge the contents of two or more objects together into the first object.\r\n *\r\n * - If first parameter is equal to true, the merge becomes recursive (aka. deep copy). Passing false for this argument is not supported.\r\n * - When two or more object arguments are supplied to _r.extend(), properties from all of the objects are added to the target object. Arguments that are null or undefined are ignored.\r\n *\r\n * @param args\r\n * @returns {any}\r\n */\r\nexport function extend(...args: any[]): any {\r\n  /**\r\n   * inspired by https://j11y.io/jquery/#v=1.11.2&fn=jQuery.extend\r\n   * (https://github.com/jquery/jquery/blob/master/src/core.js)\r\n   */\r\n  let options, name, src, copy, isArray, clone,\r\n    target = args[0],\r\n    i = 1,\r\n    length = args.length,\r\n    deep = false;\r\n\r\n  // Handle a deep copy situation\r\n  if (typeof target === \"boolean\") {\r\n    deep = target;\r\n    target = arguments[1] || {};\r\n    // skip the boolean and the target\r\n    i++;\r\n  }\r\n  // Handle case when target is a string or something (possible in deep copy)\r\n  if (typeof target !== \"object\" && !is.Function(target)) {\r\n    target = {};\r\n  }\r\n\r\n  for (; i < length; i++) {\r\n    // Only deal with non-null/undefined values\r\n    if ((options = arguments[i]) != null) {\r\n      // Extend the base object\r\n      for (name in options) {\r\n        src = target[name];\r\n        copy = options[name];\r\n        // Prevent never-ending loop\r\n        if (target == copy) {\r\n          continue;\r\n        }\r\n        // Recurse if we're merging plain objects or arrays\r\n        if (deep && copy && (is.PlainObject(copy) || (isArray = is.Array(copy)))) {\r\n          if (isArray) {\r\n            isArray = false;\r\n            clone = src && is.Array(src) ? src : [];\r\n          }\r\n          else {\r\n            clone = src && is.PlainObject(src) ? src : {};\r\n          }\r\n          // Never move original objects, clone them\r\n          target[name] = extend(deep, clone, copy);\r\n        }\r\n        else {\r\n          // Don't bring in undefined values\r\n          if (copy !== undefined) {\r\n            target[name] = copy;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return target;\r\n}","import { global } from './global.js';\r\nimport { is } from \"./is.js\";\r\n\r\nexport function activateCamera(camera : string | BABYLON.Camera) {\r\n    if (global.scene.activeCamera) {\r\n        global.scene.activeCamera.detachControl();\r\n    }\r\n    if (is.String(camera)) {\r\n        global.scene.setActiveCameraByName(camera);\r\n    }\r\n    else {\r\n        global.scene.activeCamera = camera;\r\n    }\r\n    global.scene.activeCamera.attachControl(global.canvas);\r\n}","export let plugins : Array<IPatchPlugin> = [];\r\nexport interface IPatchPlugin {\r\n  test : (element, source, property) => boolean;\r\n  resolve : (element, source, property, context? : any) => any;\r\n}\r\nexport function registerPlugin(plugin : IPatchPlugin) {\r\n  plugins.push(plugin);\r\n}\r\nexport function getPlugin(element, source, property) : IPatchPlugin | null {\r\n  let plugin = null;\r\n  for (let i = 0; i < plugins.length; i++) {\r\n    if (plugins[i].test(element, source, property)) {\r\n      plugin = plugins[i];\r\n    }\r\n  }\r\n  return plugin;\r\n}","import { is } from \"./is.js\";\r\n\r\nexport class Selector {\r\n  type = \"all\";\r\n  filters: Array<any>;\r\n\r\n  constructor(selector: string) {\r\n    let filters = [];\r\n    let type = \"all\";\r\n    let item = selector.trim();\r\n    if (item.indexOf(\":mesh\") !== -1) {\r\n      type = \"mesh\";\r\n    }\r\n    if (item.indexOf(\":material\") !== -1) {\r\n      type = \"material\";\r\n    }\r\n    if (item.indexOf(\":light\") !== -1) {\r\n      type = \"light\";\r\n    }\r\n    if (item.indexOf(\":camera\") !== -1) {\r\n      type = \"camera\";\r\n    }\r\n    if (item.indexOf(\":texture\") !== -1) {\r\n      type = \"texture\";\r\n    }\r\n    if (item.indexOf(\":multimaterial\") !== -1) {\r\n      type = \"multimaterial\";\r\n    }\r\n    if (item.indexOf(':transformNode') !== -1) {\r\n      type = \"transformNode\";\r\n    }\r\n    [\":mesh\", \":material\", \":multimaterial\", \":camera\", \":light\", \":texture\", \":transformNode\"].forEach(function(type) {\r\n      item = item.replace(type, '');\r\n    });\r\n\r\n    // [isVisible][alpha!= 0.1]\r\n    let regExpAttribute = /\\[(.*?)\\]/;\r\n    let matches = [];\r\n    let match;\r\n    while (match = regExpAttribute.exec(selector)) {\r\n      matches.push(match[1]);\r\n      selector = selector.replace(regExpAttribute, '');\r\n    }\r\n    // TODO [material.diffuseTexture.name=texture*.jpg]\r\n    matches.forEach((expr) => {\r\n      if (expr.indexOf('!=') !== -1) {\r\n        let split = expr.split('!=');\r\n        let left = split[0].trim();\r\n        let right = split[1].trim();\r\n        try {\r\n          right = JSON.parse(right);\r\n        }\r\n        catch {\r\n          try {\r\n            right = JSON.parse(JSON.stringify(right));\r\n          }\r\n          catch {\r\n            console.error(\"_r.select - incorrect parameter : \" + right);\r\n          }\r\n        }\r\n        let func = (element) => {\r\n          let _split = left.split('.');\r\n          let _element = element;\r\n          for (let i = 0; i < _split.length; i++) {\r\n            if (_element != null && _element[_split[i]] != null) {\r\n              _element = _element[_split[i]];\r\n            } else {\r\n              _element = null;\r\n            }\r\n          }\r\n          return _element != null && _element != right;\r\n        };\r\n        filters.push(func);\r\n      }\r\n      else {\r\n        if (expr.indexOf('=') !== -1) {\r\n          let split = expr.split('=');\r\n          let left = split[0].trim();\r\n          let right = split[1].trim();\r\n          try {\r\n            right = JSON.parse(right);\r\n          }\r\n          catch {\r\n            try {\r\n              right = JSON.parse(JSON.stringify(right));\r\n            }\r\n            catch {\r\n              console.error(\"_r.select - incorrect parameter : \" + right);\r\n            }\r\n          }\r\n          let func = (element) => {\r\n            let _split = left.split('.');\r\n            let _element = element;\r\n            for (let i = 0; i < _split.length; i++) {\r\n              if (_element != null && _element[_split[i]] != null) {\r\n                _element = _element[_split[i]];\r\n              } else {\r\n                _element = null;\r\n              }\r\n            }\r\n            return _element != null && _element == right;\r\n          };\r\n          filters.push(func);\r\n        }\r\n        else {\r\n          let func = (element) => {\r\n            let left = expr.trim();\r\n            let _split = left.split('.');\r\n            let _element = element;\r\n            for (let i = 0; i < _split.length; i++) {\r\n              if (_element != null && _element[_split[i]] != null) {\r\n                _element = _element[_split[i]];\r\n              } else {\r\n                _element = null;\r\n              }\r\n            }\r\n            return _element != null;\r\n          };\r\n          filters.push(func);\r\n        }\r\n      }\r\n    });\r\n    item = item.replace(regExpAttribute, '');\r\n    // Here item only contains name selector i.e mesh.00*\r\n    item = item.replace(/\\./g, \"\\\\.\");\r\n    let exp = item.replace(/\\*/g, '.*');\r\n    let regExp = new RegExp('^' + exp + '$');\r\n    filters.push(function(element) {\r\n      return element.hasOwnProperty('name') && regExp.test(element.name);\r\n    });\r\n    // TODO :not(selector)\r\n    this.filters = filters;\r\n    this.type = type;\r\n  }\r\n\r\n  matchFilters(element) {\r\n    for (let i = 0; i < this.filters.length; i++) {\r\n      if (!this.filters[i](element)) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  matchType(element) {\r\n    if (this.type == \"all\") {\r\n      return true;\r\n    }\r\n    if (this.type == \"mesh\") {\r\n      return is.Mesh(element);\r\n    }\r\n    if (this.type == \"light\") {\r\n      return is.Light(element);\r\n    }\r\n    if (this.type == \"material\") {\r\n      return is.Material(element);\r\n    }\r\n    if (this.type == \"multimaterial\") {\r\n      return is.MultiMaterial(element);\r\n    }\r\n    if (this.type == \"texture\") {\r\n      return is.Texture(element);\r\n    }\r\n    if (this.type == \"camera\") {\r\n      return is.Camera(element);\r\n    }\r\n    if (this.type == \"transformNode\") {\r\n      return is.TransformNode(element);\r\n    }\r\n  }\r\n}","import { global } from \"./global.js\";\r\nimport { is } from \"./is.js\";\r\nimport { Selector } from \"./Selector.js\";\r\n\r\nexport class Elements {\r\n  length : number;\r\n  constructor(...elements : any) {\r\n    this.length = 0;\r\n    for (let i = 0; i < elements.length; i++) {\r\n      this.add(elements[i]);\r\n    }\r\n  }\r\n\r\n  add(element : any) {\r\n    if (is.Array(element)) {\r\n      for (let i = 0; i < element.length; i++) {\r\n        this.add(element[i]);\r\n      }\r\n      return;\r\n    }\r\n    if (is.AssetContainer(element)) {\r\n      for (let i = 0; i < element.meshes.length; i++) {\r\n        this[this.length++] = element.meshes[i];\r\n      }\r\n      for (let i = 0; i < element.lights.length; i++) {\r\n        this[this.length++] = element.lights[i];\r\n      }\r\n      for (let i = 0; i < element.materials.length; i++) {\r\n        this[this.length++] = element.materials[i];\r\n      }\r\n      for (let i = 0; i < element.textures.length; i++) {\r\n        this[this.length++] = element.textures[i];\r\n      }\r\n      for (let i = 0; i < element.cameras.length; i++) {\r\n        this[this.length++] = element.cameras[i];\r\n      }\r\n      return;\r\n    }\r\n    this[this.length++] = element;\r\n  }\r\n\r\n  contains(element : any) : boolean {\r\n    return this.toArray().indexOf(element) !== -1;\r\n  }\r\n\r\n  /**\r\n   * Iterate over elements and executing a function for each element.\r\n   * @param callback A function to execute for each element.\r\n   * @returns {_r.Elements}\r\n   */\r\n  each(callback: Function) : Elements {\r\n    for (let i = 0; i < this.length; i++) {\r\n      /** We can break the .each() loop at a particular iteration by making the callback function return false. Returning non-false is the same as a continue statement in a for loop; it will skip immediately to the next iteration. **/\r\n      if (callback.call(this[i], this[i], i) == false) {\r\n        return;\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n  forEach(callback : Function) : Elements {\r\n    return this.each(callback);\r\n  }\r\n  /**\r\n   * Pass each element in the current matched set through a function, producing a new jQuery object containing the return values.\r\n   * @param func A function object that will be invoked for each element in the current set.\r\n   * @returns {_r.Elements}\r\n   */\r\n  map(func : (obj : any) => any) : Elements {\r\n    let result = new Elements();\r\n    let length = 0;\r\n    this.each(function(element) {\r\n      result[length++] = func(element);\r\n    });\r\n    result.length = length;\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Reduce the set of matched elements to those that match the selector or pass the function’s test.\r\n   * @param func A function used as a test for each element in the set. this is the current element.\r\n   * @returns {_r.Elements}\r\n   */\r\n  filter(func : (obj : any) => boolean) : Elements {\r\n    let result = new Elements();\r\n    this.each(function(element) {\r\n      if (func(element)) {\r\n        result.add(element);\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Retrieve all the elements contained in the set, as an array.\r\n   * @returns {Array}\r\n   */\r\n  toArray() {\r\n    let result = [];\r\n    for (let i = 0; i < this.length; i++) {\r\n      result.push(this[i]);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get the value of an attribute for the first element in the set of matched elements or set one or more attributes for every matched element.\r\n   * @param attribute The name of the attribute to get.\r\n   * @param value Optional value to set for the attribute.\r\n   * @returns {any}\r\n   */\r\n  attr(attribute : string, value? : any) {\r\n    if (value != null) {\r\n      this.each(function(item) {\r\n        item[attribute] = value;\r\n      });\r\n      return this;\r\n    }\r\n    else {\r\n      return this[0][attribute];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reduce the set of matched elements to the first in the set.\r\n   * @returns {any}\r\n   */\r\n  first() : any {\r\n    return this[0];\r\n  }\r\n\r\n  /**\r\n   * @param property\r\n   * @returns {_r.Elements}\r\n   */\r\n  log(property?: string) {\r\n    this.each(function(item) {\r\n      if (property) {\r\n        console.log(item[property]);\r\n      }\r\n      else {\r\n        console.log(item);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Insert elements in the set\r\n   * @param elements\r\n   * @returns {_r.Elements}\r\n   */\r\n  concat(...elements : any[]) : Elements {\r\n    elements.forEach((element) => {\r\n      let base;\r\n      if (element instanceof Elements) {\r\n        base = element;\r\n      }\r\n      else {\r\n        if (is.String(element)) {\r\n          base = new Elements(element);\r\n        }\r\n        else {\r\n          if (is.Array(element)) {\r\n            base = new Elements();\r\n            element.forEach(function(item) {\r\n              base[base.length++] = item;\r\n            });\r\n          }\r\n          else {\r\n            base = new Elements(element);\r\n          }\r\n        }\r\n      }\r\n      base.each(function(item) {\r\n        this[this.length++] = item;\r\n      });\r\n    });\r\n    return this;\r\n  }\r\n\r\n  select(selector : string) {\r\n    if (this.length === 1 && is.Scene(this[0])) {\r\n      return find(selector, this[0]);\r\n    }\r\n    else {\r\n      return find(selector, this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disposes all the assets in the container\r\n   */\r\n  dispose() {\r\n    for (let i = 0; i < this.length; i++) {\r\n      this[i].dispose();\r\n      delete this[i];\r\n    }\r\n  }\r\n\r\n  addToScene() {\r\n    this.each(function(element) {\r\n      if (is.Camera(element)) {\r\n        global.scene.addCamera(element);\r\n      }\r\n      if (is.Mesh(element)) {\r\n        global.scene.addMesh(element);\r\n      }\r\n      if (is.Material(element)) {\r\n        global.scene.addMaterial(element);\r\n      }\r\n      if (is.MultiMaterial(element)) {\r\n        global.scene.addMultiMaterial(element);\r\n      }\r\n      if (is.Texture(element)) {\r\n        global.scene.addTexture(element);\r\n      }\r\n      if (is.Light(element)) {\r\n        global.scene.addLight(element);\r\n      }\r\n    });\r\n    return this;\r\n  }\r\n\r\n  removeFromScene() {\r\n    this.each(function(element) {\r\n      if (is.Camera(element)) {\r\n        global.scene.removeCamera(element);\r\n        return false;\r\n      }\r\n      if (is.Mesh(element)) {\r\n        global.scene.removeMesh(element);\r\n        return false;\r\n      }\r\n      if (is.Material(element)) {\r\n        global.scene.removeMaterial(element);\r\n        return false;\r\n      }\r\n      if (is.MultiMaterial(element)) {\r\n        global.scene.removeMultiMaterial(element);\r\n        return false;\r\n      }\r\n      if (is.Texture(element)) {\r\n        global.scene.removeTexture(element);\r\n        return false;\r\n      }\r\n      if (is.Light(element)) {\r\n        global.scene.removeLight(element);\r\n        return false;\r\n      }\r\n    });\r\n    return this;\r\n  }\r\n  // TODO\r\n  remove(element : any) {\r\n    /**\r\n     let index = this.toArray().indexOf(element);\r\n     if(index) {\r\n\r\n        }\r\n     for (let property in PROPERTIES) {\r\n            if(element instanceof BABYLON[property]) {\r\n                this[this.length++] = element;\r\n                super[PROPERTIES[property]].push(element);\r\n                return;\r\n            }\r\n        }**/\r\n  }\r\n}\r\n\r\n/**\r\n * Helper to debug selector.\r\n * @param element\r\n * @param selector\r\n * @returns {boolean} true if element match the selector, false otherwise\r\n */\r\nexport function match(element : any, params : string) {\r\n  let _selector = new Selector(params);\r\n  return _selector.matchType(element) && _selector.matchFilters(element);\r\n}\r\n\r\nexport function find(params : string, container : BABYLON.Scene | Elements | BABYLON.AssetContainer) : Elements {\r\n  let elements = new Elements();\r\n  params.split(',').forEach(function(item) {\r\n    item = item.trim();\r\n    let selector = new Selector(item);\r\n    if (is.Scene(container) || is.AssetContainer(container)) {\r\n      container = <BABYLON.AssetContainer> container;\r\n      switch (selector.type) {\r\n        case \"material\" :\r\n          container.materials.forEach(function(material) {\r\n            if (selector.matchFilters(material)) {\r\n              elements.add(material);\r\n            }\r\n          });\r\n          break;\r\n        case \"mesh\" :\r\n          container.meshes.forEach(function(mesh) {\r\n            if (selector.matchFilters(mesh)) {\r\n              elements.add(mesh);\r\n            }\r\n          });\r\n          break;\r\n        case \"light\":\r\n          container.lights.forEach(function(light) {\r\n            if (selector.matchFilters(light)) {\r\n              elements.add(light);\r\n            }\r\n          });\r\n          break;\r\n        case \"multimaterial\":\r\n          container.materials.forEach(function(material) {\r\n            if (is.MultiMaterial(material)) {\r\n              if (selector.matchFilters(material)) {\r\n                elements.add(material);\r\n              }\r\n            }\r\n          });\r\n          break;\r\n        case \"texture\":\r\n          container.textures.forEach(function(texture) {\r\n            if (selector.matchFilters(texture)) {\r\n              elements.add(texture);\r\n            }\r\n          });\r\n          break;\r\n        case \"camera\":\r\n          container.cameras.forEach(function(camera) {\r\n            if (selector.matchFilters(camera)) {\r\n              elements.add(camera);\r\n            }\r\n          });\r\n          break;\r\n        case \"transformNode\":\r\n          container.transformNodes.forEach(function(camera) {\r\n            if (selector.matchFilters(camera)) {\r\n              elements.add(camera);\r\n            }\r\n          });\r\n          break;\r\n        case \"all\":\r\n          container.materials.forEach(function(material) {\r\n            if (selector.matchFilters(material)) {\r\n              elements.add(material);\r\n            }\r\n          });\r\n          container.meshes.forEach(function(mesh) {\r\n            if (selector.matchFilters(mesh)) {\r\n              elements.add(mesh);\r\n            }\r\n          });\r\n          container.lights.forEach(function(light) {\r\n            if (selector.matchFilters(light)) {\r\n              elements.add(light);\r\n            }\r\n          });\r\n          container.textures.forEach(function(texture) {\r\n            if (selector.matchFilters(texture)) {\r\n              elements.add(texture);\r\n            }\r\n          });\r\n          container.cameras.forEach(function(camera) {\r\n            if (selector.matchFilters(camera)) {\r\n              elements.add(camera);\r\n            }\r\n          });\r\n          container.transformNodes.forEach(function(camera) {\r\n            if (selector.matchFilters(camera)) {\r\n              elements.add(camera);\r\n            }\r\n          });\r\n      }\r\n    }\r\n    else {\r\n      container = <Elements> container;\r\n      container.forEach(function(element) {\r\n        if (selector.matchType(element) && selector.matchFilters(element)) {\r\n          elements.add(element);\r\n        }\r\n      });\r\n    }\r\n  });\r\n  return elements;\r\n}","import { Elements } from \"./Elements.js\";\r\nimport { global } from \"./global.js\";\r\n\r\nexport var libraries = [];\r\n\r\nexport function createLibrary(name: string, ...elements: Array<any> | any) {\r\n  if (libraries[name]) {\r\n    console.error(\"[_r] Error in _r.createLibrary : \" + name + \" already exists\");\r\n    return;\r\n  }\r\n  else {\r\n    let _elements = new Elements(elements);\r\n    libraries[name] = _elements;\r\n    if (global.TRACE) {\r\n      console.groupCollapsed(\"[_r] - create library \" + name);\r\n      _elements.log();\r\n      console.groupEnd();\r\n    }\r\n  }\r\n}\r\n\r\nexport function library(name: string): Elements {\r\n  return libraries[name];\r\n}\r\n","import { is } from \"./is.js\";\r\nimport { Elements, find } from \"./Elements.js\";\r\nimport { libraries } from \"./library.js\";\r\nimport { global } from \"./global.js\";\r\n\r\nexport function select(arg) {\r\n  let elements;\r\n  if (is.String(arg)) {\r\n    if ((<string> arg).toLowerCase() === \"scene\") {\r\n      return new Elements(global.scene);\r\n    }\r\n    elements = find(arg, global.scene);\r\n    // elements could be in a library not attached to the scene\r\n\r\n    Object.getOwnPropertyNames(libraries).forEach(function(lib) {\r\n      // TODO : wtf ?\r\n      if (lib !== \"length\") {\r\n        let selection = libraries[lib].select(arg);\r\n        selection.each(function(item) {\r\n          // item could be in multiple libraries\r\n          if (!elements.contains(item)) {\r\n            elements.add(item);\r\n          }\r\n        });\r\n      }\r\n    });\r\n    if (global.TRACE === true && elements.length == 0) {\r\n      console.warn('BABYLON.Runtime::no object(s) found for selector \"' + arg + '\"');\r\n    }\r\n  }\r\n  else {\r\n    elements = new Elements(arg);\r\n  }\r\n  // plugins\r\n  for (let plugin in global.fn) {\r\n    Elements.prototype[plugin] = (...args) => {\r\n      return global.fn[plugin].call(elements, ...args);\r\n    };\r\n  }\r\n  return elements;\r\n}","import { is } from \"./is.js\";\r\nimport { global } from \"./global.js\";\r\nimport { select } from \"./select.js\";\r\n\r\nlet counter = 0;\r\n\r\nexport function load(resource : string | Array<string>, patch? : any) : Promise<any> {\r\n  if (is.Array(resource)) {\r\n    let promises = [];\r\n    resource = resource as Array<string>;\r\n    resource.forEach((item) => {\r\n      promises.push(load(item));\r\n    });\r\n    return Promise.all(promises);\r\n  }\r\n  else {\r\n    resource = resource as string;\r\n    if (is.ImageFile(resource)) {\r\n      return load.image(resource, patch);\r\n    }\r\n    if (is.FileWithExtension(resource, ['babylon', 'gltf', 'glb'])) {\r\n      return load.assets(resource, patch);\r\n    }\r\n    if (is.FileWithExtension(resource, ['json'])) {\r\n      return load.JSON(resource);\r\n    }\r\n    if (is.FileWithExtension(resource, ['js'])) {\r\n      return load.script(resource);\r\n    }\r\n     if (is.FileWithExtension(resource, ['css'])) {\r\n      return load.css(resource);\r\n    }\r\n    if (is.FileWithExtension(resource, ['patch'])) {\r\n      return load.patch(resource);\r\n    }\r\n    if (is.FileWithExtension(resource, ['txt'])) {\r\n      return load.ajax(resource);\r\n    }\r\n  }\r\n}\r\n\r\nload.image = function(image : string, patch? : any) : Promise<HTMLImageElement> {\r\n  return new Promise((resolve, reject) => {\r\n    let assetsManager = new BABYLON.AssetsManager(global.scene);\r\n    let task = assetsManager.addImageTask('_r.preload.task' + counter++, image);\r\n    task.onSuccess = function(task) {\r\n      if (patch) {\r\n        return select(task.image).patch(patch).then(() => {\r\n          resolve(task.image);\r\n        });\r\n      }\r\n      else {\r\n        resolve(task.image);\r\n      }\r\n    };\r\n    task.onError = function(task, message, exception) {\r\n      console.error(message, exception);\r\n      reject(message);\r\n    };\r\n    assetsManager.load();\r\n  });\r\n};\r\n\r\nload.assets = function(scene : string, patch? : any, progress? : (event : BABYLON.SceneLoaderProgressEvent) => any) : Promise<BABYLON.AssetContainer> {\r\n  let fileName = scene.split('/').pop();\r\n  let root = scene.replace(fileName, '');\r\n  BABYLON.SceneLoader.ShowLoadingScreen = false;\r\n  return BABYLON.SceneLoader.LoadAssetContainerAsync(root, fileName, global.scene, progress).then((assetsContainer) => {\r\n    if (patch) {\r\n      return select(assetsContainer).globalPatch(patch).then(() => {\r\n        BABYLON.SceneLoader.ShowLoadingScreen = true;\r\n        return assetsContainer;\r\n      });\r\n    }\r\n    else {\r\n      BABYLON.SceneLoader.ShowLoadingScreen = true;\r\n      return assetsContainer;\r\n    }\r\n  });\r\n};\r\n\r\nload.material = function(name : string, patch? : any) : Promise<BABYLON.StandardMaterial> {\r\n  let material = new BABYLON.StandardMaterial(name, global.scene);\r\n  return select(material).patch(patch).then(() => {\r\n    return material;\r\n  });\r\n};\r\n\r\nload.pbr = function(name : string, patch? : any) : Promise<BABYLON.PBRMaterial> {\r\n  let material =  new BABYLON.PBRMaterial(name, global.scene);\r\n  return select(material).patch(patch).then(() => {\r\n    return material;\r\n  });\r\n};\r\n\r\nload.texture = function(image : string, patch? : any) : Promise<BABYLON.Texture> {\r\n  return load(image).then((img) => {\r\n    let texture = new BABYLON.Texture(image, global.scene);\r\n    if (patch) {\r\n      return select(texture).patch(patch).then(() => {\r\n        return texture;\r\n      });\r\n    }\r\n    else {\r\n      return texture;\r\n    }\r\n  }, (err) => {\r\n    console.error(err);\r\n  });\r\n};\r\n\r\nlet cubeCounter = 0;\r\nload.cubeTexture = function(url : string, patch? : any) : Promise<BABYLON.CubeTexture> {\r\n  return new Promise((resolve, reject) => {\r\n    let assetsManager = new BABYLON.AssetsManager(global.scene);\r\n    let task = assetsManager.addCubeTextureTask('_r.load.cubeTexture.' + cubeCounter++, url);\r\n    task.onSuccess = function(task) {\r\n      if (patch) {\r\n        return select(task.texture).patch(patch);\r\n      }\r\n      else {\r\n        return task.texture;\r\n      }\r\n    };\r\n    task.onError = function(reason) {\r\n      reject(reason);\r\n    };\r\n    assetsManager.load();\r\n  });\r\n};\r\n\r\nload.patch = function(file : string) : Promise<any> {\r\n  return new Promise((resolve, reject) => {\r\n    let xhr = new XMLHttpRequest();\r\n    xhr.open(\"get\", file, true);\r\n    xhr.onload = function() {\r\n      let status = xhr.status;\r\n      if (status == 200) {\r\n        let data;\r\n        let isJson = false;\r\n        try {\r\n          data = JSON.parse(xhr.response);\r\n          isJson = true;\r\n        }\r\n        catch (error) {\r\n          isJson = false;\r\n        }\r\n        if (!isJson) {\r\n          try {\r\n            data = window[\"eval\"].call(window, xhr.response);\r\n          }\r\n          catch (error) {\r\n            let __patch;\r\n            eval('var __patch = ' + xhr.response);\r\n            data = __patch;\r\n          }\r\n        }\r\n        if (data) {\r\n          resolve(data);\r\n        }\r\n        else {\r\n          console.warn('BABYLON.Runtime::no data found in ' + file);\r\n          resolve([{}]);\r\n        }\r\n\r\n      } else {\r\n        reject(status);\r\n      }\r\n    };\r\n    xhr.send();\r\n  });\r\n};\r\n\r\nlet ajaxCounter = 0;\r\nload.ajax = function(file : string) : Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    let assetsManager = new BABYLON.AssetsManager(global.scene);\r\n    let task = assetsManager.addTextFileTask('_r.load.ajax.' + ajaxCounter++, file);\r\n    task.onSuccess = function(task) {\r\n     resolve(task.text);\r\n    };\r\n    task.onError = function(reason) {\r\n      reject(reason);\r\n    };\r\n    assetsManager.load();\r\n  });\r\n};\r\n\r\nload.JSON = function(file : string) : Promise<any> {\r\n  return new Promise((resolve, reject) => {\r\n    load.ajax(file).then((text : string) => {\r\n      try {\r\n        let data = JSON.parse(text);\r\n        resolve(data);\r\n      }\r\n      catch (e) {\r\n        reject(e);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nload.script = function(file : string) : Promise<null> {\r\n  return new Promise((resolve, reject) => {\r\n    // Adding the script tag to the head as suggested before\r\n    let script = document.createElement('script');\r\n    script.type = 'text/javascript';\r\n    script.src = file;\r\n\r\n    // Then bind the event to the callback function.\r\n    // There are several events for cross browser compatibility.\r\n    let resolved = false;\r\n    script['onreadystatechange'] = function() {\r\n      if (this.readyState === 'complete') {\r\n        if (resolved) {\r\n          return;\r\n        }\r\n        resolve();\r\n        resolved = true;\r\n      }\r\n    };\r\n    script.onload = function() {\r\n      if (resolved) {\r\n        return;\r\n      }\r\n      resolve();\r\n      resolved = true;\r\n    };\r\n    // Fire the loading\r\n    document.body.appendChild(script);\r\n  });\r\n};\r\n\r\nload.css = function(file : string) : Promise<null> {\r\n  return new Promise((resolve, reject) => {\r\n    // Adding the script tag to the head as suggested before\r\n    let link = document.createElement('link');\r\n    link.type = 'text/css';\r\n    link.href = file;\r\n    link.rel = 'stylesheet';\r\n\r\n    // Then bind the event to the callback function.\r\n    // There are several events for cross browser compatibility.\r\n    let resolved = false;\r\n    link['onreadystatechange'] = function() {\r\n      if (this.readyState === 'complete') {\r\n        if (resolved) {\r\n          return;\r\n        }\r\n        resolve();\r\n        resolved = true;\r\n      }\r\n    };\r\n    link.onload = function() {\r\n      if (resolved) {\r\n        return;\r\n      }\r\n      resolve();\r\n      resolved = true;\r\n    };\r\n    // Fire the loading\r\n    document.head.appendChild(link);\r\n  });\r\n};\r\n","import * as plugins from './patchPlugin.js';\r\nimport { is } from '../is.js';\r\nimport { Elements, find } from \"../Elements.js\";\r\nimport { global } from \"../global.js\";\r\nimport { load } from \"../load.js\";\r\n\r\nexport function recursive(elements, func, promisify = true) : any {\r\n  let index = 0;\r\n  function recurse() {\r\n    if (index === elements.length) {\r\n      return;\r\n    }\r\n    else {\r\n      let item = elements[index++];\r\n      try {\r\n        let res = func(item);\r\n        if (is.Promise(res)) {\r\n          return res.then(() => {\r\n            return recurse();\r\n          });\r\n        }\r\n        else {\r\n          return recurse();\r\n        }\r\n      }\r\n      catch (ex) {\r\n        return recurse();\r\n      }\r\n    }\r\n  }\r\n  let res = recurse();\r\n  if (is.Promise(res)) {\r\n    return res;\r\n  }\r\n  else {\r\n    // Promisify\r\n    if (promisify) {\r\n      return new Promise((resolve) => {\r\n        resolve();\r\n      });\r\n    }\r\n    else {\r\n      return res;\r\n    }\r\n  }\r\n}\r\n\r\nfunction globalPatchItem(patch : any, elements? : any) {\r\n  if (is.PatchFile(patch)) {\r\n    return load.patch(patch).then((data) => {\r\n      return globalPatch(data);\r\n    });\r\n  }\r\n  else {\r\n    let selectors = Object.getOwnPropertyNames(patch);\r\n    let res = recursive(selectors, (selector) => {\r\n      if (elements) {\r\n        let plugin = plugins.getPlugin(elements, patch, selector);\r\n        if (plugin) {\r\n          return plugin.resolve(elements, patch, selector);\r\n        }\r\n      }\r\n      else {\r\n        let plugin = plugins.getPlugin(global.scene, patch, selector);\r\n        if (plugin) {\r\n          return plugin.resolve(global.scene, patch, selector);\r\n        }\r\n      }\r\n      //console.log(\"call to find\", selector, elements);\r\n      let _elements;\r\n      if (elements) {\r\n        _elements = find(selector, elements);\r\n      }\r\n      else {\r\n        _elements = find(selector, global.scene);\r\n      }\r\n      return patchElements(_elements.toArray(), patch[selector]);\r\n    }, false);\r\n    return res;\r\n  }\r\n}\r\n\r\nexport function globalPatch(patch : any, elements? : any) {\r\n  if (!elements) {\r\n    //elements = global.scene;\r\n  }\r\n  if (!is.Array(patch)) {\r\n    patch = [patch];\r\n  }\r\n  return recursive(patch, (_patch) => {\r\n   return globalPatchItem(_patch, elements);\r\n  }, false);\r\n}\r\n\r\nexport function patchElements(elements : Array<any>, patch : any, context? : Array<any>) {\r\n  return recursive(elements, (element) => {\r\n    return patchElement(element, patch, context);\r\n  }, false);\r\n}\r\n\r\nexport function patchElement(element : any, patch : any, context? : Array<any>) : any {\r\n  let properties = Object.getOwnPropertyNames(patch);\r\n  return recursive(properties, (property) => {\r\n    if (context) {\r\n      context.push(element);\r\n    }\r\n    else {\r\n      context = [element];\r\n    }\r\n    return patchProperty(element, patch, property, context);\r\n  }, false);\r\n}\r\n\r\nexport function patchProperty(element, source, property, context? : Array<any>) : any {\r\n  let plugin = plugins.getPlugin(element, source, property);\r\n  if (plugin) {\r\n    return plugin.resolve(element, source, property, context);\r\n  }\r\n  else {\r\n    if (is.Primitive(source[property])) {\r\n      element[property] = source[property];\r\n      return element[property];\r\n    }\r\n    if (is.Function(source[property])) {\r\n      if (is.Function(element[property])) {\r\n        element[property] = source[property];\r\n        return element[property];\r\n      }\r\n      else {\r\n        let res = source[property].apply(element, context);\r\n        if (is.Promise(res)) {\r\n          return res.then((value) => {\r\n            if (value) {\r\n              element[property] = value;\r\n            }\r\n          });\r\n        }\r\n        else {\r\n          element[property] = res;\r\n          return element[property];\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      if (is.Promise(source[property])) {\r\n        return source[property].then((result) => {\r\n          element[property] = result;\r\n        });\r\n      }\r\n      else {\r\n        if (is.PlainObject(source[property])) {\r\n          if (!element[property]) {\r\n            element[property] = {};\r\n          }\r\n          return patchElement(element[property], source[property], context);\r\n        }\r\n      }\r\n\r\n    }\r\n  }\r\n}","import { is } from '../is.js';\r\n\r\nexport function color(expr: any): BABYLON.Color3 | BABYLON.Color4 {\r\n  if (expr instanceof BABYLON.Color3 || expr instanceof BABYLON.Color4) {\r\n    return expr;\r\n  }\r\n  if (is.HexColor(expr)) {\r\n    return BABYLON.Color3.FromHexString(expr);\r\n  }\r\n  if (is.PlainObject(expr)) {\r\n    if (expr.hasOwnProperty(\"r\") || expr.hasOwnProperty(\"g\") || expr.hasOwnProperty(\"b\") || expr.hasOwnProperty(\"a\")) {\r\n      let r = expr[\"r\"] || 0;\r\n      let g = expr[\"g\"] || 0;\r\n      let b = expr[\"b\"] || 0;\r\n      if (expr[\"a\"]) {\r\n        return new BABYLON.Color4(r, g, b, expr[\"a\"]);\r\n      } else {\r\n        return new BABYLON.Color3(r, g, b);\r\n      }\r\n    } else {\r\n      console.error(\"_r.to.Color - invalid color : \", expr);\r\n      return new BABYLON.Color3(0, 0, 0);\r\n    }\r\n  }\r\n  if (is.Array(expr)) {\r\n    if (expr.length == 3) {\r\n      return BABYLON.Color3.FromArray(expr);\r\n    }\r\n    if (expr.length == 4) {\r\n      return BABYLON.Color4.FromArray(expr);\r\n    }\r\n    console.error(\"_r.to.Color - invalid color : \", expr);\r\n    return new BABYLON.Color3(0, 0, 0);\r\n  }\r\n  if (is.String(expr)) {\r\n    expr = expr.trim().toLocaleLowerCase();\r\n    if (expr.indexOf('rgb(') == 0) {\r\n      var rgb = expr.substring(expr.indexOf('(') + 1, expr.lastIndexOf(')')).split(/,\\s*/);\r\n\r\n      let r = parseFloat(rgb[0]);\r\n      let g = parseFloat(rgb[1]);\r\n      let b = parseFloat(rgb[2]);\r\n      return new BABYLON.Color3(!isNaN(r) ? (r / 255) : 0, !isNaN(g) ? (g / 255) : 0, !isNaN(b) ? (b / 255) : 0);\r\n    } else {\r\n      if (expr.indexOf('rgba(') == 0) {\r\n        var rgba = expr.substring(expr.indexOf('(') + 1, expr.lastIndexOf(')')).split(/,\\s*/);\r\n        let r = parseFloat(rgba[0]);\r\n        let g = parseFloat(rgba[1]);\r\n        let b = parseFloat(rgba[2]);\r\n        let a = parseFloat(rgba[3]);\r\n        return new BABYLON.Color4(!isNaN(r) ? (r / 255) : 0, !isNaN(g) ? (g / 255) : 0, !isNaN(b) ? (b / 255) : 0, !isNaN(a) ? (a / 255) : 0);\r\n      } else {\r\n        switch (expr) {\r\n          case 'red' :\r\n            return BABYLON.Color3.Red();\r\n          case 'green' :\r\n            return BABYLON.Color3.Green();\r\n          case 'blue' :\r\n            return BABYLON.Color3.Blue();\r\n          case 'black' :\r\n            return BABYLON.Color3.Black();\r\n          case 'white' :\r\n            return BABYLON.Color3.White();\r\n          case 'purple' :\r\n            return BABYLON.Color3.Purple();\r\n          case 'magenta' :\r\n          case 'pink' :\r\n            return BABYLON.Color3.Magenta();\r\n          case 'yellow' :\r\n            return BABYLON.Color3.Yellow();\r\n          case 'teal' :\r\n          case 'cyan' :\r\n            return BABYLON.Color3.Teal();\r\n          case 'gray' :\r\n          case 'grey' :\r\n            return BABYLON.Color3.Gray();\r\n          case 'random':\r\n            return BABYLON.Color3.Random();\r\n          default :\r\n            console.error(\"_r.to.Color - invalid color : \", expr);\r\n            return new BABYLON.Color3(0, 0, 0);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function color4(expr: any) : BABYLON.Color4 {\r\n  let _color = color(expr);\r\n  return new BABYLON.Color4(_color.r, _color.g, _color.b, 1);\r\n}","import { is } from \"../is.js\";\r\nimport { select } from \"../select.js\";\r\nimport { global } from \"../global.js\";\r\nimport { start, isStarted } from \"../renderLoop.js\";\r\nimport { patchElements, patchElement, globalPatch } from \"./patchElement.js\";\r\nimport { registerPlugin } from \"./patchPlugin.js\";\r\nimport \"./plugins/index.js\";\r\nimport { load } from \"../load.js\";\r\n\r\nexport function patch(patch : any, promisify = true) : Promise<any> {\r\n  if (is.PatchFile(patch)) {\r\n    return load.patch(patch).then((data) => {\r\n      let res = globalPatch(data);\r\n      if (promisify && !is.Promise(res)) {\r\n        return new Promise((resolve) => {\r\n          resolve(res);\r\n        });\r\n      }\r\n      else {\r\n        return res;\r\n      }\r\n    });\r\n  }\r\n  else {\r\n    if (!is.Array(patch)) {\r\n      patch = [patch];\r\n    }\r\n    let res = globalPatch(patch);\r\n    if (promisify && !is.Promise(res)) {\r\n      return new Promise((resolve) => {\r\n        resolve(res);\r\n      });\r\n    }\r\n    else {\r\n      return res;\r\n    }\r\n  }\r\n}\r\n\r\npatch.registerPlugin = registerPlugin;\r\n\r\nexport { patchElement, patchElements };\r\n\r\nglobal.fn[\"patch\"] = function(options, promisify = true) {\r\n  let res = patchElements(this.toArray(), options);\r\n  if (promisify && !is.Promise(res)) {\r\n    return new Promise((resolve) => {\r\n      resolve(res);\r\n    });\r\n  }\r\n  else {\r\n    return res;\r\n  }\r\n};\r\n\r\nglobal.fn[\"globalPatch\"] = function(options, promisify = true) {\r\n  let res = globalPatch(options, this.toArray());\r\n  if (promisify && !is.Promise(res)) {\r\n    return new Promise((resolve) => {\r\n      resolve(res);\r\n    });\r\n  }\r\n  else {\r\n    return res;\r\n  }\r\n};","import { registerPlugin } from \"../patchPlugin.js\";\r\nimport { color } from \"../../util/color.js\";\r\nimport { is } from \"../../is.js\";\r\n\r\nregisterPlugin({\r\n  test(element, source, property) : boolean {\r\n    return !is.Function(source[property]) && element[property] instanceof BABYLON.Color3 || element[property] instanceof BABYLON.Color4;\r\n  },\r\n  resolve(element, source, property) {\r\n    element[property] = color(source[property]);\r\n    return element[property];\r\n  }\r\n});\r\n","import { registerPlugin } from \"../patchPlugin.js\";\r\nimport { patch, patchElements, patchElement } from \"../patch.js\";\r\nimport { is } from \"../../is.js\";\r\n\r\nregisterPlugin({\r\n  test(element, source, property) : boolean {\r\n    return property.trim() === \"*\";\r\n  },\r\n  resolve(element, source, property) {\r\n    if (is.MultiMaterial(element)) {\r\n      return patchElements(element.subMaterials, source[property], element);\r\n    }\r\n    else {\r\n      if (is.Array(element)) {\r\n        return patchElements(element, source[property]);\r\n      }\r\n      else {\r\n        return patchElement(element, source[property]);\r\n      }\r\n    }\r\n  }\r\n});\r\n","import { registerPlugin } from \"../patchPlugin.js\";\r\n\r\nregisterPlugin({\r\n  test(element, source, property) : boolean {\r\n    return [\"diffuseFresnelParameters\", \"opacityFresnelParameters\", \"emissiveFresnelParameters\", \"refractionFresnelParameters\", \"reflectionFresnelParameters\"].indexOf(property) !== -1\r\n      && !element.target[property];\r\n  },\r\n  resolve(element, source, property) {\r\n    return new BABYLON.FresnelParameters();\r\n  }\r\n});","import { registerPlugin } from \"../patchPlugin.js\";\r\nimport { is } from \"../../is.js\";\r\nimport { global } from \"../../global.js\";\r\n\r\nregisterPlugin({\r\n  test(element, source, property) : boolean {\r\n    return property === \"execute\" || property === \"exec\";\r\n  },\r\n  resolve(element, source, property, context) {\r\n    try {\r\n      let func = source[property];\r\n      if (element) {\r\n        return func.apply(element, context);\r\n      }\r\n      else {\r\n        return func.apply(global.scene, context);\r\n      }\r\n    }\r\n    catch (ex) {\r\n      console.error(ex);\r\n    }\r\n  }\r\n});","import { registerPlugin } from \"../patchPlugin.js\";\r\nimport { is } from \"../../is.js\";\r\nimport { global } from \"../../global.js\";\r\nimport { globalPatch } from \"../patchElement.js\";\r\n\r\nregisterPlugin({\r\n  test(element, source, property) : boolean {\r\n    return property === \"scene\";\r\n  },\r\n  resolve(element, source, property) {\r\n    if (is.Function(source[property])) {\r\n      try {\r\n       global.scene = source[property]();\r\n      }\r\n      catch (ex) {\r\n        console.error(ex);\r\n      }\r\n    }\r\n    else {\r\n      return globalPatch(source[property], element);\r\n    }\r\n  }\r\n});","import { registerPlugin } from \"../patchPlugin.js\";\r\nimport { is } from \"../../is.js\";\r\nimport { global } from \"../../global.js\";\r\nimport { globalPatch } from \"../patchElement.js\";\r\nimport { select } from \"../../select.js\";\r\n\r\nregisterPlugin({\r\n  test(element, source, property) : boolean {\r\n    return property === \"data\";\r\n  },\r\n  resolve(element, source, property, context) {\r\n    let data = source[property];\r\n    let properties = Object.getOwnPropertyNames(data);\r\n    let x = {};\r\n    properties.forEach((property) => {\r\n      let _patch = data[property];\r\n      if (is.Function(_patch)) {\r\n        console.log(element, context);\r\n        x[property] = function() {\r\n          return _patch.apply(element, context);\r\n        };\r\n        select(element).data(property, x[property]);\r\n      }\r\n      else {\r\n        x[property] = _patch;\r\n        select(element).data(property, _patch);\r\n      }\r\n    });\r\n  }\r\n});","import { registerPlugin } from \"../patchPlugin.js\";\r\nimport { is } from \"../../is.js\";\r\nimport { global } from \"../../global.js\";\r\nimport { globalPatch } from \"../patchElement.js\";\r\nimport { select } from \"../../select.js\";\r\n\r\nregisterPlugin({\r\n  test(element, source, property) : boolean {\r\n    return [\"on\", \"off\", \"trigger\", \"one\"].indexOf(property) != -1;\r\n  },\r\n  resolve(element, source, property, context) {\r\n    switch (property) {\r\n      case \"on\" :\r\n        Object.getOwnPropertyNames(source[property]).forEach(function(event) {\r\n          let handler = source[property][event];\r\n          if (is.Function(handler)) {\r\n            return select(element).on(event, handler);\r\n          }\r\n          else {\r\n            select(element).on(event, function() {\r\n              return select(element).patch(source[property][event]);\r\n            });\r\n          }\r\n        });\r\n        break;\r\n      case \"off\" :\r\n        if (is.String(source[property])) {\r\n          return select(element).off(source[property]);\r\n        }\r\n        else {\r\n          Object.getOwnPropertyNames(source[property]).forEach(function(event) {\r\n            select(element).off(event, source[property][event]);\r\n          });\r\n        }\r\n        break;\r\n      case \"trigger\" :\r\n        if (is.String(source[property])) {\r\n            return select(element).trigger(source[property]);\r\n        }\r\n        else {\r\n          Object.getOwnPropertyNames(source[property]).forEach(function(event) {\r\n            return select(element).trigger(event, source[property][event]);\r\n          });\r\n        }\r\n        break;\r\n      case \"one\":\r\n        Object.getOwnPropertyNames(source[property]).forEach(function(event) {\r\n          let handler = source[property][event];\r\n          if (is.Function(handler)) {\r\n            return select(element).one(event, handler);\r\n          }\r\n          else {\r\n            select(element).one(event, function() {\r\n              return select(element).patch(source[property][event]);\r\n            });\r\n          }\r\n        });\r\n        break;\r\n    }\r\n  }\r\n});","import { registerPlugin } from \"../patchPlugin.js\";\r\nimport { is } from \"../../is.js\";\r\nimport { global } from \"../../global.js\";\r\nimport { select } from \"../../select.js\";\r\n\r\nregisterPlugin({\r\n  test(element, source, property) : boolean {\r\n    return false;\r\n    //return source[property] && is.String(source[property]) && (is.Material(element) || is.Texture(element));\r\n  },\r\n  resolve(element, source, property, context) {\r\n    /**\r\n    if (is.Material(element)) {\r\n      let elements = select(source[property] + ':material');\r\n      if (elements.length != 0) {\r\n        element = elements[0];\r\n      }\r\n    }\r\n    if (is.Texture(element)) {\r\n      let elements = select(source[property] + ':texture');\r\n      if (elements.length != 0) {\r\n        element = elements[0];\r\n      }\r\n    }**/\r\n  }\r\n});","import { registerPlugin } from \"../patchPlugin.js\";\r\nimport { is } from \"../../is.js\";\r\nimport { global } from \"../../global.js\";\r\nimport { patch } from \"../patch.js\";\r\nimport { select } from \"../../select.js\";\r\nregisterPlugin({\r\n  test(element, source, property) : boolean {\r\n    return property === \"patchParallel\";\r\n  },\r\n  resolve(element, source, property, context) {\r\n    let promises = [];\r\n    if (element) {\r\n      source[property].forEach((_patch) => {\r\n        console.log(\"push\", _patch);\r\n        promises.push(select(element).patch(_patch));\r\n      });\r\n    }\r\n    else {\r\n      source[property].forEach((_patch) => {\r\n        promises.push(patch(_patch));\r\n      });\r\n    }\r\n    console.log(\"call to patchParallel\", promises);\r\n    return Promise.all(promises);\r\n  }\r\n});","import { global } from \"../global.js\";\r\n\r\ninterface ICustomLoadingScreen {\r\n  isVisible : boolean;\r\n  message : string;\r\n  progress : number;\r\n  postMessage? : Function;\r\n}\r\n\r\nexport class iFrameLoadingScreen {\r\n  public iframe : HTMLIFrameElement;\r\n  private _attached = false;\r\n  private _message : string;\r\n  private _progress : number;\r\n  private _contentDocument;\r\n  constructor(url : string, id? : string) {\r\n    this.iframe = document.createElement('iframe');\r\n    this.iframe.src = url;\r\n    if (id) {\r\n      this.iframe.id = id;\r\n    }\r\n    this.iframe.addEventListener('transitionend', () => {\r\n      if (!this.isVisible) {\r\n        this.parentNode.removeChild(this.iframe);\r\n        this._attached = false;\r\n      }\r\n    });\r\n    this.iframe.classList.add('runtime-loadingScreen');\r\n  }\r\n  private get parentNode() {\r\n    return global.canvas.parentNode;\r\n  }\r\n  displayLoadingUI() {\r\n    if (!this._attached) {\r\n      this.iframe.onload = () => {\r\n        if (this.iframe.contentDocument) {\r\n          this._contentDocument = this.iframe.contentDocument;\r\n        } else {\r\n          this._contentDocument =  this.iframe.contentWindow.document;\r\n        }\r\n        this.message = this._message;\r\n        if (this._progress) {\r\n          this.progress = this._progress;\r\n        }\r\n      };\r\n      this.parentNode.appendChild(this.iframe);\r\n      this._attached = true;\r\n    }\r\n    this.iframe.classList.add('visible');\r\n  }\r\n  hideLoadingUI() {\r\n    this.iframe.classList.remove('visible');\r\n  }\r\n  get isVisible() {\r\n    return this.iframe.classList.contains('visible');\r\n  }\r\n  set isVisible(value : boolean) {\r\n    if (value) {\r\n      this.displayLoadingUI();\r\n    }\r\n    else {\r\n      this.hideLoadingUI();\r\n    }\r\n  }\r\n  get message() {\r\n    return this._message;\r\n  }\r\n  set message(value : string) {\r\n    this._message = value;\r\n    if (this._contentDocument) {\r\n      let elements = this._contentDocument.getElementsByClassName('runtime-loading-message');\r\n      for (let i = 0; i < elements.length; i++) {\r\n        elements.item(i).innerHTML = value;\r\n      }\r\n      this.postMessage({\r\n        type : \"message\",\r\n        value : value\r\n      });\r\n    }\r\n  }\r\n  get progress() {\r\n    return this._progress;\r\n  }\r\n  set progress(value : number) {\r\n    this._progress = value;\r\n    if (this._contentDocument) {\r\n      let elements = this._contentDocument.getElementsByClassName('runtime-loading-progress');\r\n      for (let i = 0; i < elements.length; i++) {\r\n        elements.item(i).innerHTML = value.toString() + '%';\r\n      }\r\n      this.postMessage({\r\n        type : \"progress\",\r\n        value : value\r\n      });\r\n    }\r\n  }\r\n  public postMessage(data) {\r\n    setTimeout(() => {\r\n      let json = JSON.stringify(data);\r\n      this.iframe.contentWindow.postMessage(json.toString(), location.origin);\r\n    }, 100);\r\n  }\r\n}\r\n\r\nexport class loadingScreen  {\r\n  private static _instance : ICustomLoadingScreen;\r\n  private static get instance() : ICustomLoadingScreen {\r\n    return this._instance;\r\n  }\r\n  static iframe(url : string, id? : string) {\r\n    this.activate(new iFrameLoadingScreen(url, id));\r\n    global.engine.loadingScreen = this._instance;\r\n    return this._instance;\r\n  }\r\n  static activate(loadingScreen) {\r\n    this._instance = loadingScreen;\r\n  }\r\n  static get isVisible() : boolean {\r\n    if (this._instance) {\r\n      return this._instance.isVisible;\r\n    }\r\n    else {\r\n      let div = document.getElementById('babylonjsLoadingDiv');\r\n      if (div) {\r\n        return div.style.opacity === '1';\r\n      }\r\n      else {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n  static set isVisible(value : boolean) {\r\n    if (this._instance) {\r\n      this._instance.isVisible = value;\r\n    }\r\n    else {\r\n      if (value) {\r\n        let div = document.getElementById('babylonjsLoadingDiv');\r\n        if (div && div.style.opacity === '0') {\r\n          div.style.opacity = '1';\r\n        }\r\n        global.engine.displayLoadingUI();\r\n      }\r\n      else {\r\n        global.engine.hideLoadingUI();\r\n      }\r\n    }\r\n  }\r\n  static get message() : string {\r\n    if (this._instance) {\r\n       return this._instance.message;\r\n    }\r\n    else {\r\n      return global.engine.loadingScreen.loadingUIText;\r\n    }\r\n  }\r\n  static set message(value : string) {\r\n    if (this._instance) {\r\n      this.instance.message = value;\r\n    }\r\n    else {\r\n      global.engine.loadingScreen.loadingUIText = value;\r\n    }\r\n  }\r\n  static get progress() : number {\r\n    if (this._instance) {\r\n      return this.instance.progress;\r\n    }\r\n    else {\r\n      console.error(\"TODO _r.loadingScreen\");\r\n    }\r\n  }\r\n  static set progress(value : number) {\r\n    if (this._instance) {\r\n      this.instance.progress = value;\r\n    }\r\n    else {\r\n      this.message += ' ' + value + '%';\r\n    }\r\n  }\r\n  static postMessage(key, value) {\r\n    if (this._instance.postMessage) {\r\n      this._instance.postMessage(key, value);\r\n    }\r\n    else {\r\n      console.error('loadingScreen is not an iframe');\r\n    }\r\n  }\r\n}\r\n","import { is } from \"./is.js\";\r\nimport { extend }  from \"./util/extend.js\";\r\nimport { global } from \"./global.js\";\r\nimport { activateCamera } from \"./activateCamera.js\";\r\nimport { downloadScene } from \"./download.js\";\r\nimport { patch } from \"./patch/patch.js\";\r\nimport { load } from \"./load.js\";\r\nimport { loadingScreen }  from \"./util/loadingScreen.js\";\r\n\r\nlet isReady = false;\r\nlet callbacks = [];\r\n\r\nexport interface IRuntimeLoading {\r\n  container? : string | HTMLElement;\r\n  canvas?: string | HTMLCanvasElement;\r\n  assets?: string;\r\n  scene: Function | string;\r\n  activeCamera?: Function | string | any;\r\n  patch?: Array<any>;\r\n  beforeFirstRender?: Function;\r\n  ktx?: boolean | Array<string>;\r\n  enableOfflineSupport?: boolean;\r\n  progress?: Function;\r\n  loadingScreen?: any;\r\n  load : string | Array<string>;\r\n}\r\n\r\nlet options : IRuntimeLoading = {\r\n  container : null,\r\n  canvas : null,\r\n  assets : null,\r\n  scene : null,\r\n  activeCamera : null,\r\n  patch : null,\r\n  ktx : false,\r\n  enableOfflineSupport : false,\r\n  progress: null,\r\n  loadingScreen: null,\r\n  load : null\r\n};\r\n\r\nexport function launch(obj: IRuntimeLoading | string) : Promise<BABYLON.Scene> {\r\n  isReady = false;\r\n  options = extend(options, obj);\r\n  // CANVAS\r\n  if (options.canvas) {\r\n    if (is.String(options.canvas)) {\r\n      let element = document.getElementById(<string> options.canvas);\r\n      if (is.DOM.canvas(element)) {\r\n        global.canvas = element;\r\n      }\r\n      else {\r\n        console.error(\"_r.launch - \" + options.canvas + \"is not a valid HTMLCanvasElement\");\r\n      }\r\n    }\r\n    else {\r\n      if (is.DOM.canvas(options.canvas)) {\r\n        global.canvas = options.canvas;\r\n      }\r\n      else {\r\n        console.error(\"_r.launch - canvas parameter should be a string or a HTMLCanvasElement\");\r\n      }\r\n    }\r\n  }\r\n  if (options.container) {\r\n    if (is.String(options.container)) {\r\n      let parent = document.getElementById(<string> options.container);\r\n      parent.appendChild(global.canvas);\r\n    }\r\n    else {\r\n      (<HTMLElement> options.container).appendChild(global.canvas);\r\n    }\r\n  }\r\n  else {\r\n    document.body.appendChild(global.canvas);\r\n  }\r\n\r\n  // KTX\r\n  if (options.ktx) {\r\n    if (is.Array(options.ktx)) {\r\n      global.engine.setTextureFormatToUse(<string[]> options.ktx);\r\n    }\r\n    else {\r\n      if (options.ktx === true) {\r\n        global.engine.setTextureFormatToUse(['-astc.ktx', '-dxt.ktx', '-pvrtc.ktx', '-etc2.ktx']);\r\n      }\r\n    }\r\n  }\r\n  // ENABLE OFFLINE SUPPORT\r\n  if (options.enableOfflineSupport) {\r\n    global.engine.enableOfflineSupport = options.enableOfflineSupport;\r\n  }\r\n  else {\r\n    global.engine.enableOfflineSupport = false;\r\n  }\r\n  // LOADING SCREEN\r\n  if (options.loadingScreen) {\r\n    global.engine.loadingScreen = options.loadingScreen;\r\n  }\r\n  loadingScreen.isVisible = true;\r\n  return new Promise((resolve, reject) => {\r\n    _createScene().then(() => {\r\n      _load().then(() => {\r\n        _patch().then(() => {\r\n          _checkActiveCamera();\r\n          _beforeFirstRender();\r\n          // RESIZE\r\n          window.addEventListener('resize', function() {\r\n            global.engine.resize();\r\n          });\r\n          global.engine.resize();\r\n          start();\r\n          isReady = true;\r\n          loadingScreen.isVisible = false;\r\n          callbacks.forEach(function(callback) {\r\n            try {\r\n              callback.call(global.scene);\r\n            }\r\n            catch (ex) {\r\n              console.error(ex);\r\n            }\r\n          });\r\n          callbacks.length = 0;\r\n          resolve(global.scene);\r\n        });\r\n      });\r\n    }, (err) => {\r\n      reject(err);\r\n    });\r\n  });\r\n}\r\n\r\nfunction _createScene() : Promise<any> {\r\n  if (options.scene) {\r\n    if (is.String(options.scene)) {\r\n      // scene is a filename\r\n      if (options.assets) {\r\n        return load.assets(options.assets + <string>options.scene, null, (evt : BABYLON.SceneLoaderProgressEvent) => {\r\n          if (options.progress) {\r\n            options.progress(evt);\r\n          }\r\n        }).then((assetsContainer) => {\r\n          assetsContainer.addAllToScene();\r\n        });\r\n        /**\r\n        return downloadScene({\r\n          scene: <string>options.scene,\r\n          assets: options.assets,\r\n          progress: options.progress\r\n        });**/\r\n      } else {\r\n        return load.assets(<string>options.scene, null, (evt : BABYLON.SceneLoaderProgressEvent) => {\r\n          if (options.progress) {\r\n            options.progress(evt);\r\n          }\r\n        }).then((assetsContainer) => {\r\n          assetsContainer.addAllToScene();\r\n        });\r\n        /**return downloadScene({\r\n          scene: <string>options.scene,\r\n          progress: options.progress\r\n        });**/\r\n      }\r\n    } else {\r\n      return new Promise((resolve, reject) => {\r\n        if (is.Function(options.scene)) {\r\n          try {\r\n            let result = eval(\"var canvas=_r.canvas; var engine = _r.engine; var scene=_r.scene; var createScene=\" + options.scene + ';createScene()');\r\n            if (BABYLON.Engine.LastCreatedEngine.scenes.length == 2) {\r\n              BABYLON.Engine.LastCreatedEngine.scenes[0].dispose();\r\n            }\r\n            if (is.Scene(result)) {\r\n              global.scene = result;\r\n            }\r\n            resolve();\r\n          } catch (ex) {\r\n            reject(ex);\r\n            throw ex;\r\n          }\r\n        } else {\r\n          if (is.Scene(options.scene)) {\r\n            global.scene = options.scene;\r\n            resolve();\r\n          } else {\r\n            reject(\"invalid scene parameter in _r.launch\");\r\n            throw new Error(\"invalid scene parameter in _r.launch\");\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction _patch() : Promise<null> {\r\n  if (options.patch) {\r\n    return patch(options.patch);\r\n  }\r\n  else {\r\n    return new Promise((resolve) => {\r\n      resolve();\r\n    });\r\n  }\r\n}\r\n\r\nfunction _load() : Promise<null> {\r\n  if (options.load) {\r\n    return load(options.load);\r\n  } else {\r\n    return new Promise((resolve) => {\r\n      resolve();\r\n    });\r\n  }\r\n}\r\n\r\nfunction _beforeFirstRender()  {\r\n  if (options.beforeFirstRender && is.Function(options.beforeFirstRender)) {\r\n    options.beforeFirstRender();\r\n  }\r\n}\r\n\r\nfunction _checkActiveCamera() {\r\n  if (is.String(options.activeCamera)) {\r\n    activateCamera(<string> options.activeCamera);\r\n  }\r\n  else {\r\n    if (is.Function(options.activeCamera)) {\r\n      try {\r\n        let camera = (<Function> options.activeCamera).call(global.scene);\r\n        activateCamera(camera.name);\r\n      }\r\n      catch (ex) {\r\n        console.error(\"_r.launch() error on activeCamera\", ex);\r\n      }\r\n    }\r\n    else {\r\n      if (is.Camera(options.activeCamera)) {\r\n        activateCamera(options.activeCamera.name);\r\n      }\r\n    }\r\n  }\r\n  if (!global.scene.activeCamera && global.scene.cameras.length > 0) {\r\n    activateCamera(global.scene.cameras[0].name);\r\n  }\r\n  if (global.scene.activeCamera && global.scene.activeCamera.inputs && !global.scene.activeCamera.inputs.attachedElement) {\r\n    global.scene.activeCamera.attachControl(global.canvas);\r\n  }\r\n}\r\n\r\nfunction loop() {\r\n  global.scene.render();\r\n}\r\n\r\nexport function start() {\r\n  global.engine.runRenderLoop(loop);\r\n}\r\n\r\nexport function pause() {\r\n  global.engine.stopRenderLoop(loop);\r\n}\r\n\r\nexport function ready(callback: Function) {\r\n  if (isReady) {\r\n    callback.call(global.scene);\r\n  }\r\n  else {\r\n    callbacks.push(callback);\r\n  }\r\n}","import { global } from \"./global.js\";\r\n\r\nfunction loop() {\r\n  global.scene.render();\r\n}\r\n\r\nexport function start() {\r\n  isStarted = true;\r\n  global.engine.runRenderLoop(loop);\r\n}\r\n\r\nexport function pause() {\r\n  isStarted = false;\r\n  global.engine.stopRenderLoop(loop);\r\n}\r\n\r\nexport let isStarted = false;","import { global } from \"./global.js\";\r\nimport { createLibrary } from \"./library.js\";\r\nimport { patch } from \"./patch/patch.js\";\r\nimport { select } from \"./select.js\";\r\n\r\nexport interface IDownloadAsyncOptions {\r\n  loadingScreen? : boolean;\r\n  ready? : Function;\r\n  progress? : Function;\r\n  error? : Function;\r\n}\r\n\r\nexport interface IDownloadSceneOptions extends IDownloadAsyncOptions{\r\n  scene? : string;\r\n  assets? : string;\r\n  patch? : any;\r\n  addAllToScene? : boolean;\r\n}\r\n\r\nexport interface IDownloadTextureOptions extends IDownloadAsyncOptions{\r\n  url? : string;\r\n  name? : string;\r\n  noMipmap? : boolean;\r\n  invertY? : boolean;\r\n  samplingMode? : number;\r\n}\r\n\r\nexport interface IDownloadCubeTextureOptions extends IDownloadAsyncOptions{\r\n  name? : string;\r\n  url? : string;\r\n  extensions? : string[];\r\n  noMipmap? : boolean;\r\n  files? : string[];\r\n}\r\n\r\nexport function downloadScene(options : IDownloadSceneOptions) {\r\n  let assets, fileName;\r\n  if (options.assets) {\r\n    assets = options.assets;\r\n    fileName = options.scene;\r\n  }\r\n  else {\r\n    fileName = options.scene.split('/').pop();\r\n    assets = options.scene.replace(fileName, '');\r\n  }\r\n  return new Promise((resolve, reject) => {\r\n    BABYLON.SceneLoader.LoadAssetContainerAsync(assets, fileName, global.scene, function(e) {\r\n      if (options.progress) {\r\n        options.progress(e);\r\n      }\r\n    }).then(function(assetContainer) {\r\n      // success\r\n      createLibrary(assets + fileName, assetContainer);\r\n      if (options.patch) {\r\n        try {\r\n          select(assetContainer).globalPatch(options.patch).then(function() {\r\n            if (options.addAllToScene !== false) {\r\n              assetContainer.addAllToScene();\r\n            }\r\n            if (options.ready) {\r\n              options.ready(assetContainer);\r\n            }\r\n            resolve(assetContainer);\r\n          });\r\n        }\r\n        catch (ex) {\r\n          reject(ex);\r\n        }\r\n      }\r\n      else {\r\n        if (options.addAllToScene !== false) {\r\n          assetContainer.addAllToScene();\r\n        }\r\n        if (options.ready) {\r\n          options.ready(assetContainer);\r\n        }\r\n        resolve(assetContainer);\r\n      }\r\n    }, function(reason) {\r\n      // error\r\n      if (options.error) {\r\n        options.error(reason);\r\n        reject(reason);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nexport function downloadTexture(options : IDownloadTextureOptions) {\r\n  return new Promise((resolve, reject) => {\r\n    let assetsManager = new BABYLON.AssetsManager(global.scene);\r\n    let task = assetsManager.addTextureTask(options.name, options.url, options.noMipmap, options.invertY, options.samplingMode);\r\n    task.onSuccess = function(task) {\r\n      resolve(task.texture);\r\n      if (options.ready) {\r\n        options.ready(task.texture);\r\n      }\r\n    };\r\n    task.onError = function(reason) {\r\n      reject(reason);\r\n      if (options.error) {\r\n        options.error(reason);\r\n      }\r\n    };\r\n    assetsManager.load();\r\n  });\r\n}\r\n\r\nexport function downloadCubeTexture(options : IDownloadCubeTextureOptions) {\r\n  return new Promise((resolve, reject) => {\r\n    let assetsManager = new BABYLON.AssetsManager(global.scene);\r\n    let task = assetsManager.addCubeTextureTask(options.name, options.url, options.extensions, options.noMipmap, options.files);\r\n    task.onSuccess = function(task) {\r\n      resolve(task.texture);\r\n      if (options.ready) {\r\n        options.ready(task.texture);\r\n      }\r\n    };\r\n    task.onError = function(reason) {\r\n      reject(reason);\r\n      if (options.error) {\r\n        options.error(reason);\r\n      }\r\n    };\r\n    assetsManager.load();\r\n  });\r\n}\r\n","import { global } from \"../global.js\";\r\nimport { data } from \"../data.js\";\r\nimport { trigger } from \"./core.js\";\r\n\r\nexport const keys = [\r\n  'OnKeyDownTrigger',\r\n  'OnKeyUpTrigger'\r\n];\r\n\r\n// see https://api.jquery.com/category/events/keyboard-events/\r\nexport function onKeyEvent(event : string,  handler: (args: any) => void, repeat = true) {\r\n  if (!global.scene.actionManager) {\r\n    global.scene.actionManager = new BABYLON.ActionManager(global.scene);\r\n  }\r\n  let action = new BABYLON.ExecuteCodeAction(BABYLON.ActionManager[event], (evt) => {\r\n    trigger(global.scene, event, evt);\r\n  });\r\n  global.scene.actionManager.registerAction(action);\r\n  let events = data(global.scene, \"_r.e\");\r\n  if (!events) {\r\n    data(global.scene, \"_r.e\", []);\r\n    events =  data(global.scene, \"_r.e\");\r\n  }\r\n  if (!events[event]) {\r\n    events[event] = [];\r\n  }\r\n  events[event].push({\r\n    handler: handler,\r\n    repeat: repeat,\r\n    action: action\r\n  });\r\n}\r\n\r\nexport function oneKeyEvent(event : string, handler: (args: any) => void) {\r\n  onKeyEvent(event, handler, false);\r\n}\r\n\r\nexport function offKeyEvent(event : string, handler?: (args: any) => void) {\r\n  let events = data(global.scene, '_r.e');\r\n  if (events[event]) {\r\n    if (handler) {\r\n      events[event] = events[event].filter(function(_event) {\r\n        if (_event.handler.toString() == handler.toString()) {\r\n          if (_event.action) {\r\n            let index = global.scene.actionManager.actions.indexOf(_event.action);\r\n            global.scene.actionManager.actions.splice(index, 1);\r\n          }\r\n          if (_event.listener) {\r\n            global.scene.removeEventListener(_event, _event.listener);\r\n          }\r\n        }\r\n        return _event.handler.toString() !== handler.toString();\r\n      });\r\n    }\r\n    else {\r\n\r\n      events[event] = [];\r\n    }\r\n  }\r\n}","import { global } from \"../global.js\";\r\nimport { data } from \"../data.js\";\r\nimport { trigger } from \"./core.js\";\r\n\r\nexport const meshes = [\r\n  'OnDoublePickTrigger',\r\n  'OnPickTrigger',\r\n  'OnLeftPickTrigger',\r\n  'OnRightPickTrigger',\r\n  'OnCenterPickTrigger',\r\n  'OnPickDownTrigger',\r\n  'OnPickUpTrigger',\r\n  'OnPickOutTrigger',\r\n  'OnLongPressTrigger',\r\n  'OnPointerOverTrigger',\r\n  'OnPointerOutTrigger'\r\n];\r\n\r\nexport function onMesh(mesh: BABYLON.Mesh, event: string, handler: (args: any) => void, repeat = true) {\r\n  if (!mesh.actionManager) {\r\n    mesh.actionManager = new BABYLON.ActionManager(global.scene);\r\n  }\r\n  let action = new BABYLON.ExecuteCodeAction(BABYLON.ActionManager[event], function(evt) {\r\n    trigger(mesh, event, evt);\r\n  });\r\n  if (!mesh.actionManager.hasSpecificTrigger(BABYLON.ActionManager[event])) {\r\n    mesh.actionManager.registerAction(action);\r\n  }\r\n  let events = data(mesh, \"_r.e\");\r\n  if (!events) {\r\n    data(mesh, \"_r.e\", []);\r\n    events = data(mesh, \"_r.e\");\r\n  }\r\n  if (!events[event]) {\r\n    events[event] = [];\r\n  }\r\n  events[event].push({\r\n    handler: handler,\r\n    repeat: repeat,\r\n    action: action\r\n  });\r\n}\r\n\r\nexport function oneMesh(mesh: BABYLON.Mesh, event: string, handler: (args: any) => void) {\r\n  onMesh(mesh, event, handler, false);\r\n}\r\n\r\nexport function offMesh(mesh: BABYLON.Mesh, event: string, handler?: (args: any) => void) {\r\n  let events = data(mesh, '_r.e');\r\n  if (events && events[event]) {\r\n    if (handler) {\r\n      events[event] = events[event].filter(function(_event) {\r\n        if (_event.handler.toString() == handler.toString()) {\r\n          if (_event.action) {\r\n            let index = mesh.actionManager.actions.indexOf(_event.action);\r\n            mesh.actionManager.actions.splice(index, 1);\r\n          }\r\n          /** ??\r\n          if (_event.listener) {\r\n            mesh.removeEventListener(_event, _event.listener);\r\n          }**/\r\n        }\r\n        return _event.handler.toString() !== handler.toString();\r\n      });\r\n    }\r\n    else {\r\n      events[event] = [];\r\n    }\r\n  }\r\n}","import * as e from \"./core.js\";\r\nimport { keys, offKeyEvent, oneKeyEvent, onKeyEvent } from \"./keys.js\";\r\nimport { onMesh, oneMesh, offMesh, meshes } from \"./meshes.js\";\r\nimport { global } from \"../global.js\";\r\nimport { is } from \"../is.js\";\r\n\r\nexport function on(event: string, handler: (...args: any[]) => void, repeat = true) {\r\n  if (keys.indexOf(event) != -1) {\r\n    onKeyEvent(event, handler, repeat);\r\n  }\r\n  else {\r\n    e.on(this, event, handler, repeat);\r\n  }\r\n}\r\n\r\nexport function off(event: string, handler?: (...args: any[]) => void) {\r\n  if (keys.indexOf(event) != -1) {\r\n    offKeyEvent(event, handler);\r\n  }\r\n  else {\r\n    e.off(this, event, handler);\r\n  }\r\n}\r\n\r\nexport function one(event: string, handler: (...args: any[]) => void) {\r\n  if (keys.indexOf(event) != -1) {\r\n    oneKeyEvent(event, handler);\r\n  }\r\n  else {\r\n    e.one(this, event, handler);\r\n  }\r\n}\r\nexport function trigger(event: string, ...extraParameters: any[]) {\r\n  e.trigger(this, event, ...extraParameters);\r\n}\r\n\r\n/**\r\n * Attach an event handler function for one or more e to the selected elements.\r\n * @param events One or more space-separated event types\r\n * @param handler A handler function previously attached for the event(s)\r\n * @returns {Elements}\r\n */\r\nglobal.fn[\"on\"] = function(events : string, handler : (args : any) => void) {\r\n  this.each(function(item) {\r\n    if (is.Mesh(item) && meshes.indexOf(events) !== -1) {\r\n      onMesh(item, events, handler);\r\n    }\r\n    else {\r\n      e.on(item, events, handler);\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Attach a handler to an event for the elements. The handler is executed at most once per element per event type.\r\n * @param events One or more space-separated event types\r\n * @param handler A handler function previously attached for the event(s)\r\n * @returns {Elements}\r\n */\r\nglobal.fn[\"one\"] = function(events : string, handler : (args : any) => void) {\r\n  this.each(function(item) {\r\n    if (is.Mesh(item) && meshes.indexOf(events) !== -1) {\r\n      oneMesh(item, events, handler);\r\n    }\r\n    else {\r\n      e.one(item, events, handler);\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Remove an event handler that were attached with .on()\r\n * @param events\r\n * @param handler A handler function previously attached for the event(s) or null to remove all handler attached for the event(s)\r\n * @returns {Elements}\r\n */\r\nglobal.fn[\"off\"] = function(events : string, handler? : (args : any) => void) {\r\n  this.each(function(item) {\r\n    if (is.Mesh(item) && meshes.indexOf(events) !== -1) {\r\n      offMesh(item, events, handler);\r\n    }\r\n    else {\r\n      e.off(item, events, handler);\r\n    }\r\n  });\r\n};\r\n/**\r\n * Execute all handlers and behaviors attached to the matched elements for the given event type.\r\n * @param events One or more space-separated event types\r\n * @param extraParameters Additional parameters to pass along to the event handler.\r\n * @returns {Elements}\r\n */\r\nglobal.fn[\"trigger\"] = function(events : string, ...extraParameters : any[]) {\r\n  this.each(function(item) {\r\n    e.trigger(item, events, ...extraParameters);\r\n  });\r\n};","import { is } from \"./is.js\";\r\nimport { select } from \"./select.js\";\r\nimport { extend } from \"./util/extend.js\";\r\nimport { color } from \"./util/color.js\";\r\nimport { patch } from \"./patch/patch.js\";\r\nimport { global } from \"./global.js\";\r\n\r\nfunction getEasingFunction(easing: string): BABYLON.EasingFunction {\r\n  let mode;\r\n  // rtec\r\n  let func;\r\n  if (easing.indexOf(\"easeInOut\") != -1) {\r\n    mode = BABYLON.EasingFunction.EASINGMODE_EASEINOUT;\r\n    func = easing.replace(\"easeInOut\", \"\");\r\n  } else {\r\n    if (easing.indexOf(\"easeIn\") != -1) {\r\n      mode = BABYLON.EasingFunction.EASINGMODE_EASEIN;\r\n      func = easing.replace(\"easeIn\", \"\");\r\n    } else {\r\n      if (easing.indexOf(\"easeOut\") != -1) {\r\n        mode = BABYLON.EasingFunction.EASINGMODE_EASEOUT;\r\n        func = easing.replace(\"easeOut\", \"\");\r\n      } else {\r\n        console.info(\"_r::unrecognized easing function \" + easing);\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n  let easingFunction;\r\n  switch (func) {\r\n    case \"Sine\":\r\n      easingFunction = new BABYLON.SineEase();\r\n      easingFunction.setEasingMode(mode);\r\n      return easingFunction;\r\n    case \"Quad\":\r\n      easingFunction = new BABYLON.QuadraticEase();\r\n      easingFunction.setEasingMode(mode);\r\n      return easingFunction;\r\n    case \"Cubic\":\r\n      easingFunction = new BABYLON.CubicEase();\r\n      easingFunction.setEasingMode(mode);\r\n      return easingFunction;\r\n    case \"Quart\":\r\n      easingFunction = new BABYLON.QuarticEase();\r\n      easingFunction.setEasingMode(mode);\r\n      return easingFunction;\r\n    case \"Quint\":\r\n      easingFunction = new BABYLON.QuinticEase();\r\n      easingFunction.setEasingMode(mode);\r\n      return easingFunction;\r\n    case \"Expo\" :\r\n      easingFunction = new BABYLON.ExponentialEase();\r\n      easingFunction.setEasingMode(mode);\r\n      return easingFunction;\r\n    case \"Circ\":\r\n      easingFunction = new BABYLON.CircleEase();\r\n      easingFunction.setEasingMode(mode);\r\n      return easingFunction;\r\n    case \"Back\":\r\n      easingFunction = new BABYLON.BackEase();\r\n      easingFunction.setEasingMode(mode);\r\n      return easingFunction;\r\n    case \"Elastic\":\r\n      easingFunction = new BABYLON.ElasticEase();\r\n      easingFunction.setEasingMode(mode);\r\n      return easingFunction;\r\n    case \"Bounce\":\r\n      easingFunction = new BABYLON.BounceEase();\r\n      easingFunction.setEasingMode(mode);\r\n      return easingFunction;\r\n    default:\r\n      console.warn(\"_r::unrecognized easing function \" + easing);\r\n      return null;\r\n  }\r\n}\r\n\r\nfunction getLoopMode(options : IAnimationOptions): number {\r\n  if (is.Boolean(options.loop)) {\r\n    if (options.loop) {\r\n      return BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT;\r\n    }\r\n  }\r\n  if (is.String(options.loop)) {\r\n    if ((<string> options.loop).toLowerCase() == \"cycle\") {\r\n      return BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE;\r\n    }\r\n    if ((<string>options.loop).toLocaleLowerCase() == \"relative\" || (<string>this.loop).toLocaleLowerCase() == \"pingpong\") {\r\n      return BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE;\r\n    }\r\n  } else {\r\n    if (is.Number(options.loop)) {\r\n      return <number>options.loop;\r\n    }\r\n  }\r\n  return BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT;\r\n}\r\n\r\nfunction getAnimationType(element, property) : number {\r\n  if (is.Vector2(element[property])) {\r\n    return BABYLON.Animation.ANIMATIONTYPE_VECTOR2;\r\n  }\r\n  if (is.Vector3(element[property])) {\r\n    return BABYLON.Animation.ANIMATIONTYPE_VECTOR3;\r\n  }\r\n  if (is.Number(element[property])) {\r\n    return BABYLON.Animation.ANIMATIONTYPE_FLOAT;\r\n  }\r\n  if (is.Color(element[property])) {\r\n    return BABYLON.Animation.ANIMATIONTYPE_COLOR3;\r\n  }\r\n  if (is.Quaternion(element[property])) {\r\n    return BABYLON.Animation.ANIMATIONTYPE_QUATERNION;\r\n  }\r\n  if (is.Matrix(element[property])) {\r\n    return BABYLON.Animation.ANIMATIONTYPE_MATRIX;\r\n  }\r\n  if (is.Size(element[property])) {\r\n    return BABYLON.Animation.ANIMATIONTYPE_SIZE;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction isAnimatable(element, property) {\r\n  return getAnimationType(element, property) !== null;\r\n}\r\n\r\nfunction getKeys(element, property, newValue, options) {\r\n  if (options.keys) {\r\n    return options.keys;\r\n  }\r\n  let initial = element[property];\r\n  let final;\r\n  switch (getAnimationType(element, property)) {\r\n    case BABYLON.Animation.ANIMATIONTYPE_COLOR3:\r\n      final = initial.clone();\r\n      select(final).patch(color(newValue));\r\n      break;\r\n    case BABYLON.Animation.ANIMATIONTYPE_FLOAT:\r\n      final = newValue;\r\n      break;\r\n    case BABYLON.Animation.ANIMATIONTYPE_MATRIX:\r\n      final = initial.clone();\r\n      select(final).patch(newValue);\r\n      break;\r\n    default:\r\n      final = initial.clone();\r\n      let properties = Object.getOwnPropertyNames(newValue);\r\n      properties.forEach((property) => {\r\n        final[property] = newValue[property];\r\n      });\r\n      break;\r\n  }\r\n  return [\r\n    {\r\n      frame: 0,\r\n      value: initial\r\n    },\r\n    {\r\n      frame: options.fps * options.duration,\r\n      value: final\r\n    }\r\n  ];\r\n}\r\n\r\nfunction getAnimationsForElement(element : any, patch : any, options : IAnimationOptions) : Array<BABYLON.Animation> {\r\n  let animations = [];\r\n  let properties = Object.getOwnPropertyNames(patch);\r\n  if (!element.animations) {\r\n    element.animations = [];\r\n  }\r\n  properties.forEach((property) => {\r\n    if (!isAnimatable(element, property)) {\r\n      console.error(property + \" is not animatable\");\r\n    }\r\n    else {\r\n      let animation = new BABYLON.Animation(\"_r.animation\" + element.animations.length, property, options.fps, getAnimationType(element, property), getLoopMode(options));\r\n      let keys = getKeys(element, property, patch[property], options);\r\n      animation.setKeys(keys);\r\n      if (options.easing) {\r\n        animation.setEasingFunction(getEasingFunction(options.easing));\r\n      }\r\n      // element.animations.push(animation);\r\n      animations.push(animation);\r\n    }\r\n  });\r\n  return animations;\r\n}\r\n\r\nfunction findSomethingToAnimate(element : any, patch : any) {\r\n  let properties = Object.getOwnPropertyNames(patch);\r\n  let animatables = [];\r\n  properties.forEach((property) => {\r\n    if (isAnimatable(element, property)) {\r\n      animatables.push({\r\n        element : element,\r\n        property : property,\r\n        patch : patch[property]\r\n      });\r\n    }\r\n    else {\r\n      if (!is.Primitive(patch[property])) {\r\n        let _animatables = findSomethingToAnimate(element[property], patch[property]);\r\n        animatables = animatables.concat(_animatables);\r\n      }\r\n      else {\r\n        return [];\r\n      }\r\n    }\r\n  });\r\n  return animatables;\r\n}\r\n\r\nexport interface IAnimationOptions {\r\n  fps?: number;\r\n  duration?: number;\r\n  speedRatio?: number;\r\n  from?: number;\r\n  to?: number;\r\n  loop?: boolean | string | number;\r\n  easing?: string;\r\n  complete?: () => void;\r\n  keys? : [];\r\n}\r\n\r\nconst defaultOptions = {\r\n  fps : 30,\r\n  duration : 0.4,\r\n  speedRatio : 1,\r\n  loopMode : false\r\n};\r\n\r\nfunction getOptions(options? : number | IAnimationOptions) {\r\n  let _options : IAnimationOptions = {};\r\n  if (!options) {\r\n    options = 0.4;\r\n  }\r\n  if (is.Number(options)) {\r\n    _options.duration = <number> options;\r\n    _options.loop = false;\r\n  }\r\n  else {\r\n    _options = <IAnimationOptions> options;\r\n    if (_options.loop) {\r\n      if (is.Boolean(_options.loop) && _options.loop) {\r\n        _options.loop = 'cycle';\r\n      }\r\n    }\r\n    else {\r\n      _options.loop = false;\r\n    }\r\n  }\r\n  _options = extend({}, defaultOptions, _options);\r\n  return _options;\r\n}\r\n\r\nlet count = 0;\r\n\r\nexport function animate(elements : any, patch : any, options? : number | IAnimationOptions) : BABYLON.AnimationGroup {\r\n  let _elements = select(elements);\r\n  let _options  = getOptions(options);\r\n  let group = new BABYLON.AnimationGroup(\"_r.animate.AnimationsGroup\" + count++);\r\n  _elements.each((item) => {\r\n    let _animatables = findSomethingToAnimate(item, patch);\r\n    _animatables.forEach((animatable) => {\r\n      let _element = animatable.element;\r\n      let _patch = {};\r\n      _patch[animatable.property] = animatable.patch;\r\n      let animations = getAnimationsForElement(_element, _patch, _options);\r\n      animations.forEach((animation) => {\r\n        group.addTargetedAnimation(animation, _element);\r\n      });\r\n    });\r\n  });\r\n  group.speedRatio = _options.speedRatio;\r\n  if (_options.complete) {\r\n    group.onAnimationGroupEndObservable.add(_options.complete);\r\n  }\r\n  group.onAnimationEndObservable.add((targetedAnimation) => {\r\n    let index = targetedAnimation.target.animations.indexOf(targetedAnimation.animation);\r\n    targetedAnimation.target.animations = targetedAnimation.target.animations.splice(index, 1);\r\n  });\r\n  if (_options.loop != false) {\r\n    group.play(true);\r\n  }\r\n  else {\r\n    group.play();\r\n  }\r\n\r\n  return group;\r\n}\r\n\r\nglobal.fn[\"animate\"] = function(patch : any, options? : number | IAnimationOptions) {\r\n  return animate(this.toArray(), patch, options);\r\n};\r\n\r\nglobal.fn[\"fadeOut\"] = function(options? : number | IAnimationOptions) {\r\n  let _options  = getOptions(options);\r\n  let group = new BABYLON.AnimationGroup(\"_r.animate.AnimationsGroup\" + count++);\r\n  this.each((item) => {\r\n    let animations = [];\r\n    if (is.Mesh(item)) {\r\n      animations = getAnimationsForElement(item, {\r\n        visibility : 0\r\n      }, _options);\r\n    }\r\n    if (is.Material(item)) {\r\n      animations = getAnimationsForElement(item, {\r\n        alpha : 0\r\n      }, _options);\r\n    }\r\n    if (is.Texture(item)) {\r\n      animations = getAnimationsForElement(item, {\r\n        level : 0\r\n      }, _options);\r\n    }\r\n    if (is.Light(item)) {\r\n      animations = getAnimationsForElement(item, {\r\n        intensity : 0\r\n      }, _options);\r\n    }\r\n    animations.forEach((animation) => {\r\n      group.addTargetedAnimation(animation, item);\r\n    });\r\n  });\r\n  group.speedRatio = _options.speedRatio;\r\n  if (_options.complete) {\r\n    group.onAnimationGroupEndObservable.add(_options.complete);\r\n  }\r\n  group.play();\r\n  return group;\r\n};\r\n\r\nglobal.fn[\"fadeIn\"] = function(options?) {\r\n  let _options  = getOptions(options);\r\n  let group = new BABYLON.AnimationGroup(\"_r.animate.AnimationsGroup\" + count++);\r\n  this.each((item) => {\r\n    let animations = [];\r\n    if (is.Mesh(item)) {\r\n      animations = getAnimationsForElement(item, {\r\n        visibility : 1\r\n      }, _options);\r\n    }\r\n    if (is.Material(item)) {\r\n      animations = getAnimationsForElement(item, {\r\n        alpha : 1\r\n      }, _options);\r\n    }\r\n    if (is.Texture(item)) {\r\n      animations = getAnimationsForElement(item, {\r\n        level : 1\r\n      }, _options);\r\n    }\r\n    if (is.Light(item)) {\r\n      animations = getAnimationsForElement(item, {\r\n        intensity : 1\r\n      }, _options);\r\n    }\r\n    animations.forEach((animation) => {\r\n      group.addTargetedAnimation(animation, item);\r\n    });\r\n  });\r\n  group.speedRatio = _options.speedRatio;\r\n  if (_options.complete) {\r\n    group.onAnimationGroupEndObservable.add(_options.complete);\r\n  }\r\n  group.play();\r\n  return group;\r\n};\r\n\r\n/**\r\n * Stop the currently-running animation, remove all queued animations, and complete all animations for the matched elements.\r\n */\r\nglobal.fn[\"finish\"] = function() {\r\n  this.each((item) => {\r\n    let animatables = global.scene.getAllAnimatablesByTarget(item);\r\n    animatables.forEach((animatable) => {\r\n      animatable.stop();\r\n    });\r\n    item.animations = [];\r\n  });\r\n};","import { select } from \"../select.js\";\r\nimport { is } from \"../is.js\";\r\nimport { global } from \"../global.js\";\r\n\r\n// Create utility layer the gizmo will be rendered on\r\nlet utilLayer;\r\n\r\nfunction initUtilLayer() {\r\n    if (!utilLayer) {\r\n        utilLayer = new BABYLON.UtilityLayerRenderer(global.scene);\r\n    }\r\n}\r\n\r\nfunction showMeshGizmo(mesh: BABYLON.Mesh, gizmoType?: string, axis?: string, color?: BABYLON.Color3) : BABYLON.Gizmo {\r\n    let gizmo;\r\n    gizmoType = (typeof gizmoType === 'string') ? gizmoType.toLowerCase() : gizmoType;\r\n    axis = (typeof axis === 'string') ? axis.toLowerCase() : axis;\r\n    hideMeshGizmo(mesh);\r\n    switch (gizmoType) {\r\n        case 'position':\r\n            gizmo = new BABYLON.PositionGizmo(utilLayer);\r\n            break;\r\n        case 'rotation':\r\n            gizmo = new BABYLON.RotationGizmo(utilLayer);\r\n            break;\r\n        case 'scale':\r\n            gizmo = new BABYLON.ScaleGizmo(utilLayer);\r\n            break;\r\n        case 'boundingbox':\r\n        default:\r\n            gizmo = new BABYLON.BoundingBoxGizmo(color, utilLayer);\r\n            break;\r\n    }\r\n    gizmo.attachedMesh = mesh;\r\n    if (axis && gizmo.xGizmo) {\r\n        console.info('_r : gizmo axis works only with BABYLON > 4.0.3, actual is: ' + BABYLON.Engine.Version);\r\n        gizmo.xGizmo.isEnabled = axis.indexOf('x') !== -1;\r\n        gizmo.yGizmo.isEnabled = axis.indexOf('y') !== -1;\r\n        gizmo.zGizmo.isEnabled = axis.indexOf('z') !== -1;\r\n        // Keep the gizmo fixed to world rotation\r\n        gizmo.updateGizmoRotationToMatchAttachedMesh = false;\r\n        gizmo.updateGizmoPositionToMatchAttachedMesh = true;\r\n    }\r\n    select(mesh).data('runtime-gizmo', gizmo);\r\n    return gizmo;\r\n}\r\n\r\nfunction hideMeshGizmo(mesh: BABYLON.Mesh) {\r\n    let gizmo = select(mesh).data('runtime-gizmo');\r\n    if (gizmo) {\r\n        gizmo.dispose();\r\n        select(mesh).data('runtime-gizmo', null);\r\n    }\r\n}\r\n\r\nexport function showGizmo(selector? : string, gizmoType?: string, axis?: string, _color =  new BABYLON.Color3(130 / 255, 230 / 255, 1)) : BABYLON.Gizmo[] {\r\n    let result = [];\r\n    initUtilLayer();\r\n    if (selector) {\r\n        select(selector).each((item) => {\r\n            if (is.Mesh(item)) {\r\n                result.push(showMeshGizmo(item, gizmoType, axis, _color));\r\n            }\r\n        });\r\n    }\r\n    else {\r\n        global.scene.meshes.forEach((mesh) => {\r\n            result.push(showMeshGizmo(mesh, gizmoType, axis, _color));\r\n        });\r\n    }\r\n    return result;\r\n}\r\n\r\nexport function hideGizmo(selector? : string) {\r\n    if (selector) {\r\n        select(selector).each((item) => {\r\n            if (is.Mesh(item)) {\r\n                hideMeshGizmo(item);\r\n            }\r\n        });\r\n    }\r\n    else {\r\n        global.scene.meshes.forEach((mesh) => {\r\n            hideMeshGizmo(mesh);\r\n        });\r\n    }\r\n}\r\n","import { showNormals, hideNormals } from \"./normals.js\";\r\nimport { showWireframe, hideWireframe } from \"./wireframe.js\";\r\nimport { showGizmo, hideGizmo } from \"./gizmo.js\";\r\n\r\nexport function show(params : string, selector? : string) {\r\n  let split = params.split(',');\r\n  split.forEach((param) => {\r\n    switch (param.trim()) {\r\n      case \"normals\" :\r\n        showNormals(selector);\r\n        break;\r\n      case \"wireframe\":\r\n        showWireframe(selector);\r\n        break;\r\n      case \"gizmo\":\r\n        showGizmo(selector);\r\n        break;\r\n      default:\r\n        console.error(param + \" is not supported by _r.show\");\r\n    }\r\n  });\r\n}\r\n\r\nexport function hide(params : string, selector? : string) {\r\n  let split = params.split(',');\r\n  split.forEach((param) => {\r\n    switch (param.trim()) {\r\n      case \"normals\" :\r\n        hideNormals(selector);\r\n        break;\r\n      case \"wireframe\":\r\n        hideWireframe(selector);\r\n        break;\r\n      case \"gizmo\":\r\n        hideGizmo(selector);\r\n        break;\r\n      default :\r\n        console.error(param + \" is not supported by _r.hide\");\r\n    }\r\n  });\r\n}\r\n\r\nexport namespace show {\r\n  export let normals = showNormals;\r\n  export let wireframe = showWireframe;\r\n  export let gizmo = showGizmo;\r\n}\r\n\r\nexport namespace hide{\r\n  export let normals = hideNormals;\r\n  export let wireframe = hideWireframe;\r\n  export let gizmo = hideGizmo;\r\n}\r\n","import { global } from \"../global.js\";\r\nimport { data } from \"../data.js\";\r\nimport { select } from \"../select.js\";\r\nimport { is } from \"../is.js\";\r\nimport { color } from \"../util/color.js\";\r\n\r\n// from https://doc.babylonjs.com/snippets/normals\r\nfunction showMeshNormals(mesh, size, _color) {\r\n  hideMeshNormals(mesh);\r\n  let normals = mesh.getVerticesData(BABYLON.VertexBuffer.NormalKind);\r\n  let positions = mesh.getVerticesData(BABYLON.VertexBuffer.PositionKind);\r\n  _color = color(_color);\r\n  size = size || 1;\r\n\r\n  let lines = [];\r\n  for (var i = 0; i < normals.length; i += 3) {\r\n    var v1 = BABYLON.Vector3.FromArray(positions, i);\r\n    var v2 = v1.add(BABYLON.Vector3.FromArray(normals, i).scaleInPlace(size));\r\n    lines.push([v1.add(mesh.position), v2.add(mesh.position)]);\r\n  }\r\n  var normalLines = BABYLON.MeshBuilder.CreateLineSystem(\"_r.normals.\" + mesh.uniqueId, {lines: lines}, global.scene);\r\n  normalLines.color = _color;\r\n  data(mesh, '_r.normals', normalLines);\r\n  return normalLines;\r\n}\r\n\r\nfunction hideMeshNormals(mesh) {\r\n  let normalLines = data(mesh, '_r.normals');\r\n  if (normalLines) {\r\n    normalLines.dispose();\r\n  }\r\n}\r\n\r\nexport function showNormals(selector? : string, size = 1, color = \"red\") {\r\n  if (selector) {\r\n    select(selector).each((item) => {\r\n      if (is.Mesh(item)) {\r\n        showMeshNormals(item, size, color);\r\n      }\r\n    });\r\n  }\r\n  else {\r\n    global.scene.meshes.forEach((mesh) => {\r\n      showMeshNormals(mesh, size, color);\r\n    });\r\n  }\r\n}\r\n\r\nexport function hideNormals(selector? : string) {\r\n  if (selector) {\r\n    select(selector).each((item) => {\r\n      if (is.Mesh(item)) {\r\n        hideMeshNormals(item);\r\n      }\r\n    });\r\n  }\r\n  else {\r\n    global.scene.meshes.forEach((mesh) => {\r\n      hideMeshNormals(mesh);\r\n    });\r\n  }\r\n}","import { select } from \"../select.js\";\r\nimport { is } from \"../is.js\";\r\nimport { global } from \"../global.js\";\r\nimport { color } from \"../util/color.js\";\r\n\r\nfunction showMeshWireframe(mesh, epsilon, width , color) {\r\n  if (mesh.edgesRenderer == undefined) {\r\n    mesh.enableEdgesRendering(epsilon);\r\n    mesh.edgesColor = color;\r\n    mesh.edgesWidth = width;\r\n  } else {\r\n    mesh.enableEdgesRendering(epsilon);\r\n    mesh.edgesColor = color;\r\n    mesh.edgesWidth = width;\r\n    mesh.edgesRenderer.isEnabled = true;\r\n  }\r\n}\r\n\r\nfunction hideMeshWireframe(mesh) {\r\n  if (mesh.edgesRenderer) {\r\n    mesh.edgesRenderer.isEnabled = false;\r\n  }\r\n}\r\n\r\nexport function showWireframe(selector? : string,  epsilon = 1, width = 1, _color =  new BABYLON.Color4(130 / 255, 230 / 255, 1, 0.85)) {\r\n  if (selector) {\r\n    select(selector).each((item) => {\r\n      if (is.Mesh(item)) {\r\n        showMeshWireframe(item, epsilon, width, color(_color));\r\n      }\r\n    });\r\n  }\r\n  else {\r\n    global.scene.meshes.forEach((mesh) => {\r\n      showMeshWireframe(mesh, epsilon, width, color(_color));\r\n    });\r\n  }\r\n}\r\n\r\nexport function hideWireframe(selector? : string) {\r\n  if (selector) {\r\n    select(selector).each((item) => {\r\n      if (is.Mesh(item)) {\r\n        hideMeshWireframe(item);\r\n      }\r\n    });\r\n  }\r\n  else {\r\n    global.scene.meshes.forEach((mesh) => {\r\n      hideMeshWireframe(mesh);\r\n    });\r\n  }\r\n}","import { off, on, one, trigger } from \"../events/core.js\";\r\nimport { is } from \"../is.js\";\r\n\r\nexport let router = {\r\n  hashChangedListener : [],\r\n  set : function(hash : string) {\r\n    window.removeEventListener(\"hashchange\", hashChangeListener);\r\n    window.location.hash = hash;\r\n    this.trigger(hash);\r\n    window.addEventListener(\"hashchange\", hashChangeListener);\r\n  },\r\n  get : function() {\r\n    if (window.location.hash.length > 1) {\r\n      return window.location.hash.substr(1);\r\n    }\r\n  },\r\n  on : function(event: string | Function, handler?: (...args: any[]) => void, repeat = true) {\r\n    if (is.Function(event)) {\r\n      this.hashChangedListener.push(event);\r\n    }\r\n    else {\r\n      on(this, <string> event, handler, repeat);\r\n    }\r\n  },\r\n  off : function(event: string, handler?: (...args: any[]) => void) {\r\n    off(this, event, handler);\r\n  },\r\n  one : function(event: string, handler: (...args: any[]) => void) {\r\n    one(this, event, handler);\r\n  },\r\n  trigger : function(event: string, extraParameters?: any) {\r\n    if (!this.pause) {\r\n      this.hashChangedListener.forEach((listener) => {\r\n        listener(event);\r\n      });\r\n      trigger(this, event, extraParameters);\r\n    }\r\n  },\r\n  pause : false\r\n};\r\n\r\nfunction hashChangeListener(evt) {\r\n  router.trigger(router.get());\r\n}\r\n\r\nwindow.addEventListener(\"hashchange\", hashChangeListener);","import { extend } from \"./extend.js\";\r\n\r\nexport function merge(target: any, source: any, excluded?: Array<string>): any {\r\n  var others = {};\r\n  Object.getOwnPropertyNames(source).forEach(function(property) {\r\n    if (!excluded || excluded.indexOf(property) == -1) {\r\n      others[property] = source[property];\r\n    }\r\n  });\r\n  target = extend(target, others);\r\n  return target;\r\n}","import { global } from \"../global.js\";\r\nimport { is } from \"../is.js\";\r\n\r\nglobal.fn['freeze'] = function() {\r\n  this.forEach((item) => {\r\n    if (is.Mesh(item)) {\r\n      item.freezeWorldMatrix();\r\n    }\r\n    if (is.Material(item)) {\r\n      item.freeze();\r\n    }\r\n  });\r\n};\r\n\r\nglobal.fn['unfreeze'] = function() {\r\n  this.forEach((item) => {\r\n    if (is.Mesh(item)) {\r\n      item.unfreezeWorldMatrix();\r\n    }\r\n    if (is.Material(item)) {\r\n      item.unfreeze();\r\n    }\r\n  });\r\n};","import { queryString } from \"./util/queryString.js\";\r\nimport { global } from \"./global.js\";\r\nimport { is } from \"./is.js\";\r\nimport { launch, ready } from \"./launch.js\";\r\nimport { start, pause } from \"./renderLoop.js\";\r\nimport { downloadScene, downloadTexture, downloadCubeTexture } from \"./download.js\";\r\nimport { createLibrary, library } from \"./library.js\";\r\nimport { select } from \"./select.js\";\r\nimport { data } from \"./data.js\";\r\nimport { on, off, one, trigger } from \"./events/index.js\";\r\nimport { patch } from \"./patch/patch.js\";\r\nimport { match } from \"./Elements.js\";\r\nimport { color, color4 } from './util/color.js';\r\nimport { animate } from \"./animate.js\";\r\nimport { activateCamera } from \"./activateCamera.js\";\r\nimport { show, hide } from \"./show.hide/index.js\";\r\nimport { loadingScreen } from \"./util/loadingScreen.js\";\r\nimport { router } from \"./util/router.js\";\r\nimport { extend } from \"./util/extend.js\";\r\nimport { merge } from \"./util/merge.js\";\r\nimport { load } from \"./load.js\";\r\nimport './util/freeze.js';\r\n\r\nexport default {\r\n    get canvas() {\r\n        return global.canvas;\r\n    },\r\n    set canvas(value) {\r\n        global.canvas = value;\r\n    },\r\n    get scene() {\r\n        return global.scene;\r\n    },\r\n    set scene(value) {\r\n        global.scene = value;\r\n    },\r\n    get engine() {\r\n        return global.engine;\r\n    },\r\n    set engine(value) {\r\n        global.engine = value;\r\n    },\r\n    get TRACE() {\r\n        return global.TRACE;\r\n    },\r\n    set TRACE(value) {\r\n        global.TRACE = value;\r\n    },\r\n    activateCamera : activateCamera,\r\n    launch : launch,\r\n    ready : ready,\r\n    start : start,\r\n    pause : pause,\r\n    downloadScene : downloadScene,\r\n    downloadTexture : downloadTexture,\r\n    downloadCubeTexture : downloadCubeTexture,\r\n    createLibrary : createLibrary,\r\n    library : library,\r\n    data : data,\r\n    on : on,\r\n    off : off,\r\n    one : one,\r\n    trigger : trigger,\r\n    select : select,\r\n    patch : patch,\r\n    match : match,\r\n    is : is,\r\n    color : color,\r\n    color4 : color4,\r\n    animate : animate,\r\n    activeCamera : activateCamera,\r\n    fn : global.fn,\r\n    queryString : queryString,\r\n    router : router,\r\n    show : show,\r\n    hide : hide,\r\n    loadingScreen : loadingScreen,\r\n    extend : extend,\r\n    merge : merge,\r\n    load : load\r\n};"],"names":["is","_scene","_engine","_canvas","Number","n","isNaN","parseFloat","isFinite","HexColor","x","String","DOM","expr","HTMLElement","nodeType","nodeName","FileWithExtension","file","ext","split","length","extension","pop","trim","Array","i","_ext","functionToCheck","toString","call","Object","getPrototypeOf","prototype","proto","BABYLON","AssetContainer","Scene","TransformNode","window","isArray","AbstractMesh","Material","MultiMaterial","Texture","Light","Camera","Vector3","Vector2","Color3","Color4","indexOf","Quaternion","Matrix","Size","Mesh","canvas","HTMLCanvasElement","div","HTMLDivElement","image","HTMLImageElement","global","Engine","LastCreatedEngine","getRenderingCanvas","document","createElement","setAttribute","style","width","height","value","getElementById","addEventListener","resize","LastCreatedScene","engine","cache","expando","Date","now","data","element","key","hasOwnProperty","undefined","on","event","handler","repeat","events","push","one","trigger","_i","extraParameters","handlers","forEach","callback","_a","off","ex","console","error","filter","_handler","splice","fn","this","getQueryStringParameter","name","url","location","href","replace","results","RegExp","exec","decodeURIComponent","updateUrlParameter","uri","hash","substr","re","separator","match","slice","queryString","get","set","history","pushState","newurl","path","extend","args","options","src","copy","clone","target","deep","arguments","Function","PlainObject","activateCamera","camera","scene","activeCamera","detachControl","setActiveCameraByName","attachControl","plugins","registerPlugin","plugin","getPlugin","source","property","test","selector","filters","type","item","regExpAttribute","matches","left_1","right_1","JSON","parse","stringify","func","_split","_element","left_2","right_2","exp","regExp","Selector","elements","add","Elements","meshes","lights","materials","textures","cameras","toArray","each","result","attribute","log","base","find","dispose","addCamera","addMesh","addMaterial","addMultiMaterial","addTexture","addLight","removeCamera","removeMesh","removeMaterial","removeMultiMaterial","removeTexture","removeLight","params","_selector","matchType","matchFilters","container","material","mesh","light","texture","transformNodes","libraries","createLibrary","_elements","TRACE","groupCollapsed","groupEnd","library","select","arg","toLowerCase","getOwnPropertyNames","lib","contains","warn","counter","load","resource","patch","promises_1","Promise","all","ImageFile","assets","script","css","ajax","resolve","reject","assetsManager","AssetsManager","task","addImageTask","onSuccess","then","onError","message","exception","progress","fileName","root","SceneLoader","ShowLoadingScreen","LoadAssetContainerAsync","assetsContainer","globalPatch","StandardMaterial","pbr","PBRMaterial","img","err","cubeCounter","cubeTexture","addCubeTextureTask","reason","xhr","XMLHttpRequest","open","onload","status","isJson","response","__patch","eval","send","ajaxCounter","recursive","promisify","index","res","recurse","res_1","globalPatchItem","PatchFile","plugins.getPlugin","patchElements","_patch","context","patchElement","patchProperty","Primitive","apply","color","FromHexString","r","g","b","FromArray","toLocaleLowerCase","rgb","substring","lastIndexOf","rgba","a","Red","Green","Blue","Black","White","Purple","Magenta","Yellow","Teal","Gray","Random","color4","_color","addTextFileTask","text","e","resolved","readyState","body","appendChild","link","rel","head","subMaterials","FresnelParameters","properties","promises","id","iframe","_this","isVisible","parentNode","removeChild","_attached","classList","iFrameLoadingScreen","contentDocument","_contentDocument","contentWindow","_message","_progress","remove","displayLoadingUI","hideLoadingUI","getElementsByClassName","innerHTML","postMessage","setTimeout","json","origin","loadingScreen","_instance","activate","opacity","loadingUIText","instance","isReady","callbacks","ktx","enableOfflineSupport","launch","obj","setTextureFormatToUse","_createScene","_load","_checkActiveCamera","_beforeFirstRender","start","evt","addAllToScene","scenes","Error","beforeFirstRender","inputs","attachedElement","loop","render","runRenderLoop","ready","pause","stopRenderLoop","downloadScene","assetContainer","downloadTexture","addTextureTask","noMipmap","invertY","samplingMode","downloadCubeTexture","extensions","files","keys","onKeyEvent","actionManager","ActionManager","action","ExecuteCodeAction","registerAction","oneKeyEvent","offKeyEvent","_event","actions","listener","removeEventListener","onMesh","hasSpecificTrigger","oneMesh","offMesh","e.on","e.off","e.one","e.trigger","getEasingFunction","easing","mode","easingFunction","EasingFunction","EASINGMODE_EASEINOUT","EASINGMODE_EASEIN","info","EASINGMODE_EASEOUT","SineEase","setEasingMode","QuadraticEase","CubicEase","QuarticEase","QuinticEase","ExponentialEase","CircleEase","BackEase","ElasticEase","BounceEase","getLoopMode","Boolean","Animation","ANIMATIONLOOPMODE_CONSTANT","ANIMATIONLOOPMODE_CYCLE","ANIMATIONLOOPMODE_RELATIVE","getAnimationType","ANIMATIONTYPE_VECTOR2","ANIMATIONTYPE_VECTOR3","ANIMATIONTYPE_FLOAT","Color","ANIMATIONTYPE_COLOR3","ANIMATIONTYPE_QUATERNION","ANIMATIONTYPE_MATRIX","ANIMATIONTYPE_SIZE","isAnimatable","getKeys","newValue","final","initial","frame","fps","duration","getAnimationsForElement","animations","animation","setKeys","setEasingFunction","findSomethingToAnimate","animatables","_animatables","concat","defaultOptions","speedRatio","loopMode","getOptions","_options","count","utilLayer","show","hide","animate","group","AnimationGroup","animatable","addTargetedAnimation","complete","onAnimationGroupEndObservable","onAnimationEndObservable","targetedAnimation","play","showMeshNormals","size","hideMeshNormals","normals","getVerticesData","VertexBuffer","NormalKind","positions","PositionKind","lines","v1","v2","scaleInPlace","position","normalLines","MeshBuilder","CreateLineSystem","uniqueId","showNormals","hideNormals","showMeshWireframe","epsilon","edgesRenderer","enableEdgesRendering","edgesColor","edgesWidth","isEnabled","hideMeshWireframe","showWireframe","hideWireframe","initUtilLayer","UtilityLayerRenderer","showMeshGizmo","gizmoType","axis","gizmo","hideMeshGizmo","PositionGizmo","RotationGizmo","ScaleGizmo","BoundingBoxGizmo","attachedMesh","xGizmo","Version","yGizmo","zGizmo","updateGizmoRotationToMatchAttachedMesh","updateGizmoPositionToMatchAttachedMesh","showGizmo","hideGizmo","param","visibility","alpha","level","intensity","getAllAnimatablesByTarget","stop","router","hashChangedListener","hashChangeListener","merge","excluded","others","freezeWorldMatrix","freeze","unfreezeWorldMatrix","unfreeze"],"mappings":"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"}