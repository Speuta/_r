!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("../node_modules/babylonjs/es6.js")):"function"==typeof define&&define.amd?define(["../node_modules/babylonjs/es6.js"],n):(e=e||self)._r=n(e.BABYLON)}(this,function(BABYLON){"use strict";var is,_scene,_engine,_canvas;console.log("babylon runtime v0.0.6"),function(n){function t(e){return!isNaN(parseFloat(e))&&isFinite(e)}function r(e){return o(e)&&"#"==e[0]}function o(e){return"string"==typeof e}n.Function=function(e){return e&&"[object Function]"==={}.toString.call(e)},n.Number=t,n.PlainObject=function(e){if("object"!=typeof e||null===e)return!1;if("function"!=typeof Object.getPrototypeOf)return"[object Object]"==Object.prototype.toString.call(e);var n=Object.getPrototypeOf(e);return n===Object.prototype||null===n},n.AssetContainer=function(e){return e instanceof BABYLON.AssetContainer},n.Scene=function(e){return e instanceof BABYLON.Scene},n.Array=function(e){return window.Array.isArray(e)},n.Mesh=function(e){return e instanceof BABYLON.AbstractMesh},n.Material=function(e){return e instanceof BABYLON.Material},n.MultiMaterial=function(e){return e instanceof BABYLON.MultiMaterial},n.Texture=function(e){return e instanceof BABYLON.Texture},n.Light=function(e){return e instanceof BABYLON.Light},n.Camera=function(e){return e instanceof BABYLON.Camera},n.Vector3=function(e){return e instanceof BABYLON.Vector3||n.Array(e)&&3==e.length},n.Vector2=function(e){return e instanceof BABYLON.Vector2},n.Color=function(e){return r(e)||e instanceof BABYLON.Color3||e instanceof BABYLON.Color4||n.String(e)&&(0==e.trim().indexOf("rgb(")||0==e.trim().indexOf("rgba("))},n.HexColor=r,n.Float=function(e){return t(e)===e&&e%1!=0},n.Int=function(e){return t(e)===e&&e%1==0},n.Quaternion=function(e){return e instanceof BABYLON.Quaternion},n.Matrix=function(e){return e instanceof BABYLON.Matrix},n.String=o,n.Size=function(e){return e instanceof BABYLON.Size},n.PatchFile=function(e){if("string"!=typeof e)return!1;var n=e.split("."),t=n[n.length-1].trim();return"runtime"==t||"patch"==t||"js"==t},n.Boolean=function(e){return"boolean"==typeof e},n.BabylonNode=function(e){return n.Camera(e)||n.Light(e)||n.Material(e)||n.Mesh(e)||n.Texture(e)},n.DOM=function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},n.Primitive=function(e){return e!==Object(e)},n.Promise=function(e){return e&&"function"==typeof e.then}}(is||(is={}));var global=function(){function e(){}return Object.defineProperty(e,"canvas",{get:function(){if(!_canvas){if(BABYLON.Engine.LastCreatedEngine){var e=BABYLON.Engine.LastCreatedEngine.getRenderingCanvas();if(e)return _canvas=e}(_canvas=document.createElement("canvas")).setAttribute("touch-action","none"),_canvas.style.width="100%",_canvas.style.height="100%",document.body.appendChild(_canvas)}return _canvas},set:function(e){_canvas=is.String(e)?document.getElementById(e):e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"engine",{get:function(){return _engine||(_engine=BABYLON.Engine.LastCreatedEngine?BABYLON.Engine.LastCreatedEngine:new BABYLON.Engine(e.canvas,!0)),_engine},set:function(e){_engine=e,window.addEventListener("resize",function(){_engine.resize()})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"scene",{get:function(){return _scene||(_scene=BABYLON.Engine.LastCreatedScene?BABYLON.Engine.LastCreatedScene:new BABYLON.Scene(e.engine)),_scene},set:function(e){_scene=e},enumerable:!0,configurable:!0}),e.fn={},e.TRACE=!1,e}();function extend(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t,r,o,i,a,c,s=e[0],u=1,l=e.length,f=!1;for("boolean"==typeof s&&(f=s,s=arguments[1]||{},u++),"object"==typeof s||is.Function(s)||(s={});u<l;u++)if(null!=(t=arguments[u]))for(r in t)o=s[r],s!=(i=t[r])&&(f&&i&&(is.PlainObject(i)||(a=is.Array(i)))?(c=a?(a=!1,o&&is.Array(o)?o:[]):o&&is.PlainObject(o)?o:{},s[r]=extend(f,c,i)):void 0!==i&&(s[r]=i));return s}function activateCamera(e){global.scene.activeCamera&&global.scene.activeCamera.detachControl(),global.scene.setActiveCameraByName(e),global.scene.activeCamera.attachControl(global.canvas),global.TRACE&&(console.groupCollapsed("[_r] - activate camera "+global.scene.activeCamera.name),console.log(global.scene.activeCamera),console.groupEnd())}var cache=[],expando="_r"+Date.now();function data(e,n,t){return e.hasOwnProperty(expando)||(e[expando]=cache.length,cache[e[expando]]={}),null==n?cache[e[expando]]:null==t?cache[e[expando]][n]:void(cache[e[expando]][n]=t)}function on(e,n,t,r){void 0===r&&(r=!0),data(e,"_r.events")||data(e,"_r.events",{});var o=data(e,"_r.events");o[n]||(o[n]=[]),o[n].push({handler:t,repeat:r})}function one(e,n,t){on(e,n,t,!1)}function trigger(n,t,r){var e=data(n,"_r.events");if(e){var o=e[t];is.Array(o)&&o.forEach(function(e){try{e.handler.call(n,r),e.repeat||off(n,t,e.handler)}catch(e){console.error("_r.trigger exception",e)}})}}function off(e,n,t){var r=data(e,"_r.events");r[n]&&(r[n]=t?r[n].filter(function(e){e.handler.toString()==t.toString()&&r[n].splice(r[n].indexOf(e),1)}):[])}var meshEvents=["NothingTrigger ","OnDoublePickTrigger","OnPickTrigger","OnLeftPickTrigger","OnRightPickTrigger","OnCenterPickTrigger","OnPickDownTrigger","OnPickUpTrigger","OnPickOutTrigger","OnLongPressTrigger","OnPointerOverTrigger","OnPointerOutTrigger","OnEveryFrameTrigger","OnIntersectionEnterTrigger","OnIntersectionExitTrigger"];function onMesh(n,t,e,r){void 0===r&&(r=!0),n.actionManager||(n.actionManager=new BABYLON.ActionManager(global.scene));var o=new BABYLON.ExecuteCodeAction(BABYLON.ActionManager[t],function(e){trigger(n,t,e)});n.actionManager.registerAction(o);var i=data(n,"_r.events");i||(data(n,"_r.events",[]),i=data(n,"_r.events")),i[t]||(i[t]=[]),i[t].push({handler:e,repeat:r,action:o})}function oneMesh(e,n,t){onMesh(e,n,t,!1)}function offMesh(t,e,r){var n=data(t,"_r.events");n[e]&&(n[e]=r?n[e].filter(function(e){if(e.handler.toString()==r.toString()){if(e.action){var n=t.actionManager.actions.indexOf(e.action);t.actionManager.actions.splice(n,1)}e.listener&&t.removeEventListener(e,e.listener)}return e.handler.toString()!==r.toString()}):[])}var Selector=function(){function e(e){this.type="all";var r=[],n="all",t=e.trim();-1!==t.indexOf(":mesh")&&(n="mesh"),-1!==t.indexOf(":material")&&(n="material"),-1!==t.indexOf(":light")&&(n="light"),-1!==t.indexOf(":camera")&&(n="camera"),-1!==t.indexOf(":texture")&&(n="texture"),-1!==t.indexOf(":multimaterial")&&(n="multimaterial"),[":mesh",":material",":multimaterial",":camera",":light",":texture"].forEach(function(e){t=t.replace(e,"")});for(var o,i=/\[(.*?)\]/,a=[];o=i.exec(e);)a.push(o[1]),e=e.replace(i,"");a.forEach(function(t){if(-1!==t.indexOf("!=")){var n=t.split("!=");r.push(function(e){return!!e.hasOwnProperty(n[0])&&e[n[0]]!=JSON.parse(n[1])})}else-1!==t.indexOf("=")?r.push(function(e){var n=t.split("=");return!!e.hasOwnProperty(n[0])&&e[n[0]]==JSON.parse(n[1])}):r.push(function(e){return null!=e[t]})});var c=(t=t.replace(i,"")).replace(/\*/g,".*"),s=new RegExp("^"+c+"$");r.push(function(e){return e.hasOwnProperty("name")&&s.test(e.name)}),this.filters=r,this.type=n}return e.prototype.matchFilters=function(e){for(var n=0;n<this.filters.length;n++)if(!this.filters[n](e))return!1;return!0},e.prototype.matchType=function(e){return"all"==this.type||("mesh"==this.type?is.Mesh(e):"light"==this.type?is.Light(e):"material"==this.type?is.Material(e):"multimaterial"==this.type?is.MultiMaterial(e):"texture"==this.type?is.Texture(e):"camera"==this.type?is.Camera(e):void 0)},e}(),Elements=function(){function o(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var t=this.length=0;t<e.length;t++)this.add(e[t])}return o.prototype.add=function(e){if(is.Array(e))for(var n=0;n<e.length;n++)this.add(e[n]);else if(is.AssetContainer(e)){for(n=0;n<e.meshes.length;n++)this[this.length++]=e.meshes[n];for(n=0;n<e.lights.length;n++)this[this.length++]=e.lights[n];for(n=0;n<e.materials.length;n++)this[this.length++]=e.materials[n];for(n=0;n<e.textures.length;n++)this[this.length++]=e.textures[n];for(n=0;n<e.cameras.length;n++)this[this.length++]=e.cameras[n]}else this[this.length++]=e},o.prototype.contains=function(e){return-1!==this.toArray().indexOf(e)},o.prototype.on=function(n,t){this.each(function(e){is.Mesh(e)&&-1!==meshEvents.indexOf(n)?onMesh(e,n,t):on(e,n,t)})},o.prototype.one=function(n,t){this.each(function(e){is.Mesh(e)&&-1!==meshEvents.indexOf(n)?oneMesh(e,n,t):one(e,n,t)})},o.prototype.off=function(n,t){this.each(function(e){is.Mesh(e)&&-1!==meshEvents.indexOf(n)?offMesh(e,n,t):off(e,n,t)})},o.prototype.trigger=function(n,t){this.each(function(e){trigger(e,n,t)})},o.prototype.data=function(e,n){if(null==e||null==n)return data(this[0],e,n);for(var t=0;t<this.length;t++)data(this[t],e,n)},o.prototype.each=function(e){for(var n=0;n<this.length;n++)if(0==e.call(this[n],this[n],n))return;return this},o.prototype.forEach=function(e){return this.each(e)},o.prototype.map=function(n){var t=new o,r=0;return this.each(function(e){t[r++]=n(e)}),t.length=r,t},o.prototype.filter=function(n){var t=new o;return this.each(function(e){n(e)&&t.add(e)}),t},o.prototype.toArray=function(){for(var e=[],n=0;n<this.length;n++)e.push(this[n]);return e},o.prototype.attr=function(n,t){return null!=t?(this.each(function(e){e[n]=t}),this):this[0][n]},o.prototype.first=function(){return this[0]},o.prototype.log=function(n){this.each(function(e){n?console.log(e[n]):console.log(e)})},o.prototype.concat=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.forEach(function(e){var n;e instanceof o?n=e:is.String(e)?n=new o(e):is.Array(e)?(n=new o,e.forEach(function(e){n[n.length++]=e})):n=new o(e),n.each(function(e){this[this.length++]=e})}),this},o.prototype.select=function(e){return 1===this.length&&is.Scene(this[0])?find(e,this[0]):find(e,this)},o.prototype.dispose=function(){for(var e=0;e<this.length;e++)this[e].dispose(),delete this[e]},o.prototype.addToScene=function(){this.each(function(e){is.Camera(e)&&global.scene.addCamera(e),is.Mesh(e)&&global.scene.addMesh(e),is.Material(e)&&global.scene.addMaterial(e),is.MultiMaterial(e)&&global.scene.addMultiMaterial(e),is.Texture(e)&&global.scene.addTexture(e),is.Light(e)&&global.scene.addLight(e)})},o.prototype.removeFromScene=function(){this.each(function(e){return is.Camera(e)?(global.scene.removeCamera(e),!1):is.Mesh(e)?(global.scene.removeMesh(e),!1):is.Material(e)?(global.scene.removeMaterial(e),!1):is.MultiMaterial(e)?(global.scene.removeMultiMaterial(e),!1):is.Texture(e)?(global.scene.removeTexture(e),!1):is.Light(e)?(global.scene.removeLight(e),!1):void 0})},o.prototype.remove=function(e){},o}();function match(e,n){var t=new Selector(n);return t.matchType(e)&&t.matchFilters(e)}function find(e,t){var r=new Elements;return e.split(",").forEach(function(e){e=e.trim();var n=new Selector(e);if(is.Scene(t)||is.AssetContainer(t))switch(n.type){case"material":t.materials.forEach(function(e){n.matchFilters(e)&&r.add(e)});break;case"mesh":t.meshes.forEach(function(e){n.matchFilters(e)&&r.add(e)});break;case"light":t.lights.forEach(function(e){n.matchFilters(e)&&r.add(e)});break;case"multimaterial":t.materials.forEach(function(e){is.MultiMaterial(e)&&n.matchFilters(e)&&r.add(e)});break;case"texture":t.textures.forEach(function(e){n.matchFilters(e)&&r.add(e)});break;case"camera":t.cameras.forEach(function(e){n.matchFilters(e)&&r.add(e)});break;case"all":t.materials.forEach(function(e){n.matchFilters(e)&&r.add(e)}),t.meshes.forEach(function(e){n.matchFilters(e)&&r.add(e)}),t.lights.forEach(function(e){n.matchFilters(e)&&r.add(e)}),t.textures.forEach(function(e){n.matchFilters(e)&&r.add(e)}),t.cameras.forEach(function(e){n.matchFilters(e)&&r.add(e)})}else t.each(function(e){n.matchType(e)&&n.matchFilters(e)&&r.add(e)})}),r}var libraries=[];function createLibrary(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];if(libraries[e])console.error("[_r] Error in _r.createLibrary : "+e+" already exists");else{var r=new Elements(n);libraries[e]=r,global.TRACE&&(console.groupCollapsed("[_r] - create library "+e),r.log(),console.groupEnd())}}function library(e){return libraries[e]}function select(e){var t;if(is.String(e)){if("scene"===e.toLowerCase())return new Elements(global.scene);for(var n in t=find(e,global.scene),libraries){libraries[n].select(e).each(function(e){t.contains(e)||t.add(e)})}!0===global.TRACE&&0==t.length&&console.warn('BABYLON.Runtime::no object(s) found for selector "'+e+'"')}else t=new Elements(e);var r=function(n){Elements.prototype[n]=function(e){return global.fn[n].call(t,e)}};for(var o in global.fn)r(o);return t}function loop(){global.scene.render()}function start(){isStarted=!0,global.engine.runRenderLoop(loop)}function pause(){isStarted=!1,global.engine.stopRenderLoop(loop)}!function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var n="undefined"!=typeof window?window:self,t=n.Q;n.Q=e(),n.Q.noConflict=function(){return n.Q=t,this}}}(function(){var c=!1;try{throw new Error}catch(e){c=!!e.stack}var o,i=A(),n=function(){},l=function(){var t={task:void 0,next:null},n=t,r=!1,o=void 0,i=!1,a=[];function c(){for(var e,n;t.next;)e=(t=t.next).task,t.task=void 0,(n=t.domain)&&(t.domain=void 0,n.enter()),s(e,n);for(;a.length;)s(e=a.pop());r=!1}function s(e,n){try{e()}catch(e){if(i)throw n&&n.exit(),setTimeout(c,0),n&&n.enter(),e;setTimeout(function(){throw e},0)}n&&n.exit()}if(l=function(e){n=n.next={task:e,domain:i&&process.domain,next:null},r||(r=!0,o())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)i=!0,o=function(){process.nextTick(c)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,c):function(){setImmediate(c)};else if("undefined"!=typeof MessageChannel){var e=new MessageChannel;e.port1.onmessage=function(){o=u,(e.port1.onmessage=c)()};var u=function(){e.port2.postMessage(0)};o=function(){setTimeout(c,0),u()}}else o=function(){setTimeout(c,0)};return l.runAfter=function(e){a.push(e),r||(r=!0,o())},l}(),t=Function.call;function e(e){return function(){return t.apply(e,arguments)}}var s,u=e(Array.prototype.slice),f=e(Array.prototype.reduce||function(e,n){var t=0,r=this.length;if(1===arguments.length)for(;;){if(t in this){n=this[t++];break}if(++t>=r)throw new TypeError}for(;t<r;t++)t in this&&(n=e(n,this[t],t));return n}),a=e(Array.prototype.indexOf||function(e){for(var n=0;n<this.length;n++)if(this[n]===e)return n;return-1}),r=e(Array.prototype.map||function(r,o){var i=this,a=[];return f(i,function(e,n,t){a.push(r.call(o,n,t,i))},void 0),a}),p=Object.create||function(e){function n(){}return n.prototype=e,new n},d=Object.defineProperty||function(e,n,t){return e[n]=t.value,e},h=e(Object.prototype.hasOwnProperty),g=Object.keys||function(e){var n=[];for(var t in e)h(e,t)&&n.push(t);return n},v=e(Object.prototype.toString);s="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var m="From previous event:";function y(e,n){if(c&&n.stack&&"object"==typeof e&&null!==e&&e.stack){for(var t=[],r=n;r;r=r.source)r.stack&&(!e.__minimumStackCounter__||e.__minimumStackCounter__>r.stackCounter)&&(d(e,"__minimumStackCounter__",{value:r.stackCounter,configurable:!0}),t.unshift(r.stack));t.unshift(e.stack);var o=function(e){for(var n=e.split("\n"),t=[],r=0;r<n.length;++r){var o=n[r];!b(o)&&(-1===(i=o).indexOf("(module.js:")&&-1===i.indexOf("(node.js:"))&&o&&t.push(o)}var i;return t.join("\n")}(t.join("\n"+m+"\n"));d(e,"stack",{value:o,configurable:!0})}}function O(e){var n=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(n)return[n[1],Number(n[2])];var t=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(t)return[t[1],Number(t[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function b(e){var n=O(e);if(!n)return!1;var t=n[0],r=n[1];return t===o&&i<=r&&r<=$}function A(){if(c)try{throw new Error}catch(e){var n=e.stack.split("\n"),t=O(0<n[0].indexOf("@")?n[1]:n[2]);if(!t)return;return o=t[0],t[1]}}function E(e){return e instanceof L?e:k(e)?(n=e,t=N(),E.nextTick(function(){try{n.then(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}}),t.promise):D(e);var n,t}(E.resolve=E).nextTick=l,E.longStackSupport=!1;var B=1;function N(){var o,i=[],a=[],e=p(N.prototype),n=p(L.prototype);if(n.promiseDispatch=function(e,n,t){var r=u(arguments);i?(i.push(r),"when"===n&&t[1]&&a.push(t[1])):E.nextTick(function(){o.promiseDispatch.apply(o,r)})},n.valueOf=function(){if(i)return n;var e=C(o);return M(e)&&(o=e),e},n.inspect=function(){return o?o.inspect():{state:"pending"}},E.longStackSupport&&c)try{throw new Error}catch(e){n.stack=e.stack.substring(e.stack.indexOf("\n")+1),n.stackCounter=B++}function t(t){o=t,E.longStackSupport&&c&&(n.source=t),f(i,function(e,n){E.nextTick(function(){t.promiseDispatch.apply(t,n)})},void 0),a=i=void 0}return e.promise=n,e.resolve=function(e){o||t(E(e))},e.fulfill=function(e){o||t(D(e))},e.reject=function(e){o||t(Q(e))},e.notify=function(t){o||f(a,function(e,n){E.nextTick(function(){n(t)})},void 0)},e}function w(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var n=N();try{e(n.resolve,n.reject,n.notify)}catch(e){n.reject(e)}return n.promise}function x(o){return w(function(e,n){for(var t=0,r=o.length;t<r;t++)E(o[t]).then(e,n)})}function L(o,i,n){void 0===i&&(i=function(e){return Q(new Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var a=p(L.prototype);if(a.promiseDispatch=function(e,n,t){var r;try{r=o[n]?o[n].apply(a,t):i.call(a,n,t)}catch(e){r=Q(e)}e&&e(r)},a.inspect=n){var e=n();"rejected"===e.state&&(a.exception=e.reason),a.valueOf=function(){var e=n();return"pending"===e.state||"rejected"===e.state?a:e.value}}return a}function T(e,n,t,r){return E(e).then(n,t,r)}function C(e){if(M(e)){var n=e.inspect();if("fulfilled"===n.state)return n.value}return e}function M(e){return e instanceof L}function k(e){return(n=e)===Object(n)&&"function"==typeof e.then;var n}"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(E.longStackSupport=!0),(E.defer=N).prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):2<arguments.length?t.resolve(u(arguments,1)):t.resolve(n)}},E.Promise=w,(E.promise=w).race=x,w.all=U,w.reject=Q,(w.resolve=E).passByCopy=function(e){return e},L.prototype.passByCopy=function(){return this},E.join=function(e,n){return E(e).join(n)},L.prototype.join=function(e){return E([this,e]).spread(function(e,n){if(e===n)return e;throw new Error("Q can't join: not the same: "+e+" "+n)})},E.race=x,L.prototype.race=function(){return this.then(E.race)},(E.makePromise=L).prototype.toString=function(){return"[object Promise]"},L.prototype.then=function(n,t,o){var r=this,i=N(),a=!1;return E.nextTick(function(){r.promiseDispatch(function(e){a||(a=!0,i.resolve(function(e){try{return"function"==typeof n?n(e):e}catch(e){return Q(e)}}(e)))},"when",[function(e){a||(a=!0,i.resolve(function(e){if("function"==typeof t){y(e,r);try{return t(e)}catch(e){return Q(e)}}return Q(e)}(e)))}])}),r.promiseDispatch(void 0,"when",[void 0,function(e){var n,t,r=!1;try{t=e,n="function"==typeof o?o(t):t}catch(e){if(r=!0,!E.onerror)throw e;E.onerror(e)}r||i.notify(n)}]),i.promise},E.tap=function(e,n){return E(e).tap(n)},L.prototype.tap=function(n){return n=E(n),this.then(function(e){return n.fcall(e).thenResolve(e)})},E.when=T,L.prototype.thenResolve=function(e){return this.then(function(){return e})},E.thenResolve=function(e,n){return E(e).thenResolve(n)},L.prototype.thenReject=function(e){return this.then(function(){throw e})},E.thenReject=function(e,n){return E(e).thenReject(n)},E.nearer=C,E.isPromise=M,E.isPromiseAlike=k,E.isPending=function(e){return M(e)&&"pending"===e.inspect().state},L.prototype.isPending=function(){return"pending"===this.inspect().state},E.isFulfilled=function(e){return!M(e)||"fulfilled"===e.inspect().state},L.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},E.isRejected=function(e){return M(e)&&"rejected"===e.inspect().state},L.prototype.isRejected=function(){return"rejected"===this.inspect().state};var S,Y,_,j=[],P=[],R=[],F=!0;function I(){j.length=0,P.length=0,F||(F=!0)}function Q(n){var e,t,r=L({when:function(e){return e&&function(n){if(F){var t=a(P,n);-1!==t&&("object"==typeof process&&"function"==typeof process.emit&&E.nextTick.runAfter(function(){var e=a(R,n);-1!==e&&(process.emit("rejectionHandled",j[t],n),R.splice(e,1))}),P.splice(t,1),j.splice(t,1))}}(this),e?e(n):this}},function(){return this},function(){return{state:"rejected",reason:n}});return e=r,t=n,F&&("object"==typeof process&&"function"==typeof process.emit&&E.nextTick.runAfter(function(){-1!==a(P,e)&&(process.emit("unhandledRejection",t,e),R.push(e))}),P.push(e),t&&void 0!==t.stack?j.push(t.stack):j.push("(no stack) "+t)),r}function D(t){return L({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},delete:function(e){delete t[e]},post:function(e,n){return null==e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return g(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function G(e,n,t){return E(e).spread(n,t)}function K(e,n,t){return E(e).dispatch(n,t)}function U(e){return T(e,function(o){var i=0,a=N();return f(o,function(e,n,t){var r;M(n)&&"fulfilled"===(r=n.inspect()).state?o[t]=r.value:(++i,T(n,function(e){o[t]=e,0==--i&&a.resolve(o)},a.reject,function(e){a.notify({index:t,value:e})}))},void 0),0===i&&a.resolve(o),a.promise})}function V(o){if(0===o.length)return E.resolve();var i=E.defer(),a=0;return f(o,function(e,n,t){var r=o[t];a++,T(r,function(e){i.resolve(e)},function(e){if(0==--a){var n=e||new Error(""+e);n.message="Q can't get fulfillment value from any promise, all promises were rejected. Last error message: "+n.message,i.reject(n)}},function(e){i.notify({index:t,value:e})})},void 0),i.promise}function z(e){return T(e,function(e){return e=r(e,E),T(U(r(e,function(e){return T(e,n,n)})),function(){return e})})}E.resetUnhandledRejections=I,E.getUnhandledReasons=function(){return j.slice()},E.stopUnhandledRejectionTracking=function(){I(),F=!1},I(),E.reject=Q,E.fulfill=D,E.master=function(t){return L({isDef:function(){}},function(e,n){return K(t,e,n)},function(){return E(t).inspect()})},E.spread=G,L.prototype.spread=function(n,e){return this.all().then(function(e){return n.apply(void 0,e)},e)},E.async=function(n){return function(){function e(e,n){var t,r;if("undefined"==typeof StopIteration){try{t=o[e](n)}catch(e){return Q(e)}return t.done?E(t.value):T(t.value,i,a)}try{t=o[e](n)}catch(e){return"[object StopIteration]"===v(r=e)||r instanceof s?E(e.value):Q(e)}return T(t,i,a)}var o=n.apply(this,arguments),i=e.bind(e,"next"),a=e.bind(e,"throw");return i()}},E.spawn=function(e){E.done(E.async(e)())},E.return=function(e){throw new s(e)},E.promised=function(t){return function(){return G([this,U(arguments)],function(e,n){return t.apply(e,n)})}},E.dispatch=K,L.prototype.dispatch=function(e,n){var t=this,r=N();return E.nextTick(function(){t.promiseDispatch(r.resolve,e,n)}),r.promise},E.get=function(e,n){return E(e).dispatch("get",[n])},L.prototype.get=function(e){return this.dispatch("get",[e])},E.set=function(e,n,t){return E(e).dispatch("set",[n,t])},L.prototype.set=function(e,n){return this.dispatch("set",[e,n])},E.del=E.delete=function(e,n){return E(e).dispatch("delete",[n])},L.prototype.del=L.prototype.delete=function(e){return this.dispatch("delete",[e])},E.mapply=E.post=function(e,n,t){return E(e).dispatch("post",[n,t])},L.prototype.mapply=L.prototype.post=function(e,n){return this.dispatch("post",[e,n])},E.send=E.mcall=E.invoke=function(e,n){return E(e).dispatch("post",[n,u(arguments,2)])},L.prototype.send=L.prototype.mcall=L.prototype.invoke=function(e){return this.dispatch("post",[e,u(arguments,1)])},E.fapply=function(e,n){return E(e).dispatch("apply",[void 0,n])},L.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},E.try=E.fcall=function(e){return E(e).dispatch("apply",[void 0,u(arguments,1)])},L.prototype.fcall=function(){return this.dispatch("apply",[void 0,u(arguments)])},E.fbind=function(e){var n=E(e),t=u(arguments,1);return function(){return n.dispatch("apply",[this,t.concat(u(arguments))])}},L.prototype.fbind=function(){var e=this,n=u(arguments);return function(){return e.dispatch("apply",[this,n.concat(u(arguments))])}},E.keys=function(e){return E(e).dispatch("keys",[])},L.prototype.keys=function(){return this.dispatch("keys",[])},E.all=U,L.prototype.all=function(){return U(this)},E.any=V,L.prototype.any=function(){return V(this)},E.allResolved=(S=z,Y="allResolved",_="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(Y+" is deprecated, use "+_+" instead.",new Error("").stack),S.apply(S,arguments)}),L.prototype.allResolved=function(){return z(this)},E.allSettled=function(e){return E(e).allSettled()},L.prototype.allSettled=function(){return this.then(function(e){return U(r(e,function(e){function n(){return e.inspect()}return(e=E(e)).then(n,n)}))})},E.fail=E.catch=function(e,n){return E(e).then(void 0,n)},L.prototype.fail=L.prototype.catch=function(e){return this.then(void 0,e)},E.progress=function(e,n){return E(e).then(void 0,void 0,n)},L.prototype.progress=function(e){return this.then(void 0,void 0,e)},E.fin=E.finally=function(e,n){return E(e).finally(n)},L.prototype.fin=L.prototype.finally=function(n){if(!n||"function"!=typeof n.apply)throw new Error("Q can't apply finally callback");return n=E(n),this.then(function(e){return n.fcall().then(function(){return e})},function(e){return n.fcall().then(function(){throw e})})},E.done=function(e,n,t,r){return E(e).done(n,t,r)},L.prototype.done=function(e,n,t){var r=function(e){E.nextTick(function(){if(y(e,o),!E.onerror)throw e;E.onerror(e)})},o=e||n||t?this.then(e,n,t):this;"object"==typeof process&&process&&process.domain&&(r=process.domain.bind(r)),o.then(void 0,r)},E.timeout=function(e,n,t){return E(e).timeout(n,t)},L.prototype.timeout=function(e,n){var t=N(),r=setTimeout(function(){n&&"string"!=typeof n||((n=new Error(n||"Timed out after "+e+" ms")).code="ETIMEDOUT"),t.reject(n)},e);return this.then(function(e){clearTimeout(r),t.resolve(e)},function(e){clearTimeout(r),t.reject(e)},t.notify),t.promise},E.delay=function(e,n){return void 0===n&&(n=e,e=void 0),E(e).delay(n)},L.prototype.delay=function(t){return this.then(function(e){var n=N();return setTimeout(function(){n.resolve(e)},t),n.promise})},E.nfapply=function(e,n){return E(e).nfapply(n)},L.prototype.nfapply=function(e){var n=N(),t=u(e);return t.push(n.makeNodeResolver()),this.fapply(t).fail(n.reject),n.promise},E.nfcall=function(e){var n=u(arguments,1);return E(e).nfapply(n)},L.prototype.nfcall=function(){var e=u(arguments),n=N();return e.push(n.makeNodeResolver()),this.fapply(e).fail(n.reject),n.promise},E.nfbind=E.denodeify=function(t){if(void 0===t)throw new Error("Q can't wrap an undefined function");var r=u(arguments,1);return function(){var e=r.concat(u(arguments)),n=N();return e.push(n.makeNodeResolver()),E(t).fapply(e).fail(n.reject),n.promise}},L.prototype.nfbind=L.prototype.denodeify=function(){var e=u(arguments);return e.unshift(this),E.denodeify.apply(void 0,e)},E.nbind=function(t,r){var o=u(arguments,2);return function(){var e=o.concat(u(arguments)),n=N();return e.push(n.makeNodeResolver()),E(function(){return t.apply(r,arguments)}).fapply(e).fail(n.reject),n.promise}},L.prototype.nbind=function(){var e=u(arguments,0);return e.unshift(this),E.nbind.apply(void 0,e)},E.nmapply=E.npost=function(e,n,t){return E(e).npost(n,t)},L.prototype.nmapply=L.prototype.npost=function(e,n){var t=u(n||[]),r=N();return t.push(r.makeNodeResolver()),this.dispatch("post",[e,t]).fail(r.reject),r.promise},E.nsend=E.nmcall=E.ninvoke=function(e,n){var t=u(arguments,2),r=N();return t.push(r.makeNodeResolver()),E(e).dispatch("post",[n,t]).fail(r.reject),r.promise},L.prototype.nsend=L.prototype.nmcall=L.prototype.ninvoke=function(e){var n=u(arguments,1),t=N();return n.push(t.makeNodeResolver()),this.dispatch("post",[e,n]).fail(t.reject),t.promise},E.nodeify=function(e,n){return E(e).nodeify(n)},L.prototype.nodeify=function(n){if(!n)return this;this.then(function(e){E.nextTick(function(){n(null,e)})},function(e){E.nextTick(function(){n(e)})})},E.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var $=A();return E});var isStarted=!1,Ol;function patch(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(1==e.length){if(is.PatchFile(e[0]))return global.TRACE&&console.groupCollapsed(e[0]),downloadPatchFile(e[0]).then(function(e){return patch(e).then(function(){console.groupEnd()})});if(is.Array(e[0]))return Q(patchChain(e[0]));if(is.PlainObject(e[0])){var t=Object.getOwnPropertyNames(e[0])[0];return Q(patch(t,e[0][t]))}}else{if(!is.String(e[0]))return Q(patchElement(e[0],e[1]));switch(global.TRACE&&console.groupCollapsed(e[0]),e[0]){case"scene":if(is.Function(e[1])){var r=execute(e[1]);return is.Scene(r)&&(global.scene=r),isStarted||start(),global.TRACE&&console.groupEnd(),Q(global.scene)}return patchElement(global.scene,e[1]).then(function(){global.TRACE&&console.groupEnd()});case"exec":return global.TRACE&&console.groupEnd(),Q(execute(e[1]));default:var o=patchElements(select(e[0]).toArray(),e[1]);return is.Promise(o)?o.then(function(){global.TRACE&&console.groupEnd()}):(global.TRACE&&console.groupEnd(),Q())}}}function execute(func){try{global.TRACE&&console.log(func);var result=eval("var canvas=_r.canvas; var engine = _r.engine; var scene=_r.scene; var exec="+func+";exec()");return result}catch(e){console.error(e)}}function patchChain(t){var r=0;return function e(){if(r!==t.length){var n=patch(t[r]);return is.Promise(n)?n.then(function(){return r+=1,e()}):(r+=1,e())}}()}function downloadPatchFile(file){var deferred=Q.defer(),xhr=new XMLHttpRequest;return xhr.open("get",file,!0),xhr.onload=function(){var status=xhr.status;if(200==status){var data=void 0,isJson=!1;try{data=JSON.parse(xhr.response),isJson=!0}catch(e){isJson=!1}if(!isJson)try{data=window.eval.call(window,xhr.response)}catch(error){var __patch=void 0;eval("var __patch = "+xhr.response),data=__patch}data?deferred.resolve(data):(console.warn("BABYLON.Runtime::no data found in "+file),deferred.resolve([{}]))}else deferred.reject(status)},xhr.send(),deferred.promise}function patchElements(t,r,o){var n=[];global.TRACE&&(t.forEach(function(e){n.push(e.name)}),console.log(n.join(",")),console.log(r));var i=0;return function e(){if(i!==t.length){var n=patchElement(t[i],r,o);return is.Promise(n)?n.then(function(){return i+=1,e()}):(i+=1,e())}}()}function patchElement(t,r,o){var i=Object.getOwnPropertyNames(r),a=0;return function e(){if(a!==i.length){var n=patchProperty(t,i[a],r,o);return is.Promise(n)?n.then(function(){return a+=1,e()}):(a+=1,e())}}()}function patchProperty(n,t,e,r){if(is.Primitive(e[t]))return(i=patch.getPlugin(n,e,t))?(a=i.resolve(n,e,t))?is.Promise(a)?a.then(function(e){return n[t]=e,n[t]}):n[t]=a:e[t]:(n[t]=e[t],n[t]);if(is.Function(e[t])){if(is.Function(n[t]))return n[t]=e[t];try{r?r.push(n):r=[n];var o=e[t].apply(n,r);return is.Promise(o)?o.then(function(e){return n[t]=e,n[t]}):o?n[t]=o:n[t]}catch(e){return console.error(e),Q.reject(e)}}else{return is.Promise(e[t])?e[t].then(function(e){return n[t]=e,n[t]}):(n[t]||(n[t]={}),(i=patch.getPlugin(n,e,t))?(a=i.resolve(n,e,t))?is.Promise(a)?a.then(function(e){return n[t]=e,n[t]}):n[t]=a:e[t]:(r?r.push(n):r=[n],patchElement(n[t],e[t],r)));var i,a}}function downloadScene(n){var t,r;return n.assets?(t=n.assets,r=n.scene):(r=n.scene.split("/").pop(),t=n.scene.replace(r,"")),BABYLON.SceneLoader.LoadAssetContainerAsync(t,r,global.scene,function(e){n.progress&&n.progress(e)}).then(function(e){if(createLibrary(t+r,e),n.patch)return patch(n.patch).then(function(){!1!==n.addAllToScene&&e.addAllToScene(),n.ready&&n.ready(e)});!1!==n.addAllToScene&&e.addAllToScene(),n.ready&&n.ready(e)},function(e){n.error&&n.error(e)})}function downloadTexture(n){var t=Q.defer(),e=new BABYLON.AssetsManager(global.scene),r=e.addTextureTask(n.name,n.url,n.noMipmap,n.invertY,n.samplingMode);return r.onSuccess=function(e){t.resolve(e.texture),n.ready&&n.ready(e.texture)},r.onError=function(e){t.reject(e),n.error&&n.error(e)},e.load(),t.promise}function downloadCubeTexture(n){var t=Q.defer(),e=new BABYLON.AssetsManager(global.scene),r=e.addTextureTask(n.name,n.url,n.extensions,n.files);return r.onSuccess=function(e){t.resolve(e.texture),n.ready&&n.ready(e.texture)},r.onError=function(e){t.reject(e),n.error&&n.error(e)},e.load(),t.promise}Ol=patch||(patch={}),Ol.plugins=[],Ol.registerPlugin=function(e){Ol.plugins.push(e)},Ol.getPlugin=function(e,n,t){for(var r=null,o=0;o<Ol.plugins.length;o++)Ol.plugins[o].test(e,n,t)&&(r=Ol.plugins[o]);return r},global.fn.patch=function(e){return patchElements(this.toArray(),e)};var isReady=!0,callbacks=[],options={container:null,assets:null,scene:null,activeCamera:null,patch:null,ktx:!1,enableOfflineSupport:!1,progressLoading:null,loadingScreen:null};function launch(e){return isReady=!1,(options=extend(options,e)).container&&(global.canvas=options.container),options.ktx&&(is.Array(options.ktx)?global.engine.setTextureFormatToUse(options.ktx):!0===options.ktx&&global.engine.setTextureFormatToUse(["-astc.ktx","-dxt.ktx","-pvrtc.ktx","-etc2.ktx"])),options.enableOfflineSupport?global.engine.enableOfflineSupport=options.enableOfflineSupport:global.engine.enableOfflineSupport=!1,options.loadingScreen&&(global.engine.loadingScreen=options.loadingScreen),window.addEventListener("resize",function(){global.engine.resize()}),_createScene().then(function(){return _patch().then(function(){_checkActiveCamera(),_beforeFirstRender(),start$1(),isReady=!0,callbacks.forEach(function(e){try{e.call(global.scene)}catch(e){console.error(e)}}),callbacks.length=0})})}function _createScene(){var defer=Q.defer();if(options.scene){if(is.String(options.scene))return options.assets?downloadScene({scene:options.scene,assets:options.assets}):downloadScene({scene:options.scene});if(is.Function(options.scene))try{var result=eval("var canvas=_r.canvas; var engine = _r.engine; var scene=_r.scene; var createScene="+options.scene+";createScene()");is.Scene(result)&&(global.scene=result)}catch(e){throw defer.reject(e),e}else{if(!is.Scene(options.scene))throw defer.reject("invalid scene parameter in _r.launch"),new Error("invalid scene parameter in _r.launch");global.scene=options.scene}defer.resolve()}else defer.resolve();return defer.promise}function _patch(){return options.patch?patch(options.patch):Q()}function _beforeFirstRender(){options.beforeFirstRender&&is.Function(options.beforeFirstRender)&&options.beforeFirstRender()}function _checkActiveCamera(){if(is.String(options.activeCamera))activateCamera(options.activeCamera);else if(is.Function(options.activeCamera))try{activateCamera(options.activeCamera.call(global.scene).name)}catch(e){console.error("_r.launch() error on activeCamera",e)}else is.Camera(options.activeCamera)&&activateCamera(options.activeCamera.name);!global.scene.activeCamera&&0<global.scene.cameras.length&&activateCamera(global.scene.cameras[0].name),global.scene.activeCamera&&global.scene.activeCamera.inputs&&!global.scene.activeCamera.inputs.attachedElement&&global.scene.activeCamera.attachControl(global.canvas)}function loop$1(){global.scene.render()}function start$1(){global.engine.runRenderLoop(loop$1)}function ready(e){isReady?e.call(global.scene):callbacks.push(e)}var keyEvents=["OnKeyDownTrigger","OnKeyUpTrigger"];function onKeyEvent(n,e,t){void 0===t&&(t=!0),global.scene.actionManager||(global.scene.actionManager=new BABYLON.ActionManager(global.scene));var r=new BABYLON.ExecuteCodeAction(BABYLON.ActionManager[n],function(e){trigger(global.scene,n,e)});global.scene.actionManager.registerAction(r);var o=data(global.scene,"_r.events");o||(data(global.scene,"_r.events",[]),o=data(global.scene,"_r.events")),o[n]||(o[n]=[]),o[n].push({handler:e,repeat:t,action:r})}function oneKeyEvent(e,n){onKeyEvent(e,n,!1)}function offKeyEvent(e,t){var n=data(global.scene,"_r.events");n[e]&&(n[e]=t?n[e].filter(function(e){if(e.handler.toString()==t.toString()){if(e.action){var n=global.scene.actionManager.actions.indexOf(e.action);global.scene.actionManager.actions.splice(n,1)}e.listener&&global.scene.removeEventListener(e,e.listener)}return e.handler.toString()!==t.toString()}):[])}function color(e){if(e instanceof BABYLON.Color3||e instanceof BABYLON.Color4)return e;if(is.HexColor(e))return BABYLON.Color3.FromHexString(e);if(is.PlainObject(e)){if(e.hasOwnProperty("r")||e.hasOwnProperty("g")||e.hasOwnProperty("b")||e.hasOwnProperty("a")){var n=e.r||0,t=e.g||0,r=e.b||0;return e.a?new BABYLON.Color4(n,t,r,e.a):new BABYLON.Color3(n,t,r)}return console.error("_r.to.Color - invalid color : ",e),new BABYLON.Color3(0,0,0)}if(is.Array(e))return 3==e.length?BABYLON.Color3.FromArray(e):4==e.length?BABYLON.Color4.FromArray(e):(console.error("_r.to.Color - invalid color : ",e),new BABYLON.Color3(0,0,0));if(is.String(e)){if(0==(e=e.trim().toLocaleLowerCase()).indexOf("rgb(")){var o=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/);n=parseFloat(o[0]),t=parseFloat(o[1]),r=parseFloat(o[2]);return new BABYLON.Color3(isNaN(n)?0:n/255,isNaN(t)?0:t/255,isNaN(r)?0:r/255)}if(0==e.indexOf("rgba(")){var i=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/),a=(n=parseFloat(i[0]),t=parseFloat(i[1]),r=parseFloat(i[2]),parseFloat(i[3]));return new BABYLON.Color4(isNaN(n)?0:n/255,isNaN(t)?0:t/255,isNaN(r)?0:r/255,isNaN(a)?0:a/255)}switch(e){case"red":return BABYLON.Color3.Red();case"green":return BABYLON.Color3.Green();case"blue":return BABYLON.Color3.Blue();case"black":return BABYLON.Color3.Black();case"white":return BABYLON.Color3.White();case"purple":return BABYLON.Color3.Purple();case"magenta":case"pink":return BABYLON.Color3.Magenta();case"yellow":return BABYLON.Color3.Yellow();case"teal":case"cyan":return BABYLON.Color3.Teal();case"gray":case"grey":return BABYLON.Color3.Gray();case"random":return BABYLON.Color3.Random();default:return console.error("_r.to.Color - invalid color : ",e),new BABYLON.Color3(0,0,0)}}}function getEasingFunction(e){var n,t,r;if(-1!=e.indexOf("easeInOut"))n=BABYLON.EasingFunction.EASINGMODE_EASEINOUT,t=e.replace("easeInOut","");else if(-1!=e.indexOf("easeIn"))n=BABYLON.EasingFunction.EASINGMODE_EASEIN,t=e.replace("easeIn","");else{if(-1==e.indexOf("easeOut"))return console.info("_r::unrecognized easing function "+e),null;n=BABYLON.EasingFunction.EASINGMODE_EASEOUT,t=e.replace("easeOut","")}switch(t){case"Sine":return(r=new BABYLON.SineEase).setEasingMode(n),r;case"Quad":return(r=new BABYLON.QuadraticEase).setEasingMode(n),r;case"Cubic":return(r=new BABYLON.CubicEase).setEasingMode(n),r;case"Quart":return(r=new BABYLON.QuarticEase).setEasingMode(n),r;case"Quint":return(r=new BABYLON.QuinticEase).setEasingMode(n),r;case"Expo":return(r=new BABYLON.ExponentialEase).setEasingMode(n),r;case"Circ":return(r=new BABYLON.CircleEase).setEasingMode(n),r;case"Back":return(r=new BABYLON.BackEase).setEasingMode(n),r;case"Elastic":return(r=new BABYLON.ElasticEase).setEasingMode(n),r;case"Bounce":return(r=new BABYLON.BounceEase).setEasingMode(n),r;default:return console.warn("_r::unrecognized easing function "+e),null}}function getLoopMode(e){if(is.Boolean(e.loopMode)&&e.loopMode)return BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT;if(is.String(e.loopMode)){if("cycle"==e.loopMode.toLowerCase())return BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE;if("relative"==e.loopMode.toLocaleLowerCase()||"pingpong"==this.loop.toLocaleLowerCase())return BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE}else if(is.Number(e.loopMode))return e.loopMode;return BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT}function getAnimationType(e,n){return is.Vector2(e[n])?BABYLON.Animation.ANIMATIONTYPE_VECTOR2:is.Vector3(e[n])?BABYLON.Animation.ANIMATIONTYPE_VECTOR3:is.Number(e[n])?BABYLON.Animation.ANIMATIONTYPE_FLOAT:is.Color(e[n])?BABYLON.Animation.ANIMATIONTYPE_COLOR3:is.Quaternion(e[n])?BABYLON.Animation.ANIMATIONTYPE_QUATERNION:is.Matrix(e[n])?BABYLON.Animation.ANIMATIONTYPE_MATRIX:is.Size(e[n])?BABYLON.Animation.ANIMATIONTYPE_SIZE:null}function isAnimatable(e,n){return null!==getAnimationType(e,n)}function getKeys(e,n,t,r){if(r.keys)return r.keys;var o,i=e[n];switch(getAnimationType(e,n)){case BABYLON.Animation.ANIMATIONTYPE_COLOR3:patch(o=i.clone(),color(t));break;case BABYLON.Animation.ANIMATIONTYPE_FLOAT:o=t;break;case BABYLON.Animation.ANIMATIONTYPE_MATRIX:patch(o=i.clone(),t);break;default:o=i.clone(),Object.getOwnPropertyNames(t).forEach(function(e){o[e]=t[e]})}return[{frame:0,value:i},{frame:r.fps*r.duration,value:o}]}function getAnimationsForElement(r,o,i){var a=[],e=Object.getOwnPropertyNames(o);return r.animations||(r.animations=[]),e.forEach(function(e){if(isAnimatable(r,e)){var n=new BABYLON.Animation("_r.animation"+r.animations.length,e,i.fps,getAnimationType(r,e),getLoopMode(i)),t=getKeys(r,e,o[e],i);n.setKeys(t),i.easing&&n.setEasingFunction(getEasingFunction(i.easing)),r.animations.push(n),a.push(n)}else console.error(e+" is not animatable")}),a}function findSomethingToAnimate(t,r){var e=Object.getOwnPropertyNames(r),o=[];return e.forEach(function(e){if(isAnimatable(t,e))o.push({element:t,property:e,patch:r[e]});else{if(is.Primitive(r[e]))return[];var n=findSomethingToAnimate(t[e],r[e]);o=o.concat(n)}}),o}var defaultOptions={fps:30,duration:.4,speedRatio:1,loopMode:!1};function getOptions(e){var n={};return is.Number(e)?n.duration=e:n=e,n=extend({},defaultOptions,n)}var count=0;function animate(e,n,t){var r=select(e),o=getOptions(t),i=new BABYLON.AnimationGroup("_r.animate.AnimationsGroup"+count++);return r.each(function(e){findSomethingToAnimate(e,n).forEach(function(e){var n=e.element,t={};t[e.property]=e.patch,getAnimationsForElement(n,t,o).forEach(function(e){i.addTargetedAnimation(e,n)})})}),i.speedRatio=o.speedRatio,o.complete&&i.onAnimationGroupEndObservable.add(o.complete),i.onAnimationEndObservable.add(function(e){var n=e.target.animations.indexOf(e.animation);e.target.animations=e.target.animations.splice(n,1)}),i.play(),i}global.fn.animate=function(e){return animate(this.toArray(),e)},global.fn.fadeOut=function(e){var t=getOptions(e),r=new BABYLON.AnimationGroup("_r.animate.AnimationsGroup"+count++);return this.each(function(n){var e=[];is.Mesh(n)&&(e=getAnimationsForElement(n,{visibility:0},t)),is.Material(n)&&(e=getAnimationsForElement(n,{alpha:0},t)),is.Texture(n)&&(e=getAnimationsForElement(n,{level:0},t)),is.Light(n)&&(e=getAnimationsForElement(n,{intensity:0},t)),e.forEach(function(e){r.addTargetedAnimation(e,n)})}),r.speedRatio=t.speedRatio,t.complete&&r.onAnimationGroupEndObservable.add(t.complete),r.play(),r},global.fn.fadeIn=function(e){var t=getOptions(e),r=new BABYLON.AnimationGroup("_r.animate.AnimationsGroup"+count++);return this.each(function(n){var e=[];is.Mesh(n)&&(e=getAnimationsForElement(n,{visibility:1},t)),is.Material(n)&&(e=getAnimationsForElement(n,{alpha:1},t)),is.Texture(n)&&(e=getAnimationsForElement(n,{level:1},t)),is.Light(n)&&(e=getAnimationsForElement(n,{intensity:1},t)),e.forEach(function(e){r.addTargetedAnimation(e,n)})}),r.speedRatio=t.speedRatio,t.complete&&r.onAnimationGroupEndObservable.add(t.complete),r.play(),r},global.fn.finish=function(){this.each(function(e){global.scene.getAllAnimatablesByTarget(e).forEach(function(e){e.stop()}),e.animations=[]})},patch.registerPlugin({test:function(e,n,t){return e[t]instanceof BABYLON.Color3||e[t]instanceof BABYLON.Color4},resolve:function(e,n,t){return color(n[t])}}),patch.registerPlugin({test:function(e,n,t){return"*"===t.trim()},resolve:function(e,n,t){return is.MultiMaterial(e)?patchElements(e.subMaterials,n[t],e):is.Array(e)?patchElements(e,n[t]):patchElement(e,n[t])}});var index={get canvas(){return global.canvas},set canvas(e){global.canvas=e},get scene(){return global.scene},set scene(e){global.scene=e},get engine(){return global.engine},set engine(e){global.engine=e},get TRACE(){return global.TRACE},set TRACE(e){global.TRACE=e},launch:launch,ready:ready,start:start,pause:pause,downloadScene:downloadScene,downloadTexture:downloadTexture,downloadCubeTexture:downloadCubeTexture,createLibrary:createLibrary,library:library,data:data,on:function(e,n,t){void 0===t&&(t=!0),-1!=keyEvents.indexOf(e)?onKeyEvent(e,n,t):on(this,e,n,t)},off:function(e,n){-1!=keyEvents.indexOf(e)?offKeyEvent(e,n):off(this,e,n)},one:function(e,n){-1!=keyEvents.indexOf(e)?oneKeyEvent(e,n):one(this,e,n)},trigger:function(e,n){trigger(this,e,n)},select:select,patch:patch,match:match,is:is,color:color,animate:animate,extend:extend,activeCamera:activateCamera,fn:global.fn};return index});
//# sourceMappingURL=_r.min.js.map
