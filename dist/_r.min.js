var _r=function(BABYLON){"use strict";var is,_scene,_engine,_canvas;console.log("babylon runtime v(0.0.3)"),function(t){function n(e){return!isNaN(parseFloat(e))&&isFinite(e)}function r(e){return o(e)&&"#"==e[0]}function o(e){return"string"==typeof e}t.Function=function(e){return e&&"[object Function]"==={}.toString.call(e)},t.Number=n,t.PlainObject=function(e){if("object"!=typeof e||null===e)return!1;if("function"!=typeof Object.getPrototypeOf)return"[object Object]"==Object.prototype.toString.call(e);var t=Object.getPrototypeOf(e);return t===Object.prototype||null===t},t.AssetContainer=function(e){return e instanceof BABYLON.AssetContainer},t.Scene=function(e){return e instanceof BABYLON.Scene},t.Array=function(e){return window.Array.isArray(e)},t.Mesh=function(e){return e instanceof BABYLON.AbstractMesh},t.Material=function(e){return e instanceof BABYLON.Material},t.MultiMaterial=function(e){return e instanceof BABYLON.MultiMaterial},t.Texture=function(e){return e instanceof BABYLON.Texture},t.Light=function(e){return e instanceof BABYLON.Light},t.Camera=function(e){return e instanceof BABYLON.Camera},t.Vector3=function(e){return e instanceof BABYLON.Vector3||t.Array(e)&&3==e.length},t.Vector2=function(e){return e instanceof BABYLON.Vector2},t.Color=function(e){return r(e)||e instanceof BABYLON.Color3||e instanceof BABYLON.Color4||t.String(e)&&(0==e.trim().indexOf("rgb(")||0==e.trim().indexOf("rgba("))},t.HexColor=r,t.Float=function(e){return n(e)===e&&e%1!=0},t.Int=function(e){return n(e)===e&&e%1==0},t.Quaternion=function(e){return e instanceof BABYLON.Quaternion},t.Matrix=function(e){return e instanceof BABYLON.Matrix},t.String=o,t.PatchFile=function(e){if("string"!=typeof e)return!1;var t=e.split("."),n=t[t.length-1].trim();return"runtime"==n||"patch"==n||"js"==n},t.Boolean=function(e){return"boolean"==typeof e},t.BabylonNode=function(e){return t.Camera(e)||t.Light(e)||t.Material(e)||t.Mesh(e)||t.Texture(e)},t.DOM=function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},t.Primitive=function(e){return e!==Object(e)},t.Promise=function(e){return e&&"function"==typeof e.then}}(is||(is={}));var global=function(){function e(){}return Object.defineProperty(e,"canvas",{get:function(){if(!_canvas){if(BABYLON.Engine.LastCreatedEngine){var e=BABYLON.Engine.LastCreatedEngine.getRenderingCanvas();if(e)return _canvas=e}(_canvas=document.createElement("canvas")).setAttribute("touch-action","none"),_canvas.style.width="100%",_canvas.style.height="100%;",document.body.appendChild(_canvas)}return _canvas},set:function(e){_canvas=is.String(e)?document.getElementById(e):e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"engine",{get:function(){return _engine||(_engine=BABYLON.Engine.LastCreatedEngine?BABYLON.Engine.LastCreatedEngine:new BABYLON.Engine(e.canvas,!0)),_engine},set:function(e){_engine=e,window.addEventListener("resize",function(){_engine.resize()})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"scene",{get:function(){return _scene||(_scene=BABYLON.Engine.LastCreatedScene?BABYLON.Engine.LastCreatedScene:new BABYLON.Scene(e.engine)),_scene},set:function(e){_scene=e},enumerable:!0,configurable:!0}),e.TRACE=!1,e}();function activateCamera(e){global.scene.activeCamera&&global.scene.activeCamera.detachControl(),global.scene.setActiveCameraByName(e),global.scene.activeCamera.attachControl(global.canvas),global.TRACE&&(console.groupCollapsed("[_r] - activate camera "+global.scene.activeCamera.name),console.log(global.scene.activeCamera),console.groupEnd())}var cache=[],expando="_r"+Date.now();function data(e,t,n){return e.hasOwnProperty(expando)||(e[expando]=cache.length,cache[e[expando]]={}),null==t?cache[e[expando]]:null==n?cache[e[expando]][t]:void(cache[e[expando]][t]=n)}function on(e,t,n,r){void 0===r&&(r=!0),data(e,"_r.events")||data(e,"_r.events",{});var o=data(e,"_r.events");o[t]||(o[t]=[]),o[t].push({handler:n,repeat:r})}function one(e,t,n){on(e,t,n,!1)}function trigger(t,n,r){var e=data(t,"_r.events");if(e){var o=e[n];is.Array(o)&&o.forEach(function(e){try{e.handler.call(t,r),e.repeat||off(t,n,e.handler)}catch(e){console.error("_r.trigger exception",e)}})}}function off(e,t,n){var r=data(e,"_r.events");r[t]&&(r[t]=n?r[t].filter(function(e){e.handler.toString()==n.toString()&&r[t].splice(r[t].indexOf(e),1)}):[])}var meshTriggers=["NothingTrigger ","OnDoublePickTrigger","OnPickTrigger","OnLeftPickTrigger","OnRightPickTrigger","OnCenterPickTrigger","OnPickDownTrigger","OnPickUpTrigger","OnPickOutTrigger","OnLongPressTrigger","OnPointerOverTrigger","OnPointerOutTrigger","OnEveryFrameTrigger","OnIntersectionEnterTrigger","OnIntersectionExitTrigger","OnKeyDownTrigger","OnKeyUpTrigger"];function onMesh(t,n,e,r){void 0===r&&(r=!0),t.actionManager||(t.actionManager=new BABYLON.ActionManager(global.scene));var o=new BABYLON.ExecuteCodeAction(BABYLON.ActionManager[n],function(e){trigger(t,n,e)});t.actionManager.registerAction(o);var i=data(t,"_r.events");i||(data(t,"_r.events",[]),i=data(t,"_r.events")),i[n]||(i[n]=[]),i[n].push({handler:e,repeat:r,action:o})}function oneMesh(e,t,n){onMesh(e,t,n,!1)}function offMesh(n,e,r){var t=data(n,"_r.events");t[e]&&(t[e]=r?t[e].filter(function(e){if(e.handler.toString()==r.toString()){if(e.action){var t=n.actionManager.actions.indexOf(e.action);n.actionManager.actions.splice(t,1)}e.listener&&n.removeEventListener(e,e.listener)}return e.handler.toString()!==r.toString()}):[])}var Selector=function(){function e(a){this.type="all";var c=[],s="all";a.split(",").forEach(function(t){-1!==(t=t.trim()).indexOf(":mesh")&&(s="mesh"),-1!==t.indexOf(":material")&&(s="material"),-1!==t.indexOf(":light")&&(s="light"),-1!==t.indexOf(":camera")&&(s="camera"),-1!==t.indexOf(":texture")&&(s="texture"),-1!==t.indexOf(":multimaterial")&&(s="multimaterial"),[":mesh",":material",":multimaterial",":camera",":light",":texture"].forEach(function(e){t=t.replace(e,"")});for(var e,n=/\[(.*?)\]/,r=[];e=n.exec(a);)r.push(e[1]);r.forEach(function(t){if(-1!==t.indexOf("!=")){var n=t.split("!=");c.push(function(e){return!!e.hasOwnProperty(n[0])&&e[n[0]]!=n[1]})}else-1!==t.indexOf("=")?c.push(function(e){return!!e.hasOwnProperty(n[0])&&e[n[0]]==n[1]}):c.push(function(e){return e.hasOwnProperty(t)})});var o=(t=t.replace(n,"")).replace(/\*/g,".*"),i=new RegExp("^"+o+"$");c.push(function(e){return e.hasOwnProperty("name")&&i.test(e.name)})}),this.filters=c,this.type=s}return e.prototype.matchFilters=function(e){for(var t=0;t<this.filters.length;t++)if(!this.filters[t](e))return!1;return!0},e.prototype.matchType=function(e){return"all"==this.type||("mesh"==this.type?is.Mesh(e):"light"==this.type?is.Light(e):"material"==this.type?is.Material(e):"multimaterial"==this.type?is.MultiMaterial(e):"texture"==this.type?is.Texture(e):"camera"==this.type?is.Camera(e):void 0)},e}(),Elements=function(){function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this.length=0;n<e.length;n++)this.add(e[n])}return o.prototype.add=function(e){if(is.Array(e))for(var t=0;t<e.length;t++)this.add(e[t]);else if(is.AssetContainer(e)||is.Scene(e)){for(t=0;t<e.meshes.length;t++)this[this.length++]=e.meshes[t];for(t=0;t<e.lights.length;t++)this[this.length++]=e.lights[t];for(t=0;t<e.materials.length;t++)this[this.length++]=e.materials[t];for(t=0;t<e.textures.length;t++)this[this.length++]=e.textures[t];for(t=0;t<e.cameras.length;t++)this[this.length++]=e.cameras[t]}else this[this.length++]=e},o.prototype.contains=function(e){return-1!==this.toArray().indexOf(e)},o.prototype.on=function(t,n){this.each(function(e){is.Mesh(e)&&-1!==meshTriggers.indexOf(t)?onMesh(e,t,n):on(e,t,n)})},o.prototype.one=function(t,n){this.each(function(e){is.Mesh(e)&&-1!==meshTriggers.indexOf(t)?oneMesh(e,t,n):one(e,t,n)})},o.prototype.off=function(t,n){this.each(function(e){is.Mesh(e)&&-1!==meshTriggers.indexOf(t)?offMesh(e,t,n):off(e,t,n)})},o.prototype.trigger=function(t,n){this.each(function(e){trigger(e,t,n)})},o.prototype.data=function(e,t){if(null==e||null==t)return data(this[0],e,t);for(var n=0;n<this.length;n++)data(this[n],e,t)},o.prototype.show=function(){for(var e=0;e<this.length;e++)is.Mesh(this[e])?global.scene.addMesh(this[e]):is.Material(this[e])?global.scene.addMaterial(this[e]):is.Light(this[e])?global.scene.addMaterial(this[e]):is.Texture(this[e])?global.scene.addTexture(this[e]):is.Camera(this[e])&&global.scene.addCamera(this[e])},o.prototype.hide=function(){for(var e=0;e<this.length;e++)is.Mesh(this[e])?global.scene.removeMesh(this[e]):is.Material(this[e])?global.scene.removeMaterial(this[e]):is.Light(this[e])?global.scene.removeMaterial(this[e]):is.Texture(this[e])?global.scene.removeTexture(this[e]):is.Camera(this[e])&&global.scene.removeCamera(this[e])},o.prototype.each=function(e){for(var t=0;t<this.length;t++)if(0==e.call(this[t],this[t],t))return;return this},o.prototype.map=function(t){var n=new o,r=0;return this.each(function(e){n[r++]=t(e)}),n.length=r,n},o.prototype.filter=function(t){var n=new o;return this.each(function(e){t(e)&&n.add(e)}),n},o.prototype.toArray=function(){for(var e=[],t=0;t<this.length;t++)e.push(this[t]);return e},o.prototype.attr=function(t,n){return null!=n?(this.each(function(e){e[t]=n}),this):this[0][t]},o.prototype.first=function(){return this[0]},o.prototype.log=function(t){this.each(function(e){t?console.log(e[t]):console.log(e)})},o.prototype.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.forEach(function(e){var t;e instanceof o?t=e:is.String(e)?t=new o(e):is.Array(e)?(t=new o,e.forEach(function(e){t[t.length++]=e})):t=new o(e),t.each(function(e){this[this.length++]=e})}),this},o.prototype.select=function(e){return find(e,this)},o.prototype.dispose=function(){for(var e=0;e<this.length;e++)this[e].dispose(),delete this[e]},o.prototype.addToScene=function(){this.each(function(e){return is.Camera(e)?(global.scene.addCamera(e),!1):is.Mesh(e)?(global.scene.addMesh(e),!1):is.Material(e)?(global.scene.addMaterial(e),!1):is.MultiMaterial(e)?(global.scene.addMultiMaterial(e),!1):is.Texture(e)?(global.scene.addTexture(e),!1):is.Light(e)?(global.scene.addLight(e),!1):void 0})},o.prototype.removeFromScene=function(){this.each(function(e){return is.Camera(e)?(global.scene.removeCamera(e),!1):is.Mesh(e)?(global.scene.removeMesh(e),!1):is.Material(e)?(global.scene.removeMaterial(e),!1):is.MultiMaterial(e)?(global.scene.removeMultiMaterial(e),!1):is.Texture(e)?(global.scene.removeTexture(e),!1):is.Light(e)?(global.scene.removeLight(e),!1):void 0})},o.prototype.patch=function(e){},o.prototype.remove=function(e){},o.prototype.fadeIn=function(){},o.prototype.fadeOut=function(){},o}();function match(e,t){var n=new Selector(t);return n.matchType(e)&&n.matchFilters(e)}function find(e,t){var n=new Elements,r=new Selector(e);if(is.Scene(t)||is.AssetContainer(t))switch(r.type){case"material":t.materials.forEach(function(e){r.matchFilters(e)&&n.add(e)});break;case"mesh":t.meshes.forEach(function(e){r.matchFilters(e)&&n.add(e)});break;case"light":t.lights.forEach(function(e){r.matchFilters(e)&&n.add(e)});break;case"multimaterial":t.material.forEach(function(e){is.MultiMaterial(e)&&r.matchFilters(e)&&n.add(e)});break;case"texture":t.textures.forEach(function(e){r.matchFilters(e)&&n.add(e)});break;case"camera":t.cameras.forEach(function(e){r.matchFilters(e)&&n.add(e)});break;case"all":t.materials.forEach(function(e){r.matchFilters(e)&&n.add(e)}),t.meshes.forEach(function(e){r.matchFilters(e)&&n.add(e)}),t.lights.forEach(function(e){r.matchFilters(e)&&n.add(e)}),t.textures.forEach(function(e){r.matchFilters(e)&&n.add(e)})}else t.each(function(e){r.matchType(e)&&r.matchFilters(e)&&n.add(e)});return n}var libraries=[];function createLibrary(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(libraries[e])console.error("[_r] Error in _r.createLibrary : "+e+" already exists");else{var r=new Elements(t);libraries[e]=r,global.TRACE&&(console.groupCollapsed("[_r] - create library "+e),r.log(),console.groupEnd())}}function library(e){return libraries[e]}var ImportPromise=function(){function e(e){var n=this;this.promise=e,this._progressCallbacks=[],this._readyCallbacks=[],this._errorCallbacks=[],this._isReady=!1,this._error=!1,e.then?(e.then(function(t){n._isReady=!0,n._readyCallbacks.forEach(function(e){e(t)})}),e.catch(function(t){n._error=!0,n._exception=t,n._errorCallbacks.forEach(function(e){e(t)})})):(this._isReady=!0,this._result=e)}return e.prototype.triggerProgress=function(t){this._progressCallbacks.forEach(function(e){e(t)})},e.prototype.progress=function(e){return this._progressCallbacks.push(e),this},e.prototype.ready=function(e){return this._isReady?e(this._result):this._readyCallbacks.push(e),this},e.prototype.error=function(e){return this._isReady?this._error&&e(this._exception):this._errorCallbacks.push(e),this},e}();function importScene(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return load.apply(void 0,e).ready(function(e){return e.addAllToScene(),e.scene})}function downloadScene(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return load.apply(void 0,e)}function load(){for(var t,n,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(1===e.length)if(is.String(e[0])){var o=e[0];n=o.split("/").pop(),t=o.replace(n,"")}else t=e.assets,n=e.scene;else t=e[0],n=e[1];global.TRACE&&(console.groupCollapsed("[_r] - loadAssets & create library "+n+" from "+t),BABYLON.SceneLoader.loggingLevel=BABYLON.SceneLoader.DETAILED_LOGGING);var i=BABYLON.SceneLoader.LoadAssetContainerAsync(t,n,global.scene,function(e){a.triggerProgress(e)}).then(function(e){return createLibrary(t+n,e),BABYLON.SceneLoader.loggingLevel=BABYLON.SceneLoader.NO_LOGGING,console.groupEnd(),e}),a=new ImportPromise(i);return a}function select(e){if(is.String(e)){if("scene"===e.toLowerCase())return new Elements(global.scene);var t=find(e,global.scene);for(var n in libraries){libraries[n].select(e).each(function(e){t.contains(e)||t.add(e)})}return!0===global.TRACE&&0==t.length&&console.warn('BABYLON.Runtime::no object(s) found for selector "'+e+'"'),t}return new Elements(e)}function patch(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=[];return 1===t.length?t[0].forEach(function(t){var n=Object.getOwnPropertyNames(t)[0];select(n).each(function(e){r.push(applyPatch(e,t[n]))})}):2===t.length?select(t[0]).each(function(e){r.push(applyPatch(e,t[1]))}):console.error("not implemented"),r.reduce(Q.when,Q())}function applyPatch(t,n){var e=Object.getOwnPropertyNames(n),r=[];return e.forEach(function(e){r.push(resolveProperty(t,e,n))}),r.reduce(Q.when,Q())}function resolveProperty(t,n,e){if(is.Primitive(e[n]))return t[n]=e[n],Q(e[n]);if(is.Function(e[n])){if(is.Function(t[n]))return t[n]=e[n],Q(e[n]);var r=e[n].call(t);return is.Promise(r)?r.then(function(e){t[n]=e}):(t[n]=r,Q(r))}return t[n]||(t[n]={}),applyPatch(t[n],e[n])}!function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var t="undefined"!=typeof window?window:self,n=t.Q;t.Q=e(),t.Q.noConflict=function(){return t.Q=n,this}}}(function(){var c=!1;try{throw new Error}catch(e){c=!!e.stack}var o,i=j(),t=function(){},l=function(){var n={task:void 0,next:null},t=n,r=!1,o=void 0,i=!1,a=[];function c(){for(var e,t;n.next;)e=(n=n.next).task,n.task=void 0,(t=n.domain)&&(n.domain=void 0,t.enter()),s(e,t);for(;a.length;)s(e=a.pop());r=!1}function s(e,t){try{e()}catch(e){if(i)throw t&&t.exit(),setTimeout(c,0),t&&t.enter(),e;setTimeout(function(){throw e},0)}t&&t.exit()}if(l=function(e){t=t.next={task:e,domain:i&&process.domain,next:null},r||(r=!0,o())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)i=!0,o=function(){process.nextTick(c)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,c):function(){setImmediate(c)};else if("undefined"!=typeof MessageChannel){var e=new MessageChannel;e.port1.onmessage=function(){o=u,(e.port1.onmessage=c)()};var u=function(){e.port2.postMessage(0)};o=function(){setTimeout(c,0),u()}}else o=function(){setTimeout(c,0)};return l.runAfter=function(e){a.push(e),r||(r=!0,o())},l}(),n=Function.call;function e(e){return function(){return n.apply(e,arguments)}}var s,u=e(Array.prototype.slice),f=e(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),a=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),r=e(Array.prototype.map||function(r,o){var i=this,a=[];return f(i,function(e,t,n){a.push(r.call(o,t,n,i))},void 0),a}),p=Object.create||function(e){function t(){}return t.prototype=e,new t},h=Object.defineProperty||function(e,t,n){return e[t]=n.value,e},d=e(Object.prototype.hasOwnProperty),g=Object.keys||function(e){var t=[];for(var n in e)d(e,n)&&t.push(n);return t},y=e(Object.prototype.toString);s="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var v="From previous event:";function m(e,t){if(c&&t.stack&&"object"==typeof e&&null!==e&&e.stack){for(var n=[],r=t;r;r=r.source)r.stack&&(!e.__minimumStackCounter__||e.__minimumStackCounter__>r.stackCounter)&&(h(e,"__minimumStackCounter__",{value:r.stackCounter,configurable:!0}),n.unshift(r.stack));n.unshift(e.stack);var o=function(e){for(var t=e.split("\n"),n=[],r=0;r<t.length;++r){var o=t[r];!O(o)&&(-1===(i=o).indexOf("(module.js:")&&-1===i.indexOf("(node.js:"))&&o&&n.push(o)}var i;return n.join("\n")}(n.join("\n"+v+"\n"));h(e,"stack",{value:o,configurable:!0})}}function b(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function O(e){var t=b(e);if(!t)return!1;var n=t[0],r=t[1];return n===o&&i<=r&&r<=$}function j(){if(c)try{throw new Error}catch(e){var t=e.stack.split("\n"),n=b(0<t[0].indexOf("@")?t[1]:t[2]);if(!n)return;return o=n[0],n[1]}}function k(e){return e instanceof T?e:S(e)?(t=e,n=x(),k.nextTick(function(){try{t.then(n.resolve,n.reject,n.notify)}catch(e){n.reject(e)}}),n.promise):I(e);var t,n}(k.resolve=k).nextTick=l,k.longStackSupport=!1;var w=1;function x(){var o,i=[],a=[],e=p(x.prototype),t=p(T.prototype);if(t.promiseDispatch=function(e,t,n){var r=u(arguments);i?(i.push(r),"when"===t&&n[1]&&a.push(n[1])):k.nextTick(function(){o.promiseDispatch.apply(o,r)})},t.valueOf=function(){if(i)return t;var e=A(o);return L(e)&&(o=e),e},t.inspect=function(){return o?o.inspect():{state:"pending"}},k.longStackSupport&&c)try{throw new Error}catch(e){t.stack=e.stack.substring(e.stack.indexOf("\n")+1),t.stackCounter=w++}function n(n){o=n,k.longStackSupport&&c&&(t.source=n),f(i,function(e,t){k.nextTick(function(){n.promiseDispatch.apply(n,t)})},void 0),a=i=void 0}return e.promise=t,e.resolve=function(e){o||n(k(e))},e.fulfill=function(e){o||n(I(e))},e.reject=function(e){o||n(D(e))},e.notify=function(n){o||f(a,function(e,t){k.nextTick(function(){t(n)})},void 0)},e}function C(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=x();try{e(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise}function E(o){return C(function(e,t){for(var n=0,r=o.length;n<r;n++)k(o[n]).then(e,t)})}function T(o,i,t){void 0===i&&(i=function(e){return D(new Error("Promise does not support operation: "+e))}),void 0===t&&(t=function(){return{state:"unknown"}});var a=p(T.prototype);if(a.promiseDispatch=function(e,t,n){var r;try{r=o[t]?o[t].apply(a,n):i.call(a,t,n)}catch(e){r=D(e)}e&&e(r)},a.inspect=t){var e=t();"rejected"===e.state&&(a.exception=e.reason),a.valueOf=function(){var e=t();return"pending"===e.state||"rejected"===e.state?a:e.value}}return a}function _(e,t,n,r){return k(e).then(t,n,r)}function A(e){if(L(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function L(e){return e instanceof T}function S(e){return(t=e)===Object(t)&&"function"==typeof e.then;var t}"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(k.longStackSupport=!0),(k.defer=x).prototype.makeNodeResolver=function(){var n=this;return function(e,t){e?n.reject(e):2<arguments.length?n.resolve(u(arguments,1)):n.resolve(t)}},k.Promise=C,(k.promise=C).race=E,C.all=V,C.reject=D,(C.resolve=k).passByCopy=function(e){return e},T.prototype.passByCopy=function(){return this},k.join=function(e,t){return k(e).join(t)},T.prototype.join=function(e){return k([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Q can't join: not the same: "+e+" "+t)})},k.race=E,T.prototype.race=function(){return this.then(k.race)},(k.makePromise=T).prototype.toString=function(){return"[object Promise]"},T.prototype.then=function(t,n,o){var r=this,i=x(),a=!1;return k.nextTick(function(){r.promiseDispatch(function(e){a||(a=!0,i.resolve(function(e){try{return"function"==typeof t?t(e):e}catch(e){return D(e)}}(e)))},"when",[function(e){a||(a=!0,i.resolve(function(e){if("function"==typeof n){m(e,r);try{return n(e)}catch(e){return D(e)}}return D(e)}(e)))}])}),r.promiseDispatch(void 0,"when",[void 0,function(e){var t,n,r=!1;try{n=e,t="function"==typeof o?o(n):n}catch(e){if(r=!0,!k.onerror)throw e;k.onerror(e)}r||i.notify(t)}]),i.promise},k.tap=function(e,t){return k(e).tap(t)},T.prototype.tap=function(t){return t=k(t),this.then(function(e){return t.fcall(e).thenResolve(e)})},k.when=_,T.prototype.thenResolve=function(e){return this.then(function(){return e})},k.thenResolve=function(e,t){return k(e).thenResolve(t)},T.prototype.thenReject=function(e){return this.then(function(){throw e})},k.thenReject=function(e,t){return k(e).thenReject(t)},k.nearer=A,k.isPromise=L,k.isPromiseAlike=S,k.isPending=function(e){return L(e)&&"pending"===e.inspect().state},T.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=function(e){return!L(e)||"fulfilled"===e.inspect().state},T.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=function(e){return L(e)&&"rejected"===e.inspect().state},T.prototype.isRejected=function(){return"rejected"===this.inspect().state};var B,M,R,N=[],P=[],F=[],Y=!0;function Q(){N.length=0,P.length=0,Y||(Y=!0)}function D(t){var e,n,r=T({when:function(e){return e&&function(t){if(Y){var n=a(P,t);-1!==n&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){var e=a(F,t);-1!==e&&(process.emit("rejectionHandled",N[n],t),F.splice(e,1))}),P.splice(n,1),N.splice(n,1))}}(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return e=r,n=t,Y&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){-1!==a(P,e)&&(process.emit("unhandledRejection",n,e),F.push(e))}),P.push(e),n&&void 0!==n.stack?N.push(n.stack):N.push("(no stack) "+n)),r}function I(n){return T({when:function(){return n},get:function(e){return n[e]},set:function(e,t){n[e]=t},delete:function(e){delete n[e]},post:function(e,t){return null==e?n.apply(void 0,t):n[e].apply(n,t)},apply:function(e,t){return n.apply(e,t)},keys:function(){return g(n)}},void 0,function(){return{state:"fulfilled",value:n}})}function U(e,t,n){return k(e).spread(t,n)}function G(e,t,n){return k(e).dispatch(t,n)}function V(e){return _(e,function(o){var i=0,a=x();return f(o,function(e,t,n){var r;L(t)&&"fulfilled"===(r=t.inspect()).state?o[n]=r.value:(++i,_(t,function(e){o[n]=e,0==--i&&a.resolve(o)},a.reject,function(e){a.notify({index:n,value:e})}))},void 0),0===i&&a.resolve(o),a.promise})}function z(o){if(0===o.length)return k.resolve();var i=k.defer(),a=0;return f(o,function(e,t,n){var r=o[n];a++,_(r,function(e){i.resolve(e)},function(e){if(0==--a){var t=e||new Error(""+e);t.message="Q can't get fulfillment value from any promise, all promises were rejected. Last error message: "+t.message,i.reject(t)}},function(e){i.notify({index:n,value:e})})},void 0),i.promise}function H(e){return _(e,function(e){return e=r(e,k),_(V(r(e,function(e){return _(e,t,t)})),function(){return e})})}k.resetUnhandledRejections=Q,k.getUnhandledReasons=function(){return N.slice()},k.stopUnhandledRejectionTracking=function(){Q(),Y=!1},Q(),k.reject=D,k.fulfill=I,k.master=function(n){return T({isDef:function(){}},function(e,t){return G(n,e,t)},function(){return k(n).inspect()})},k.spread=U,T.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},k.async=function(t){return function(){function e(e,t){var n,r;if("undefined"==typeof StopIteration){try{n=o[e](t)}catch(e){return D(e)}return n.done?k(n.value):_(n.value,i,a)}try{n=o[e](t)}catch(e){return"[object StopIteration]"===y(r=e)||r instanceof s?k(e.value):D(e)}return _(n,i,a)}var o=t.apply(this,arguments),i=e.bind(e,"next"),a=e.bind(e,"throw");return i()}},k.spawn=function(e){k.done(k.async(e)())},k.return=function(e){throw new s(e)},k.promised=function(n){return function(){return U([this,V(arguments)],function(e,t){return n.apply(e,t)})}},k.dispatch=G,T.prototype.dispatch=function(e,t){var n=this,r=x();return k.nextTick(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},k.get=function(e,t){return k(e).dispatch("get",[t])},T.prototype.get=function(e){return this.dispatch("get",[e])},k.set=function(e,t,n){return k(e).dispatch("set",[t,n])},T.prototype.set=function(e,t){return this.dispatch("set",[e,t])},k.del=k.delete=function(e,t){return k(e).dispatch("delete",[t])},T.prototype.del=T.prototype.delete=function(e){return this.dispatch("delete",[e])},k.mapply=k.post=function(e,t,n){return k(e).dispatch("post",[t,n])},T.prototype.mapply=T.prototype.post=function(e,t){return this.dispatch("post",[e,t])},k.send=k.mcall=k.invoke=function(e,t){return k(e).dispatch("post",[t,u(arguments,2)])},T.prototype.send=T.prototype.mcall=T.prototype.invoke=function(e){return this.dispatch("post",[e,u(arguments,1)])},k.fapply=function(e,t){return k(e).dispatch("apply",[void 0,t])},T.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},k.try=k.fcall=function(e){return k(e).dispatch("apply",[void 0,u(arguments,1)])},T.prototype.fcall=function(){return this.dispatch("apply",[void 0,u(arguments)])},k.fbind=function(e){var t=k(e),n=u(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(u(arguments))])}},T.prototype.fbind=function(){var e=this,t=u(arguments);return function(){return e.dispatch("apply",[this,t.concat(u(arguments))])}},k.keys=function(e){return k(e).dispatch("keys",[])},T.prototype.keys=function(){return this.dispatch("keys",[])},k.all=V,T.prototype.all=function(){return V(this)},k.any=z,T.prototype.any=function(){return z(this)},k.allResolved=(B=H,M="allResolved",R="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(M+" is deprecated, use "+R+" instead.",new Error("").stack),B.apply(B,arguments)}),T.prototype.allResolved=function(){return H(this)},k.allSettled=function(e){return k(e).allSettled()},T.prototype.allSettled=function(){return this.then(function(e){return V(r(e,function(e){function t(){return e.inspect()}return(e=k(e)).then(t,t)}))})},k.fail=k.catch=function(e,t){return k(e).then(void 0,t)},T.prototype.fail=T.prototype.catch=function(e){return this.then(void 0,e)},k.progress=function(e,t){return k(e).then(void 0,void 0,t)},T.prototype.progress=function(e){return this.then(void 0,void 0,e)},k.fin=k.finally=function(e,t){return k(e).finally(t)},T.prototype.fin=T.prototype.finally=function(t){if(!t||"function"!=typeof t.apply)throw new Error("Q can't apply finally callback");return t=k(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},k.done=function(e,t,n,r){return k(e).done(t,n,r)},T.prototype.done=function(e,t,n){var r=function(e){k.nextTick(function(){if(m(e,o),!k.onerror)throw e;k.onerror(e)})},o=e||t||n?this.then(e,t,n):this;"object"==typeof process&&process&&process.domain&&(r=process.domain.bind(r)),o.then(void 0,r)},k.timeout=function(e,t,n){return k(e).timeout(t,n)},T.prototype.timeout=function(e,t){var n=x(),r=setTimeout(function(){t&&"string"!=typeof t||((t=new Error(t||"Timed out after "+e+" ms")).code="ETIMEDOUT"),n.reject(t)},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},k.delay=function(e,t){return void 0===t&&(t=e,e=void 0),k(e).delay(t)},T.prototype.delay=function(n){return this.then(function(e){var t=x();return setTimeout(function(){t.resolve(e)},n),t.promise})},k.nfapply=function(e,t){return k(e).nfapply(t)},T.prototype.nfapply=function(e){var t=x(),n=u(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},k.nfcall=function(e){var t=u(arguments,1);return k(e).nfapply(t)},T.prototype.nfcall=function(){var e=u(arguments),t=x();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},k.nfbind=k.denodeify=function(n){if(void 0===n)throw new Error("Q can't wrap an undefined function");var r=u(arguments,1);return function(){var e=r.concat(u(arguments)),t=x();return e.push(t.makeNodeResolver()),k(n).fapply(e).fail(t.reject),t.promise}},T.prototype.nfbind=T.prototype.denodeify=function(){var e=u(arguments);return e.unshift(this),k.denodeify.apply(void 0,e)},k.nbind=function(n,r){var o=u(arguments,2);return function(){var e=o.concat(u(arguments)),t=x();return e.push(t.makeNodeResolver()),k(function(){return n.apply(r,arguments)}).fapply(e).fail(t.reject),t.promise}},T.prototype.nbind=function(){var e=u(arguments,0);return e.unshift(this),k.nbind.apply(void 0,e)},k.nmapply=k.npost=function(e,t,n){return k(e).npost(t,n)},T.prototype.nmapply=T.prototype.npost=function(e,t){var n=u(t||[]),r=x();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},k.nsend=k.nmcall=k.ninvoke=function(e,t){var n=u(arguments,2),r=x();return n.push(r.makeNodeResolver()),k(e).dispatch("post",[t,n]).fail(r.reject),r.promise},T.prototype.nsend=T.prototype.nmcall=T.prototype.ninvoke=function(e){var t=u(arguments,1),n=x();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},k.nodeify=function(e,t){return k(e).nodeify(t)},T.prototype.nodeify=function(t){if(!t)return this;this.then(function(e){k.nextTick(function(){t(null,e)})},function(e){k.nextTick(function(){t(e)})})},k.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var $=j();return k});var isReady=!0,callbacks=[];function launch(obj){if(isReady=!1,is.String(obj))return importScene(obj).ready(function(){run(obj)});if(obj=obj,obj.container&&(global.canvas=obj.container),obj.ktx&&(is.Array(obj.ktx)?global.engine.setTextureFormatToUse(obj.ktx):!0===obj.ktx&&global.engine.setTextureFormatToUse(["-astc.ktx","-dxt.ktx","-pvrtc.ktx","-etc2.ktx"])),obj.enableOfflineSupport?global.engine.enableOfflineSupport=obj.enableOfflineSupport:global.engine.enableOfflineSupport=!1,obj.loadingScreen&&(global.engine.loadingScreen=obj.loadingScreen),obj.scene){if(is.String(obj.scene))return obj.assets?importScene(obj.assets,obj.scene).ready(function(){run(obj)}):importScene(obj.scene).ready(function(e){run(obj)});if(is.Function(obj.scene)){var result=eval("var canvas=_r.canvas; var engine = _r.engine; var scene=_r.scene; var createScene="+obj.scene+";createScene()");is.Scene(result)&&(global.scene=result)}else{if(!is.Scene(obj.scene))throw new Error("invalid scene parameter in _r.launch");global.scene=obj.scene}return run(obj),new ImportPromise(global.scene)}}function run(e){if(e.activeCamera)if(is.String(e.activeCamera))activateCamera(e.activeCamera);else if(is.Function(e.activeCamera))try{activateCamera(e.activeCamera.call(global.scene).name)}catch(e){console.error("_r.launch() error on activeCamera",e)}else activateCamera(e.activeCamera.name);!global.scene.activeCamera&&0<global.scene.cameras.length&&activateCamera(global.scene.cameras[0].name),window.addEventListener("resize",function(){global.engine.resize()}),e.patch?patch(e.patch).then(function(){e.beforeFirstRender&&is.Function(e.beforeFirstRender)&&e.beforeFirstRender(),start(),isReady=!0,callbacks.forEach(function(e){e.call(global.scene)}),callbacks.length=0}):(e.beforeFirstRender&&is.Function(e.beforeFirstRender)&&e.beforeFirstRender(),start(),isReady=!0,callbacks.forEach(function(e){e.call(global.scene)}),callbacks.length=0)}function loop(){global.scene.render()}function start(){global.engine.runRenderLoop(loop)}function pause(){global.engine.stopRenderLoop(loop)}function ready(e){isReady?e.call(global.scene):callbacks.push(e)}var index={get canvas(){return global.canvas},set canvas(e){global.canvas=e},get scene(){return global.scene},set scene(e){global.scene=e},get engine(){return global.engine},set engine(e){global.engine=e},get TRACE(){return global.TRACE},set TRACE(e){global.TRACE=e},launch:launch,ready:ready,start:start,pause:pause,import:importScene,download:downloadScene,createLibrary:createLibrary,library:library,data:data,on:on,off:off,one:one,trigger:trigger,select:select,patch:patch,match:match,Selector:Selector};return index}(BABYLON);
//# sourceMappingURL=_r.min.js.map
